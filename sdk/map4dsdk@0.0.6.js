var map4d=function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t,e,n){"use strict";t.exports=o,t.exports.default=o;var i=n(5);function o(t,e){if(!(this instanceof o))return new o(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function r(t,e,n){if(!n)return e.indexOf(t);for(var i=0;i<e.length;i++)if(n(t,e[i]))return i;return-1}function a(t,e){s(t,0,t.children.length,e,t)}function s(t,e,n,i,o){o||(o=y(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var r,a=e;a<n;a++)r=t.children[a],u(o,t.leaf?i(r):r);return o}function u(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function h(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function p(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function d(t,e){var n=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),o=Math.min(t.maxX,e.maxX),r=Math.min(t.maxY,e.maxY);return Math.max(0,o-n)*Math.max(0,r-i)}function g(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function m(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function y(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(t,e,n,o,r){for(var a,s=[e,n];s.length;)(n=s.pop())-(e=s.pop())<=o||(a=e+Math.ceil((n-e)/o/2)*o,i(t,a,e,n,r),s.push(e,a,a,n))}o.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],i=this.toBBox;if(!m(t,e))return n;for(var o,r,a,s,u=[];e;){for(o=0,r=e.children.length;o<r;o++)a=e.children[o],m(t,s=e.leaf?i(a):a)&&(e.leaf?n.push(a):g(t,s)?this._all(a,n):u.push(a));e=u.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!m(t,e))return!1;for(var i,o,r,a,s=[];e;){for(i=0,o=e.children.length;i<o;i++)if(r=e.children[i],m(t,a=e.leaf?n(r):r)){if(e.leaf||g(t,a))return!0;s.push(r)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var o=this.data;this.data=i,i=o}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=y([]),this},remove:function(t,e){if(!t)return this;for(var n,i,o,a,s=this.data,u=this.toBBox(t),l=[],h=[];s||l.length;){if(s||(s=l.pop(),i=l[l.length-1],n=h.pop(),a=!0),s.leaf&&-1!==(o=r(t,s.children,e)))return s.children.splice(o,1),l.push(s),this._condense(l),this;a||s.leaf||!g(s,u)?i?(n++,s=i.children[n],a=!1):s=null:(l.push(s),h.push(n),n=0,i=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:l,compareMinY:h,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,i){var o,r=n-e+1,s=this._maxEntries;if(r<=s)return a(o=y(t.slice(e,n+1)),this.toBBox),o;i||(i=Math.ceil(Math.log(r)/Math.log(s)),s=Math.ceil(r/Math.pow(s,i-1))),(o=y([])).leaf=!1,o.height=i;var u,l,h,c,p=Math.ceil(r/s),f=p*Math.ceil(Math.sqrt(s));for(v(t,e,n,f,this.compareMinX),u=e;u<=n;u+=f)for(v(t,u,h=Math.min(u+f-1,n),p,this.compareMinY),l=u;l<=h;l+=p)c=Math.min(l+p-1,h),o.children.push(this._build(t,l,c,i-1));return a(o,this.toBBox),o},_chooseSubtree:function(t,e,n,i){for(var o,r,a,s,u,l,h,p;i.push(e),!e.leaf&&i.length-1!==n;){for(h=p=1/0,o=0,r=e.children.length;o<r;o++)u=c(a=e.children[o]),(l=f(t,a)-u)<p?(p=l,h=u<h?u:h,s=a):l===p&&u<h&&(h=u,s=a);e=s||e.children[0]}return e},_insert:function(t,e,n){var i=this.toBBox,o=n?t:i(t),r=[],a=this._chooseSubtree(o,this.data,e,r);for(a.children.push(t),u(a,o);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(o,r,e)},_split:function(t,e){var n=t[e],i=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,i);var r=this._chooseSplitIndex(n,o,i),s=y(n.children.splice(r,n.children.length-r));s.height=n.height,s.leaf=n.leaf,a(n,this.toBBox),a(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,e){this.data=y([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var i,o,r,a,u,l,h,p;for(l=h=1/0,i=e;i<=n-e;i++)a=d(o=s(t,0,i,this.toBBox),r=s(t,i,n,this.toBBox)),u=c(o)+c(r),a<l?(l=a,p=i,h=u<h?u:h):a===l&&u<h&&(h=u,p=i);return p},_chooseSplitAxis:function(t,e,n){var i=t.leaf?this.compareMinX:l,o=t.leaf?this.compareMinY:h;this._allDistMargin(t,e,n,i)<this._allDistMargin(t,e,n,o)&&t.children.sort(i)},_allDistMargin:function(t,e,n,i){t.children.sort(i);var o,r,a=this.toBBox,l=s(t,0,e,a),h=s(t,n-e,n,a),c=p(l)+p(h);for(o=e;o<n-e;o++)r=t.children[o],u(l,t.leaf?a(r):r),c+=p(l);for(o=n-e-1;o>=e;o--)r=t.children[o],u(h,t.leaf?a(r):r),c+=p(h);return c},_adjustParentBBoxes:function(t,e,n){for(var i=n;i>=0;i--)u(e[i],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():a(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},function(t,e,n){"use strict";function i(t,e){this.x=t,this.y=e}t.exports=i,i.prototype={clone:function(){return new i(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=e*this.x-n*this.y,o=n*this.x+e*this.y;return this.x=i,this.y=o,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),o=e.x+n*(this.x-e.x)-i*(this.y-e.y),r=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=o,this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.convert=function(t){return t instanceof i?t:Array.isArray(t)?new i(t[0],t[1]):t}},function(t,e,n){"use strict";function i(t,e,n){n=n||2;var i,s,u,l,h,f,g,m=e&&e.length,y=m?e[0]*n:t.length,v=o(t,0,y,n,!0),x=[];if(!v||v.next===v.prev)return x;if(m&&(v=function(t,e,n,i){var a,s,u,l,h,f=[];for(a=0,s=e.length;a<s;a++)u=e[a]*i,l=a<s-1?e[a+1]*i:t.length,(h=o(t,u,l,i,!1))===h.next&&(h.steiner=!0),f.push(d(h));for(f.sort(c),a=0;a<f.length;a++)p(f[a],n),n=r(n,n.next);return n}(t,e,v,n)),t.length>80*n){i=u=t[0],s=l=t[1];for(var A=n;A<y;A+=n)h=t[A],f=t[A+1],h<i&&(i=h),f<s&&(s=f),h>u&&(u=h),f>l&&(l=f);g=0!==(g=Math.max(u-i,l-s))?1/g:0}return a(v,x,n,i,s,g),x}function o(t,e,n,i,o){var r,a;if(o===_(t,e,n,i)>0)for(r=e;r<n;r+=i)a=w(r,t[r],t[r+1],a);else for(r=n-i;r>=e;r-=i)a=w(r,t[r],t[r+1],a);return a&&v(a,a.next)&&(T(a),a=a.next),a}function r(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!v(i,i.next)&&0!==y(i.prev,i,i.next))i=i.next;else{if(T(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function a(t,e,n,i,o,c,p){if(t){!p&&c&&function(t,e,n,i){var o=t;do{null===o.z&&(o.z=f(o.x,o.y,e,n,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,n,i,o,r,a,s,u,l=1;do{for(n=t,t=null,r=null,a=0;n;){for(a++,i=n,s=0,e=0;e<l&&(s++,i=i.nextZ);e++);for(u=l;s>0||u>0&&i;)0!==s&&(0===u||!i||n.z<=i.z)?(o=n,n=n.nextZ,s--):(o=i,i=i.nextZ,u--),r?r.nextZ=o:t=o,o.prevZ=r,r=o;n=i}r.nextZ=null,l*=2}while(a>1)}(o)}(t,i,o,c);for(var d,g,m=t;t.prev!==t.next;)if(d=t.prev,g=t.next,c?u(t,i,o,c):s(t))e.push(d.i/n),e.push(t.i/n),e.push(g.i/n),T(t),t=g.next,m=g.next;else if((t=g)===m){p?1===p?a(t=l(t,e,n),e,n,i,o,c,2):2===p&&h(t,e,n,i,o,c):a(r(t),e,n,i,o,c,1);break}}}function s(t){var e=t.prev,n=t,i=t.next;if(y(e,n,i)>=0)return!1;for(var o=t.next.next;o!==t.prev;){if(g(e.x,e.y,n.x,n.y,i.x,i.y,o.x,o.y)&&y(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function u(t,e,n,i){var o=t.prev,r=t,a=t.next;if(y(o,r,a)>=0)return!1;for(var s=o.x<r.x?o.x<a.x?o.x:a.x:r.x<a.x?r.x:a.x,u=o.y<r.y?o.y<a.y?o.y:a.y:r.y<a.y?r.y:a.y,l=o.x>r.x?o.x>a.x?o.x:a.x:r.x>a.x?r.x:a.x,h=o.y>r.y?o.y>a.y?o.y:a.y:r.y>a.y?r.y:a.y,c=f(s,u,e,n,i),p=f(l,h,e,n,i),d=t.prevZ,m=t.nextZ;d&&d.z>=c&&m&&m.z<=p;){if(d!==t.prev&&d!==t.next&&g(o.x,o.y,r.x,r.y,a.x,a.y,d.x,d.y)&&y(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,m!==t.prev&&m!==t.next&&g(o.x,o.y,r.x,r.y,a.x,a.y,m.x,m.y)&&y(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&g(o.x,o.y,r.x,r.y,a.x,a.y,d.x,d.y)&&y(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;m&&m.z<=p;){if(m!==t.prev&&m!==t.next&&g(o.x,o.y,r.x,r.y,a.x,a.y,m.x,m.y)&&y(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function l(t,e,n){var i=t;do{var o=i.prev,r=i.next.next;!v(o,r)&&x(o,i,i.next,r)&&A(o,r)&&A(r,o)&&(e.push(o.i/n),e.push(i.i/n),e.push(r.i/n),T(i),T(i.next),i=t=r),i=i.next}while(i!==t);return i}function h(t,e,n,i,o,s){var u=t;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&m(u,l)){var h=M(u,l);return u=r(u,u.next),h=r(h,h.next),a(u,e,n,i,o,s),void a(h,e,n,i,o,s)}l=l.next}u=u.next}while(u!==t)}function c(t,e){return t.x-e.x}function p(t,e){if(e=function(t,e){var n,i=e,o=t.x,r=t.y,a=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var s=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=o&&s>a){if(a=s,s===o){if(r===i.y)return i;if(r===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(o===a)return n.prev;var u,l=n,h=n.x,c=n.y,p=1/0;i=n.next;for(;i!==l;)o>=i.x&&i.x>=h&&o!==i.x&&g(r<c?o:a,r,h,c,r<c?a:o,r,i.x,i.y)&&((u=Math.abs(r-i.y)/(o-i.x))<p||u===p&&i.x>n.x)&&A(i,t)&&(n=i,p=u),i=i.next;return n}(t,e)){var n=M(e,t);r(n,n.next)}}function f(t,e,n,i,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*o)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*o)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function d(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function g(t,e,n,i,o,r,a,s){return(o-a)*(e-s)-(t-a)*(r-s)>=0&&(t-a)*(i-s)-(n-a)*(e-s)>=0&&(n-a)*(r-s)-(o-a)*(i-s)>=0}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&x(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&A(t,e)&&A(e,t)&&function(t,e){var n=t,i=!1,o=(t.x+e.x)/2,r=(t.y+e.y)/2;do{n.y>r!=n.next.y>r&&n.next.y!==n.y&&o<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)}function y(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function v(t,e){return t.x===e.x&&t.y===e.y}function x(t,e,n,i){return!!(v(t,e)&&v(n,i)||v(t,i)&&v(n,e))||y(t,e,n)>0!=y(t,e,i)>0&&y(n,i,t)>0!=y(n,i,e)>0}function A(t,e){return y(t.prev,t,t.next)<0?y(t,e,t.next)>=0&&y(t,t.prev,e)>=0:y(t,e,t.prev)<0||y(t,t.next,e)<0}function M(t,e){var n=new b(t.i,t.x,t.y),i=new b(e.i,e.x,e.y),o=t.next,r=e.prev;return t.next=e,e.prev=t,n.next=o,o.prev=n,i.next=n,n.prev=i,r.next=i,i.prev=r,i}function w(t,e,n,i){var o=new b(t,e,n);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function T(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function b(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _(t,e,n,i){for(var o=0,r=e,a=n-i;r<n;r+=i)o+=(t[a]-t[r])*(t[r+1]+t[a+1]),a=r;return o}t.exports=i,t.exports.default=i,i.deviation=function(t,e,n,i){var o=e&&e.length,r=o?e[0]*n:t.length,a=Math.abs(_(t,0,r,n));if(o)for(var s=0,u=e.length;s<u;s++){var l=e[s]*n,h=s<u-1?e[s+1]*n:t.length;a-=Math.abs(_(t,l,h,n))}var c=0;for(s=0;s<i.length;s+=3){var p=i[s]*n,f=i[s+1]*n,d=i[s+2]*n;c+=Math.abs((t[p]-t[d])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[d+1]-t[p+1]))}return 0===a&&0===c?0:Math.abs((c-a)/a)},i.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,o=0;o<t.length;o++){for(var r=0;r<t[o].length;r++)for(var a=0;a<e;a++)n.vertices.push(t[o][r][a]);o>0&&(i+=t[o-1].length,n.holes.push(i))}return n}},function(t,e,n){"use strict";t.exports=function(t){return new l(t||d,null)};var i=0,o=1;function r(t,e,n,i,o,r){this._color=t,this.key=e,this.value=n,this.left=i,this.right=o,this._count=r}function a(t){return new r(t._color,t.key,t.value,t.left,t.right,t._count)}function s(t,e){return new r(t,e.key,e.value,e.left,e.right,e._count)}function u(t){t._count=1+(t.left?t.left._count:0)+(t.right?t.right._count:0)}function l(t,e){this._compare=t,this.root=e}var h=l.prototype;function c(t,e){this.tree=t,this._stack=e}Object.defineProperty(h,"keys",{get:function(){var t=[];return this.forEach(function(e,n){t.push(e)}),t}}),Object.defineProperty(h,"values",{get:function(){var t=[];return this.forEach(function(e,n){t.push(n)}),t}}),Object.defineProperty(h,"length",{get:function(){return this.root?this.root._count:0}}),h.insert=function(t,e){for(var n=this._compare,a=this.root,h=[],c=[];a;){var p=n(t,a.key);h.push(a),c.push(p),a=p<=0?a.left:a.right}h.push(new r(i,t,e,null,null,1));for(var f=h.length-2;f>=0;--f){a=h[f];c[f]<=0?h[f]=new r(a._color,a.key,a.value,h[f+1],a.right,a._count+1):h[f]=new r(a._color,a.key,a.value,a.left,h[f+1],a._count+1)}for(f=h.length-1;f>1;--f){var d=h[f-1];a=h[f];if(d._color===o||a._color===o)break;var g=h[f-2];if(g.left===d)if(d.left===a){if(!(m=g.right)||m._color!==i){if(g._color=i,g.left=d.right,d._color=o,d.right=g,h[f-2]=d,h[f-1]=a,u(g),u(d),f>=3)(y=h[f-3]).left===g?y.left=d:y.right=d;break}d._color=o,g.right=s(o,m),g._color=i,f-=1}else{if(!(m=g.right)||m._color!==i){if(d.right=a.left,g._color=i,g.left=a.right,a._color=o,a.left=d,a.right=g,h[f-2]=a,h[f-1]=d,u(g),u(d),u(a),f>=3)(y=h[f-3]).left===g?y.left=a:y.right=a;break}d._color=o,g.right=s(o,m),g._color=i,f-=1}else if(d.right===a){if(!(m=g.left)||m._color!==i){if(g._color=i,g.right=d.left,d._color=o,d.left=g,h[f-2]=d,h[f-1]=a,u(g),u(d),f>=3)(y=h[f-3]).right===g?y.right=d:y.left=d;break}d._color=o,g.left=s(o,m),g._color=i,f-=1}else{var m;if(!(m=g.left)||m._color!==i){var y;if(d.left=a.right,g._color=i,g.right=a.left,a._color=o,a.right=d,a.left=g,h[f-2]=a,h[f-1]=d,u(g),u(d),u(a),f>=3)(y=h[f-3]).right===g?y.right=a:y.left=a;break}d._color=o,g.left=s(o,m),g._color=i,f-=1}}return h[0]._color=o,new l(n,h[0])},h.forEach=function(t,e,n){if(this.root)switch(arguments.length){case 1:return function t(e,n){var i;if(n.left&&(i=t(e,n.left)))return i;return(i=e(n.key,n.value))||(n.right?t(e,n.right):void 0)}(t,this.root);case 2:return function t(e,n,i,o){if(n(e,o.key)<=0){var r;if(o.left&&(r=t(e,n,i,o.left)))return r;if(r=i(o.key,o.value))return r}if(o.right)return t(e,n,i,o.right)}(e,this._compare,t,this.root);case 3:if(this._compare(e,n)>=0)return;return function t(e,n,i,o,r){var a,s=i(e,r.key),u=i(n,r.key);if(s<=0){if(r.left&&(a=t(e,n,i,o,r.left)))return a;if(u>0&&(a=o(r.key,r.value)))return a}if(u>0&&r.right)return t(e,n,i,o,r.right)}(e,n,this._compare,t,this.root)}},Object.defineProperty(h,"begin",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.left;return new c(this,t)}}),Object.defineProperty(h,"end",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.right;return new c(this,t)}}),h.at=function(t){if(t<0)return new c(this,[]);for(var e=this.root,n=[];;){if(n.push(e),e.left){if(t<e.left._count){e=e.left;continue}t-=e.left._count}if(!t)return new c(this,n);if(t-=1,!e.right)break;if(t>=e.right._count)break;e=e.right}return new c(this,[])},h.ge=function(t){for(var e=this._compare,n=this.root,i=[],o=0;n;){var r=e(t,n.key);i.push(n),r<=0&&(o=i.length),n=r<=0?n.left:n.right}return i.length=o,new c(this,i)},h.gt=function(t){for(var e=this._compare,n=this.root,i=[],o=0;n;){var r=e(t,n.key);i.push(n),r<0&&(o=i.length),n=r<0?n.left:n.right}return i.length=o,new c(this,i)},h.lt=function(t){for(var e=this._compare,n=this.root,i=[],o=0;n;){var r=e(t,n.key);i.push(n),r>0&&(o=i.length),n=r<=0?n.left:n.right}return i.length=o,new c(this,i)},h.le=function(t){for(var e=this._compare,n=this.root,i=[],o=0;n;){var r=e(t,n.key);i.push(n),r>=0&&(o=i.length),n=r<0?n.left:n.right}return i.length=o,new c(this,i)},h.find=function(t){for(var e=this._compare,n=this.root,i=[];n;){var o=e(t,n.key);if(i.push(n),0===o)return new c(this,i);n=o<=0?n.left:n.right}return new c(this,[])},h.remove=function(t){var e=this.find(t);return e?e.remove():this},h.get=function(t){for(var e=this._compare,n=this.root;n;){var i=e(t,n.key);if(0===i)return n.value;n=i<=0?n.left:n.right}};var p=c.prototype;function f(t,e){t.key=e.key,t.value=e.value,t.left=e.left,t.right=e.right,t._color=e._color,t._count=e._count}function d(t,e){return t<e?-1:t>e?1:0}Object.defineProperty(p,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(p,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),p.clone=function(){return new c(this.tree,this._stack.slice())},p.remove=function(){var t=this._stack;if(0===t.length)return this.tree;var e=new Array(t.length),n=t[t.length-1];e[e.length-1]=new r(n._color,n.key,n.value,n.left,n.right,n._count);for(var h=t.length-2;h>=0;--h){(n=t[h]).left===t[h+1]?e[h]=new r(n._color,n.key,n.value,e[h+1],n.right,n._count):e[h]=new r(n._color,n.key,n.value,n.left,e[h+1],n._count)}if((n=e[e.length-1]).left&&n.right){var c=e.length;for(n=n.left;n.right;)e.push(n),n=n.right;var p=e[c-1];e.push(new r(n._color,p.key,p.value,n.left,n.right,n._count)),e[c-1].key=n.key,e[c-1].value=n.value;for(h=e.length-2;h>=c;--h)n=e[h],e[h]=new r(n._color,n.key,n.value,n.left,e[h+1],n._count);e[c-1].left=e[c]}if((n=e[e.length-1])._color===i){var d=e[e.length-2];d.left===n?d.left=null:d.right===n&&(d.right=null),e.pop();for(h=0;h<e.length;++h)e[h]._count--;return new l(this.tree._compare,e[0])}if(n.left||n.right){n.left?f(n,n.left):n.right&&f(n,n.right),n._color=o;for(h=0;h<e.length-1;++h)e[h]._count--;return new l(this.tree._compare,e[0])}if(1===e.length)return new l(this.tree._compare,null);for(h=0;h<e.length;++h)e[h]._count--;var g=e[e.length-2];return function(t){for(var e,n,r,l,h=t.length-1;h>=0;--h){if(e=t[h],0===h)return void(e._color=o);if((n=t[h-1]).left===e){if((r=n.right).right&&r.right._color===i)return l=(r=n.right=a(r)).right=a(r.right),n.right=r.left,r.left=n,r.right=l,r._color=n._color,e._color=o,n._color=o,l._color=o,u(n),u(r),h>1&&((c=t[h-2]).left===n?c.left=r:c.right=r),void(t[h-1]=r);if(r.left&&r.left._color===i)return l=(r=n.right=a(r)).left=a(r.left),n.right=l.left,r.left=l.right,l.left=n,l.right=r,l._color=n._color,n._color=o,r._color=o,e._color=o,u(n),u(r),u(l),h>1&&((c=t[h-2]).left===n?c.left=l:c.right=l),void(t[h-1]=l);if(r._color===o){if(n._color===i)return n._color=o,void(n.right=s(i,r));n.right=s(i,r);continue}r=a(r),n.right=r.left,r.left=n,r._color=n._color,n._color=i,u(n),u(r),h>1&&((c=t[h-2]).left===n?c.left=r:c.right=r),t[h-1]=r,t[h]=n,h+1<t.length?t[h+1]=e:t.push(e),h+=2}else{if((r=n.left).left&&r.left._color===i)return l=(r=n.left=a(r)).left=a(r.left),n.left=r.right,r.right=n,r.left=l,r._color=n._color,e._color=o,n._color=o,l._color=o,u(n),u(r),h>1&&((c=t[h-2]).right===n?c.right=r:c.left=r),void(t[h-1]=r);if(r.right&&r.right._color===i)return l=(r=n.left=a(r)).right=a(r.right),n.left=l.right,r.right=l.left,l.right=n,l.left=r,l._color=n._color,n._color=o,r._color=o,e._color=o,u(n),u(r),u(l),h>1&&((c=t[h-2]).right===n?c.right=l:c.left=l),void(t[h-1]=l);if(r._color===o){if(n._color===i)return n._color=o,void(n.left=s(i,r));n.left=s(i,r);continue}var c;r=a(r),n.left=r.right,r.right=n,r._color=n._color,n._color=i,u(n),u(r),h>1&&((c=t[h-2]).right===n?c.right=r:c.left=r),t[h-1]=r,t[h]=n,h+1<t.length?t[h+1]=e:t.push(e),h+=2}}}(e),g.left===n?g.left=null:g.right=null,new l(this.tree._compare,e[0])},Object.defineProperty(p,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(p,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(p,"index",{get:function(){var t=0,e=this._stack;if(0===e.length){var n=this.tree.root;return n?n._count:0}e[e.length-1].left&&(t=e[e.length-1].left._count);for(var i=e.length-2;i>=0;--i)e[i+1]===e[i].right&&(++t,e[i].left&&(t+=e[i].left._count));return t},enumerable:!0}),p.next=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.right)for(e=e.right;e;)t.push(e),e=e.left;else for(t.pop();t.length>0&&t[t.length-1].right===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(p,"hasNext",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].right)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].left===t[e])return!0;return!1}}),p.update=function(t){var e=this._stack;if(0===e.length)throw new Error("Can't update empty node!");var n=new Array(e.length),i=e[e.length-1];n[n.length-1]=new r(i._color,i.key,t,i.left,i.right,i._count);for(var o=e.length-2;o>=0;--o)(i=e[o]).left===e[o+1]?n[o]=new r(i._color,i.key,i.value,n[o+1],i.right,i._count):n[o]=new r(i._color,i.key,i.value,i.left,n[o+1],i._count);return new l(this.tree._compare,n[0])},p.prev=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.left)for(e=e.left;e;)t.push(e),e=e.right;else for(t.pop();t.length>0&&t[t.length-1].left===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(p,"hasPrev",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].left)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].right===t[e])return!0;return!1}})},function(t,e,n){!function(){"use strict";var e=Math.PI,n=Math.sin,i=Math.cos,o=Math.tan,r=Math.asin,a=Math.atan2,s=Math.acos,u=e/180,l=864e5,h=2440588,c=2451545;function p(t){return new Date((t+.5-h)*l)}function f(t){return function(t){return t.valueOf()/l-.5+h}(t)-c}var d=23.4397*u;function g(t,e){return a(n(t)*i(d)-o(e)*n(d),i(t))}function m(t,e){return r(n(e)*i(d)+i(e)*n(d)*n(t))}function y(t,e,r){return a(n(t),i(t)*n(e)-o(r)*i(e))}function v(t,e,o){return r(n(e)*n(o)+i(e)*i(o)*i(t))}function x(t,e){return u*(280.16+360.9856235*t)-e}function A(t){return u*(357.5291+.98560028*t)}function M(t){return t+u*(1.9148*n(t)+.02*n(2*t)+3e-4*n(3*t))+102.9372*u+e}function w(t){var e=M(A(t));return{dec:m(e,0),ra:g(e,0)}}var T={getPosition:function(t,e,n){var i=u*-n,o=u*e,r=f(t),a=w(r),s=x(r,i)-a.ra;return{azimuth:y(s,o,a.dec),altitude:v(s,o,a.dec)}}},b=T.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];T.addTime=function(t,e,n){b.push([t,e,n])};var _=9e-4;function S(t,n,i){return _+(t+n)/(2*e)+i}function C(t,e,i){return c+t+.0053*n(e)-.0069*n(2*i)}function E(t,e,o,r,a,u,l){return C(S(function(t,e,o){return s((n(t)-n(e)*n(o))/(i(e)*i(o)))}(t,o,r),e,a),u,l)}function R(t){var e=u*(134.963+13.064993*t),o=u*(93.272+13.22935*t),r=u*(218.316+13.176396*t)+6.289*u*n(e),a=5.128*u*n(o),s=385001-20905*i(e);return{ra:g(r,a),dec:m(r,a),dist:s}}function I(t,e){return new Date(t.valueOf()+e*l/24)}T.getTimes=function(t,n,i){var o,r,a,s,l,h=u*-i,c=u*n,d=function(t,n){return Math.round(t-_-n/(2*e))}(f(t),h),g=S(0,h,d),y=A(g),v=M(y),x=m(v,0),w=C(g,y,v),T={solarNoon:p(w),nadir:p(w-.5)};for(o=0,r=b.length;o<r;o+=1)l=w-((s=E((a=b[o])[0]*u,h,c,x,d,y,v))-w),T[a[1]]=p(l),T[a[2]]=p(s);return T},T.getMoonPosition=function(t,e,r){var s=u*-r,l=u*e,h=f(t),c=R(h),p=x(h,s)-c.ra,d=v(p,l,c.dec),g=a(n(p),o(l)*i(c.dec)-n(c.dec)*i(p));return d+=function(t){return t<0&&(t=0),2967e-7/Math.tan(t+.00312536/(t+.08901179))}(d),{azimuth:y(p,l,c.dec),altitude:d,distance:c.dist,parallacticAngle:g}},T.getMoonIllumination=function(t){var e=f(t||new Date),o=w(e),r=R(e),u=s(n(o.dec)*n(r.dec)+i(o.dec)*i(r.dec)*i(o.ra-r.ra)),l=a(149598e3*n(u),r.dist-149598e3*i(u)),h=a(i(o.dec)*n(o.ra-r.ra),n(o.dec)*i(r.dec)-i(o.dec)*n(r.dec)*i(o.ra-r.ra));return{fraction:(1+i(l))/2,phase:.5+.5*l*(h<0?-1:1)/Math.PI,angle:h}},T.getMoonTimes=function(t,e,n,i){var o=new Date(t);i?o.setUTCHours(0,0,0,0):o.setHours(0,0,0,0);for(var r,a,s,l,h,c,p,f,d,g,m,y,v,x=.133*u,A=T.getMoonPosition(o,e,n).altitude-x,M=1;M<=24&&(r=T.getMoonPosition(I(o,M),e,n).altitude-x,f=((h=(A+(a=T.getMoonPosition(I(o,M+1),e,n).altitude-x))/2-r)*(p=-(c=(a-A)/2)/(2*h))+c)*p+r,g=0,(d=c*c-4*h*r)>=0&&(m=p-(v=Math.sqrt(d)/(2*Math.abs(h))),y=p+v,Math.abs(m)<=1&&g++,Math.abs(y)<=1&&g++,m<-1&&(m=y)),1===g?A<0?s=M+m:l=M+m:2===g&&(s=M+(f<0?y:m),l=M+(f<0?m:y)),!s||!l);M+=2)A=a;var w={};return s&&(w.rise=I(o,s)),l&&(w.set=I(o,l)),s||l||(w[f>0?"alwaysUp":"alwaysDown"]=!0),w},t.exports=T}()},function(t,e,n){t.exports=function(){"use strict";function t(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function e(t,e){return t<e?-1:t>e?1:0}return function(n,i,o,r,a){!function e(n,i,o,r,a){for(;r>o;){if(r-o>600){var s=r-o+1,u=i-o+1,l=Math.log(s),h=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*h*(s-h)/s)*(u-s/2<0?-1:1),p=Math.max(o,Math.floor(i-u*h/s+c)),f=Math.min(r,Math.floor(i+(s-u)*h/s+c));e(n,i,p,f,a)}var d=n[i],g=o,m=r;for(t(n,o,i),a(n[r],d)>0&&t(n,o,r);g<m;){for(t(n,g,m),g++,m--;a(n[g],d)<0;)g++;for(;a(n[m],d)>0;)m--}0===a(n[o],d)?t(n,o,m):t(n,++m,r),m<=i&&(o=m+1),i<=m&&(r=m-1)}}(n,i,o||0,r||n.length-1,a||e)}}()},function(t,e,n){"use strict";n.r(e);var i,o,r,a=function(){function t(){}return Object.defineProperty(t,"baseMapUrl",{get:function(){return"https://api.map4d.vn/v2/api/tile/{z}/{x}/{y}"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"baseModelRequestUrl",{get:function(){return"https://api.map4d.vn/v2/api/Model/objs/{s}?key={k}"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"baseTextureRequestUrl",{get:function(){return"https://api.map4d.vn/v2/api/Model/images/{s}?key={k}"},enumerable:!0,configurable:!0}),t.baseTileSize=256,t.minLatitude=-85.0511287798066,t.maxLatitude=85.0511287798066,t.maxLongitude=180,t.minLongitude=-180,t.maxDegrees=360,t.radiusEarthMeters=6378137,t.halfEarthCircumFerenceInMeter=t.radiusEarthMeters*Math.PI,t.earthCircumFerenceInMeter=2*t.halfEarthCircumFerenceInMeter,t.tileCacheSize=512,t.rasterLayerOrder=1,t.polygonAnnotationLayerOrder=100,t.circleAnnotationLayerOrder=101,t.polylineAnnotationLayerOrder=102,t.buildingLayerOrder=103,t.markerAnnotationLayerOrder=104,t.flingMinVelocity=-1e4,t.flingMaxVelocity=1e4,t.flingTimeConstant=150,t.flingSpeedMultiply=15,t.zoomSpeedMouseWheel=15,t.minDurationFlyTo=1e3,t.maxDurationFlyTo=13e3,t.maxBearingAngle=720,t.defaultMinZoom=0,t.defaultMinZoom3d=17,t.defaultMaxZoom=22,t.defaultMaxNativeZoom=19,t.tileExtend=4096,t.defaultAnimationDuration=300,t.defaultFlyZoom=17,t.defaultMap2dUrl="2d/{z}/{x}/{y}.png",t.defaultMap3dUrl="3d/{z}/{x}/{y}.png",t.minTilt=0,t.maxTilt=60,t.minTimeMoving=150,t.minTimeDoubleZoom=500,t.minTimeSpanTo=500,t.maxTimeSpanTo=4e3,t.metersPerPixelAtLatitude=10,t.mapBackgroundColor2D="#f2efe9",t.mapBackgroundColor3D="#e1e1e1",t}(),s=function(){function t(){}return t.rad2Deg=180/Math.PI,t.deg2Rad=Math.PI/180,t.epsilon=1e-6,t}(),u=function(){function t(){}return t.fov=30*s.deg2Rad,t.nearPlane=.1,t.farPlane=1e3,t.height=15.5,t}(),l=function(){function t(){}return t.numTrianglesOnRoundCap=6,t.numTrianglesOnRoundJoin=5,t.numTrianglesPerCircle=50,t}(),h=function(){function t(){}return t.vietNamlnglatBounds=[{lng:102.1234130859375,lat:22.405950148725722},{lng:102.74414062499999,lat:21.002471054356725},{lng:104.853515625,lat:20.3034175184893},{lng:103.84277343749999,lat:19.476950206488414},{lng:107.314453125,lat:15.623036831528264},{lng:107.4462890625,lat:12.382928338487396},{lng:106.69921875,lat:12.146745814539685},{lng:104.52392578125,lat:10.455401826918397},{lng:104.67773437499999,lat:9.96885060854611},{lng:104.6337890625,lat:8.450638800331001},{lng:108.720703125,lat:10.833305983642491},{lng:109.51171875,lat:12.768946439455956},{lng:108.78662109375,lat:15.580710739162123},{lng:105.732421875,lat:19.145168196205297},{lng:108.10546875,lat:21.47351753334985},{lng:105.27099609375,lat:23.165613663312595},{lng:102.1234130859375,lat:22.405950148725722}],t.targetOfCity=[{lat:21.025608,lng:105.851686},{lat:16.071825,lng:108.223533},{lat:10.769935,lng:106.709608}],t}(),c=function(){function t(){}return t.rainFrequency=.004,t.rainParticleRotation=-25,t.snowFrequency=.004,t}(),p=function(){function t(t,e){this._lat=t,this._lng=e}return t.prototype.equals=function(t){return this._lat==t._lat&&this._lng==t._lng},t.prototype.lat=function(){return this._lat},t.prototype.lng=function(){return this._lng},t.prototype.toString=function(){return"("+this._lat+", "+this._lng+")"},t.convert=function(e){if(e instanceof t)return e;if(Array.isArray(e)&&2===e.length)return new t(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e&&"lat"in e&&"lng"in e)return new t(Number(e.lat),Number(e.lng));throw new Error("`ILngLat` argument must be specified as a LngLat instance, an object {lat: <lat>, lng: <lng>}, or an array of [<lat>, <lng>]")},t.prototype.distanceTo=function(e){var n=t.convert(e),i=s.deg2Rad*this._lat,o=s.deg2Rad*this._lng,r=s.deg2Rad*n.lat(),u=s.deg2Rad*n.lng(),l=Math.sin((r-i)/2),h=Math.sin((u-o)/2);return 2*a.radiusEarthMeters*Math.asin(Math.sqrt(l*l+Math.cos(i)*Math.cos(r)*h*h))},t.prototype.normalize=function(){var e=this.lat()>0?-1:1,n=(this.lat()-90*e)%180+90*e;return e=this.lng()>0?-1:1,new t(n,(this.lng()-180*e)%380+180*e)},t}(),f=function(){function t(){}return t.clamp=function(t,e,n){return t<e?e:t>n?n:t},t}(),d=n(1),g=function(){function t(t,e){this.x=t,this.y=e}return t.convertPointToMBPoint=function(t){return new d(t.x,t.y)},t.prototype.equals=function(t){return this.x==t.x&&this.y==t.y},t.prototype.toString=function(){return"("+String(this.x)+","+String(this.y)+")"},t.convert=function(e){if(e instanceof t)return e;if(Array.isArray(e)&&2===e.length)return new t(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e&&"x"in e&&"y"in e)return new t(Number(e.x),Number(e.y));throw new Error("`IPoint` argument must be specified as a Point instance, an object {x: <x>, y: <y>}, or an array of [<x>, <y>]")},t}(),m=function(){function t(){}return t.pointIntersectsBox=function(t,e){return t.x<=e.max.x&&t.y<=e.max.y&&t.x>=e.min.x&&t.y>=e.min.y},t.polygonIntersectsPolygon=function(e,n){for(var i=0;i<e.length;i++)if(t.polygonContainsPoint(n,e[i]))return!0;for(i=0;i<n.length;i++)if(t.polygonContainsPoint(e,n[i]))return!0;return!!t.lineIntersectsLine(e,n)},t.multiPolygonIntersectsBufferedPoint=function(e,n,i){for(var o=0;o<e.length;o++){var r=e[o];if(t.polygonContainsPoint(r,n))return!0;if(t.pointIntersectsBufferedLine(n,r,i))return!0}return!1},t.multiPolygonIntersectsBufferedMultiPoint=function(e,n,i){for(var o=0;o<n.length;o++)for(var r=n[o],a=0;a<r.length;a++)if(t.multiPolygonIntersectsBufferedPoint(e,r[a],i))return!0;return!1},t.multiPolygonIntersectsMultiPolygon=function(e,n){if(1===e.length&&1===e[0].length)return t.multiPolygonContainsPoint(n,e[0][0]);for(var i=0;i<n.length;i++)for(var o=n[i],r=0;r<o.length;r++)if(t.multiPolygonContainsPoint(e,o[r]))return!0;for(var a=0;a<e.length;a++){for(var s=e[a],u=0;u<s.length;u++)if(t.multiPolygonContainsPoint(n,s[u]))return!0;for(var l=0;l<n.length;l++)if(t.lineIntersectsLine(s,n[l]))return!0}return!1},t.multiPolygonIntersectsBufferedMultiLine=function(e,n,i){for(var o=0;o<n.length;o++)for(var r=n[o],a=0;a<e.length;a++){var s=e[a];if(s.length>=3)for(var u=0;u<r.length;u++)if(t.polygonContainsPoint(s,r[u]))return!0;if(t.lineIntersectsBufferedLine(s,r,i))return!0}return!1},t.lineIntersectsBufferedLine=function(e,n,i){if(e.length>1){if(t.lineIntersectsLine(e,n))return!0;for(var o=0;o<n.length;o++)if(t.pointIntersectsBufferedLine(n[o],e,i))return!0}for(var r=0;r<e.length;r++)if(t.pointIntersectsBufferedLine(e[r],n,i))return!0;return!1},t.lineIntersectsLine=function(e,n){if(0===e.length||0===n.length)return!1;for(var i=0;i<e.length-1;i++)for(var o=e[i],r=e[i+1],a=0;a<n.length-1;a++){var s=n[a],u=n[a+1];if(t.lineSegmentIntersectsLineSegment(o,r,s,u))return!0}return!1},t.lineSegmentIntersectsLineSegment=function(e,n,i,o){return t.isCounterClockwise(e,i,o)!==t.isCounterClockwise(n,i,o)&&t.isCounterClockwise(e,n,i)!==t.isCounterClockwise(e,n,o)},t.pointIntersectsBufferedMultiLine=function(e,n,i){return n.some(function(n){return t.pointIntersectsBufferedLine(e,n,i)})},t.pointIntersectsBufferedLine=function(e,n,i){var o=i*i,r=g.convertPointToMBPoint(e);if(1===n.length)return r.distSqr(n[0])<o;for(var a=1;a<n.length;a++){var s=n[a-1],u=n[a];if(t.distToSegmentSquared(e,s,u)<o)return!0}return!1},t.pointIntersectsCircle=function(t,e,n){return g.convertPointToMBPoint(t).distSqr(e)<=n*n},t.multiPolygonContainsPoint=function(t,e){for(var n,i,o,r=!1,a=0;a<t.length;a++)for(var s=0,u=(n=t[a]).length-1;s<n.length;u=s++)i=n[s],o=n[u],i.y>e.y!=o.y>e.y&&e.x<(o.x-i.x)*(e.y-i.y)/(o.y-i.y)+i.x&&(r=!r);return r},t.polygonContainsPoint=function(t,e){for(var n=!1,i=0,o=t.length-1;i<t.length;o=i++){var r=t[i],a=t[o];r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(n=!n)}return n},t.isCounterClockwise=function(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)},t.distToSegmentSquared=function(t,e,n){var i=g.convertPointToMBPoint(e),o=g.convertPointToMBPoint(n),r=g.convertPointToMBPoint(t),a=i.distSqr(o);if(0===a)return r.distSqr(i);var s=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/a;return s<0?r.distSqr(i):s>1?r.distSqr(o):r.distSqr(o.sub(i)._mult(s)._add(i))},t}(),y=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y},enumerable:!0,configurable:!0}),t.prototype.normalize=function(){var e=this.length,n=0,i=0;return e>0&&(n=this.x/e,i=this.y/e),new t(n,i)},t.prototype.set=function(t){this.x=t.x,this.y=t.y},t.prototype.invert=function(){return new t(-this.x,-this.y)},t.prototype.rotate90=function(){return new t(this.y,-this.x)},t.prototype.add=function(e){return new t(e.x+this.x,e.y+this.y)},t.prototype.subtract=function(e){return e?new t(this.x-e.x,this.y-e.y):this.clone()},t.prototype.multiply=function(e){return new t(e*this.x,e*this.y)},t.prototype.rotateBy=function(e){var n=Math.cos(e*Math.PI/180),i=Math.sin(e*Math.PI/180);return new t(this.x*n-this.y*i,this.x*i+this.y*n)},t.prototype.rotateByRadian=function(e){var n=Math.cos(e),i=Math.sin(e);return new t(this.x*n-this.y*i,this.x*i+this.y*n)},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.dot=function(t){return t.x*this.x+t.y*this.y},t.perp=function(e,n){return new t(n[1]-e[1],e[0]-n[0])},t.neg=function(e){return new t(-e.x,-e.y)},t}(),v=function(){function t(t,e,n,i){void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=null),this._target=null==t?null:p.convert(t),this._tilt=e,this._bearing=n,this._zoom=i}return t.prototype.setTarget=function(t){this._target=p.convert(t)},t.prototype.setTilt=function(t){this._tilt=t},t.prototype.setBearing=function(t){this._bearing=t},t.prototype.setZoom=function(t){this._zoom=t},t.prototype.getTarget=function(){return this._target},t.prototype.getTilt=function(){return this._tilt},t.prototype.getBearing=function(){return this._bearing},t.prototype.getZoom=function(){return this._zoom},t.convert=function(e){return e instanceof t?e:new t(e.target,e.tilt,e.bearing,e.zoom)},t}(),x=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n}return t.prototype.clone=function(){return new t(this.x,this.y,this.z)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:!0,configurable:!0}),t.prototype.normalize=function(){var e=this.length,n=0,i=0,o=0;return e>0&&(n=this.x/e,i=this.y/e,o=this.z/e),new t(n,i,o)},t.prototype.set=function(t){this.x=t.x,this.y=t.y,this.z=t.z},t.prototype.invert=function(){return new t(-this.x,-this.y,-this.z)},t.prototype.rotate90=function(){return new t(this.y,-this.x,this.z)},t.prototype.add=function(e){return new t(e.x+this.x,e.y+this.y,e.z+this.z)},t.prototype.subtract=function(e){return e?new t(this.x-e.x,this.y-e.y,this.z-e.z):this.clone()},t.prototype.multiply=function(e){return new t(e*this.x,e*this.y,e*this.z)},t.prototype.rotateBy=function(e){var n=Math.cos(e*Math.PI/180),i=Math.sin(e*Math.PI/180);return new t(this.x*n-this.y*i,this.x*i+this.y*n)},t.prototype.cross=function(e){return new t(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},t.prototype.dot=function(t){return t.x*this.x+t.y*this.y+t.z*this.z},t.perp=function(e,n){return new t(n[1]-e[1],e[0]-n[0])},t.neg=function(e){return new t(-e.x,-e.y,-e.z)},t}(),A=function(){function t(){}return t.projectInternal=function(t,e){var n=f.clamp(t.lat(),a.minLatitude,a.maxLatitude);return new y(a.maxLongitude+t.lng(),a.maxLongitude-s.rad2Deg*Math.log(Math.tan(Math.PI/4+n*Math.PI/a.maxDegrees))).multiply(e/a.maxDegrees)},t.worldSize=function(t){return t*T.getTileSize()},t.getMetersPerPixelAtLatitude=function(t,e){var n=Math.pow(2,e),i=f.clamp(t,a.minLatitude,a.maxLatitude);return Math.cos(i*s.deg2Rad)*Math.PI*2*a.radiusEarthMeters/this.worldSize(n)},t.convertToMeterFromLatLng=function(t){var e=f.clamp(t.lat(),a.minLatitude,a.maxLatitude),n=t.lng(),i=1-1e-15,o=f.clamp(Math.sin(s.deg2Rad*e),-i,i),r=a.radiusEarthMeters*n*s.deg2Rad,u=.5*a.radiusEarthMeters*Math.log((1+o)/(1-o));return new y(u,r)},t.convertToLatLngFromMeter=function(t){var e=(2*Math.atan(Math.exp(t.x/a.radiusEarthMeters))-Math.PI/2)*s.rad2Deg,n=t.y*s.rad2Deg/a.radiusEarthMeters;return new p(e,n)},t.projectScale=function(t,e){return this.projectInternal(t,this.worldSize(e))},t.projectZoom=function(t,e){return this.projectInternal(t,1<<e)},t.unproject=function(t,e){var n=t.multiply(a.maxDegrees/this.worldSize(e));return new p(a.maxDegrees/Math.PI*Math.atan(Math.exp((a.maxLongitude-n.y)*s.deg2Rad))-90,n.x-a.maxLongitude)},t}(),M=function(){function t(t,e){t&&(e?(this.southwest=t instanceof p?new p(t.lat(),t.lng()):p.convert(t),this.northeast=e instanceof p?new p(e.lat(),e.lng()):p.convert(e)):4===t.length?(this.southwest=p.convert([t[0],t[1]]),this.northeast=p.convert([t[2],t[3]])):(this.southwest=t[0]instanceof p?new p(t[0].lat(),t[0].lng()):p.convert(t[0]),this.northeast=t[1]instanceof p?new p(t[1].lat(),t[1].lng()):p.convert(t[1])))}return t.prototype.extend=function(t){var e=p.convert(t);return this.southwest&&this.northeast?(this.southwest=new p(Math.min(e.lat(),this.southwest.lat()),Math.min(this.southwest.lng(),e.lng())),this.northeast=new p(Math.max(e.lat(),this.northeast.lat()),Math.max(this.northeast.lng(),e.lng()))):(this.southwest=new p(e.lat(),e.lng()),this.northeast=new p(e.lat(),e.lng())),this},t.prototype.getCenter=function(){return new p((this.northeast.lat()+this.southwest.lat())/2,(this.northeast.lng()+this.southwest.lng())/2)},t.prototype.getNortheast=function(){return this.northeast},t.prototype.getSouthwest=function(){return this.southwest},t.convert=function(e){return e instanceof t?e:new t(e)},t}(),w=function(){function t(){}return t.lat=function(t,e){var n=Math.PI-2*Math.PI*e/Math.pow(2,t);return s.rad2Deg*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))},t.lon=function(t,e){return e/Math.pow(2,t)*a.maxDegrees-a.maxLongitude},t.screenCoordinateToNDC=function(t,e){var n=2*t.x/e.x-1,i=1-2*t.y/e.y;return new y(n,i)},t.NDCCoordinateToScreen=function(t,e){var n=e.x*(1+t.x)/2,i=e.y*(1-t.y)/2;return new y(n,i)},t.screenCoordinateToLatLng=function(t,e){return this.screenCoordinateToLatLngZoom(t,e,e.getZoom())},t.screenCoordinateToLatLngZoom=function(e,n,i,o){void 0===o&&(o=!1);var r=n.getScreenSize(),a=o?n.getInverseViewProjectionMatrixWithoutTilt():n.getInverseViewProjectionMatrix(),s=Math.pow(2,i),u=t.screenCoordinateToNDC(e,r),l=a.transform(new x(u.x,u.y,-1),1),h=a.transform(new x(u.x,u.y,1),1),c=h.z-l.z,p=l.x-(h.x-l.x)*l.z/c,f=l.y-(h.y-l.y)*l.z/c,d=n.getTarget(),g=Math.pow(2,i),m=A.projectScale(d,g);return A.unproject(new y(p+m.x,m.y-f),s)},t.pixelCoordinateToCameraCoordinate=function(e,n){return t.pixelCoordinateToCameraCoordinateZoom(e,n,n.getZoom())},t.pixelCoordinateToCameraCoordinateZoom=function(t,e,n){var i=Math.pow(2,n),o=A.worldSize(i),r=A.projectScale(e.getTarget(),i);r.x=r.x-o/2,r.y=o/2-r.y;var a=t;return a.x=a.x-o/2,a.y=o/2-a.y,a.x-=r.x,a.y-=r.y,a},t.latLngToScreenCoordinate=function(t,e,n){return this.latLngToScreenCoordinateZoom(t,e,n,n.getZoom())},t.latLngToScreenCoordinateZoom=function(t,e,n,i,o){void 0===o&&(o=!1),i<0&&(i=n.getZoom());var r=Math.pow(2,i),a=A.projectScale(t,r),s=this.pixelCoordinateToCameraCoordinateZoom(a,n,i),u=new x(s.x,s.y,e),l=o?n.getViewProjectionMatrixWithoutTilt().transform(u,1):n.getViewProjectionMatrix().transform(u,1),h=n.getScreenSize(),c=(l.x+1)*h.x/2,p=h.y-(l.y+1)*h.y/2;return new y(c,p)},t.tileCoordinateToLatLngBounds=function(e){var n=e.getX(),i=e.getY(),o=e.getZoom(),r=new p(t.lat(o,i+1),t.lon(o,n)),a=new p(t.lat(o,i),t.lon(o,n+1));return new M(r,a)},t.pixelCoordinateToVectorTileCoordinate=function(t,e,n,i){var o=T.getTileSize()*i,r=t.x-e*o,a=t.y-n*o;return new y(r=r/o-.5,a=.5-a/o)},t.getElevationPixelFromMeter=function(e,n){return n.is3dMode()?t.getPixelFromMeter(e,n):0},t.getPixelFromMeter=function(t,e){return t/A.getMetersPerPixelAtLatitude(e.getTarget().lat(),e.getZoom())},t}(),T=function(){function t(){}return Object.defineProperty(t,"pixelScale",{get:function(){return t._pixelScale},set:function(e){t._pixelScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"resourceScale",{get:function(){return Math.round(t._pixelScale)},enumerable:!0,configurable:!0}),t.getTileSize=function(){return a.baseTileSize*t.pixelScale},t.extendOptions=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0,o=e;i<o.length;i++){var r=o[i];for(var a in r)t[a]=r[a]}return t},t.pointToPixel=function(e){return new g(e.x*t.pixelScale,e.y*t.pixelScale)},t.pixelToPoint=function(e){return new g(e.x/t.pixelScale,e.y/t.pixelScale)},t.getTimePanTo=function(t,e,n){var i=t.distanceTo(e)/500;return i*=n<10?.01:n<14?.5:1.5,i=f.clamp(i,a.minTimeSpanTo,a.maxTimeSpanTo),Math.round(i)},t.getNearestByLocations=function(t){for(var e=[],n=h.targetOfCity,i=0;i<n.length;i++){var o=n[i];e.push(new p(o.lat,o.lng))}var r=e.length;if(null==e||r<=0)return t;var a=Number.POSITIVE_INFINITY,s=t;for(i=0;i<r;i++){var u=new p(e[i].lat(),e[i].lng()),l=u.distanceTo(t);l<=a&&(s=u,a=l)}return s},t.insideOfVietNam=function(t){if(null==t)return!1;for(var e=h.vietNamlnglatBounds,n=[],i=0;i<e.length;i++){var o=new g(e[i].lat,e[i].lng);n.push(o)}return this.isPolygonConstains(n,t)},t.isPolygonConstains=function(t,e){var n=new g(e.lat(),e.lng());return m.polygonIntersectsPolygon([n],t)},t.getCameraPositionForLatLngBounds=function(t,e,n,i){var o=t.getSouthwest(),r=t.getNortheast();if(Math.abs(o.lat()-r.lat())<s.epsilon&&Math.abs(o.lng()-r.lng())<s.epsilon){var u=n.getCamera();return new v(o,u.getTilt(),u.getBearing(),i.getMaxZoom())}var l=new p(r.lat(),o.lng()),h=new p(o.lat(),r.lng()),c=n.getScreenSize(),d=w.latLngToScreenCoordinateZoom(o,0,n,a.defaultMaxZoom,!0),g=w.latLngToScreenCoordinateZoom(r,0,n,a.defaultMaxZoom,!0),m=w.latLngToScreenCoordinateZoom(l,0,n,a.defaultMaxZoom,!0),x=w.latLngToScreenCoordinateZoom(h,0,n,a.defaultMaxZoom,!0),A=Math.min(d.x,g.x,m.x,x.x),M=Math.max(d.x,g.x,m.x,x.x),T=Math.min(d.y,g.y,m.y,x.y),b=Math.max(d.y,g.y,m.y,x.y),_=A+e.left||0,S=M-e.right||0,C=T-e.top||0,E=b+e.bottom||0,R=w.screenCoordinateToLatLngZoom(new y((_+S)/2,(C+E)/2),n,a.defaultMaxZoom,!0),I=S-_,L=E-C,O=c.x/(I<=0?1:I),D=c.y/(L<=0?1:L);O-=(e.left+e.right)/(I<=0?1:I),D-=(e.top+e.bottom)/(L<=0?1:L);var P=a.defaultMaxZoom+Math.log2(Math.min(O,D));P=f.clamp(P,i.getMinZoom(),i.getMaxZoom()),P=Math.floor(P);var B=n.getCamera();return new v(R,B.getTilt(),B.getBearing(),P)},t._pixelScale=1,t}(),b=function(){function t(){}return t.get=function(e){var n=f.clamp(T.resourceScale,1,3);return t.images[e][n-1]},t.markerDefault="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAA9hAAAPYQGoP6dpAAAF8WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE5LTAxLTIyVDE3OjI0OjUzKzA3OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE5LTAxLTIyVDE3OjI0OjUzKzA3OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOS0wMS0yMlQxNzoyNDo1MyswNzowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxZDg1NGY4Yi1lYzEzLTQzZjktOWEwMC02OGYwYzRkNWYyODUiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDpiODVkZWE1ZC0yYWNlLWExNDktYmI5MS01NjVjNGY5ZDdkZTAiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo4M2MwZmJlYS1iODZjLTQwMDItYjcxOC1iYTI3M2MzMmY5NTgiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjgzYzBmYmVhLWI4NmMtNDAwMi1iNzE4LWJhMjczYzMyZjk1OCIgc3RFdnQ6d2hlbj0iMjAxOS0wMS0yMlQxNzoyNDo1MyswNzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoxZDg1NGY4Yi1lYzEzLTQzZjktOWEwMC02OGYwYzRkNWYyODUiIHN0RXZ0OndoZW49IjIwMTktMDEtMjJUMTc6MjQ6NTMrMDc6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6UtMbgAAAC9UlEQVRYhcWXTYtcRRSGn7equ5OQheDCqBBcmJWoIEIMBoKMI6Kg/gFxI8YvBDWgLiKJ+UAiYsCFro0LxY2I4EdiJgYC0Y0wGDELESMEiVmIMmqc7qrXRZvEHqu67+0W5kAt+pzT5336nqrTt2Sb1bSwqupApxY4f+dmDCQlQgANAkEiw5zQPZJvN94EWgP+A8IZQjqBwxGZw9ngmMkZZOg7s3Hhq+YABbsV2C8xD47DxumfkK4AX0MOW4AdwDFgJ3ByUtGmLXiaoOMWdwNxQq4Mc4gjwDP/B8BzMceDgvVNSC9RwPqYw2vA87MAzHWIL017Tgx0iHuBO6YB6EnsB9ZOqX8RoxvQAWBdKVrdhClwXzRbqmXRr8BHOH8vsQl0F3BlKVfS5rXuzAMfNgaQfe/lXb4ihk8NiA9G8uJFX8Y3Cb0ruKEILO4vAVRbEOGWSmiQc3gcWFzh/zo6PQL8WaG+reSuAhhtrIQWbX0RknEaPqFOyvRSJmROYp8q63NtyT9uEJVj5pfQzQOl4QcHkQiAGPT6Dsvxt3Lj6Jac407Bz0WvuBmoPZ2rJW6sxH5qBWD720roKjL7+O8v6sV+91VgQ7Ee+qbkr7bADguSH6iEHzJcL3gdOA9sMDwMzFfrZZ1oBRCUDkP4ndoIFluNtmKwKl2/bEvgj4s6Y750WvbxSZWbmK0F4HQrgBxEChwE0qwAcn4zkIuxMXMADEcNn82o/6VD+NyhLDXp39BZPjCDeN/k3cCFWkKT94Fjtg5NJW/eAj4Zl1IF6CZfWtHpRSqDpK6tc3/lNfuW0zqWU4/l1GsHsMJ+NH6hJcAe4MykvDav5YfA7zUStz4A3miSO+YYji4Nz8Wz4B8m1PwO9KQMvdAfWa0AKnZWicds1Xb1hZzDU8DZpgWnuRl9atg7nBSjZrSLCbu+MUDOsbiSApiXbb09Im7eAV5pIw7tbkajejk8oZCvQ2yzOZpz3P4vmMY2y+V0KZvthvdNeBRYmqaIVvt6/je+DyExBbNQBQAAAABJRU5ErkJggg==",t.markerDefault2x="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAA9hAAAPYQGoP6dpAAAF8WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE5LTAxLTIyVDE3OjI1OjQ1KzA3OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE5LTAxLTIyVDE3OjI1OjQ1KzA3OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOS0wMS0yMlQxNzoyNTo0NSswNzowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM2MyYjNmMC00NTM4LTRhM2YtOTNhMC1hNDEyNmZjNGNjMTQiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo0MDZjOWM2Yy1jZDdjLWIyNDQtYTU3Mi0zNjQzOTllOWJkMTkiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpiMDNkZGZjNC1kNTE4LTQxN2YtYjUzNi0zZDJjOGUyZjY3ODEiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmIwM2RkZmM0LWQ1MTgtNDE3Zi1iNTM2LTNkMmM4ZTJmNjc4MSIgc3RFdnQ6d2hlbj0iMjAxOS0wMS0yMlQxNzoyNTo0NSswNzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDozM2MyYjNmMC00NTM4LTRhM2YtOTNhMC1hNDEyNmZjNGNjMTQiIHN0RXZ0OndoZW49IjIwMTktMDEtMjJUMTc6MjU6NDUrMDc6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5Dm+KFAAAHV0lEQVR4nOWbXYxdVRXHf/91zp1pwUpDiDHSgKjBD2wVqdaPxAcVAkF84MUYCn4gNBGMogajoIEoMSRWsUpiLdqYEE0UtGnqR9FGCkUxRopofbCxEFpREpT2QdqZe87++3DbMm1n7pmz77lTE/6TlcmcWWvtdf77c+29j2zzQkbZ1uBfl5x/zN9FLSKVWEaIKfcpXFLPIDYEBQWCsyrqVYEukPRqo3OEXwK86LDqAeA/wBOyd1naqUgPW9pb9YEiEYi6hokiqMo+0Z8gDEbUqjlY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",t.myPosition="data:image/png;base64,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",t.myPosition2x="data:image/png;base64,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",t.zoomOutIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAQAAACR313BAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfiCwEEOA6vGn99AAAAJElEQVQY02NgoCFgZGChSHcCfun/+KRZGH5QoJuA3TT1N2UAAKRCA8m04HhjAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE4LTExLTAxVDA0OjU2OjE0LTA0OjAwAvm1FAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOC0xMS0wMVQwNDo1NjoxNC0wNDowMHOkDagAAAAASUVORK5CYII=",t.zoomInIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAQAAACR313BAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAAHdElNRQfiCwEENCWvE8kxAAAAwElEQVQY033RPUoEQRAF4G+2mxUWBCNjTyBs4hkMzfQ8u5cxNJTFE2jmCQxM1kgRFIfubYMpcQZ/qoPiva5X1a+af6OLnFRnLjw7cOlKUsdlGWvNu2YdOFLSyYqGghZ8UzOTNqFSlC946kjxaomEpXP7sgfXsNEUbXKKZjOoe3yYydG6KHYW+uF6jj1pND+rA59x48Wb3oljVXLv1tzC3fTFq/C9+t13h11s8g/fs5++xaa2Hj05tA08+pIxat/EJ3JFQ3rCv00IAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE4LTExLTAxVDA0OjUyOjM3LTA0OjAweN8IjgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOC0xMS0wMVQwNDo1MjozNy0wNDowMAmCsDIAAAAodEVYdHN2ZzpiYXNlLXVyaQBmaWxlOi8vL3RtcC9tYWdpY2stSzZjb29QMEXVGp49AAAAAElFTkSuQmCC",t.tiltUpIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACpSURBVHgBlZC9DcIwEIVfuChO6RE8AT9tJAoU0TMKmQAxAdnEJQ3IVKa0CPMYY1NEFooJedX5fN873QMSOisjrvqxT/1nKYgxUr4U1trNdr26fc/MhkDGchmgUBORDEajoNLdCXDLqMXDdqUMT4Lq/jw4YOgu4UqScaO/8aK7nXeR+CFv2tbVvOnBTxgFGf/iGJGDa+pq0WZxgvhTIem8LMBfDkdMUEbE3zxPNOjkuRmkAAAAAElFTkSuQmCC",t.tiltDownIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAKCAYAAACE2W/HAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACrSURBVHgBrZGxDcIwEEXvzCKZgMglcRWC6DMCG8AEhBHYIGzAAKA0IEqcDTJCeuAOH5KlgAgKUV7l/61nWz6AnuDxXGaIuP5HIoBUJSbMiHjXVWLmzSwa75WE0Y2WrrIdpK1c9HqqL4vLNWBWhauCFs1Oo1D7pPwinujqzpQCQ/1FqhDdXgPVDHOjLcNj9e5A7aRYDm4VhcToXD7AZ0JYfEo/OZzKXEYFQ/MEPtI/ZDp7uSEAAAAASUVORK5CYII=",t.locationIcon="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAAQABAAD/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/hAytodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Nzg4QTJBMjVEMDI1MTFFN0EwQUVDODc5QjYyQkFCMUQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6Nzg4QTJBMjZEMDI1MTFFN0EwQUVDODc5QjYyQkFCMUQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3ODhBMkEyM0QwMjUxMUU3QTBBRUM4NzlCNjJCQUIxRCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3ODhBMkEyNEQwMjUxMUU3QTBBRUM4NzlCNjJCQUIxRCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pv/bAEMABQMEBAQDBQQEBAUFBQYHDAgHBwcHDwsLCQwRDxISEQ8RERMWHBcTFBoVEREYIRgaHR0fHx8TFyIkIh4kHB4fHv/AAAsIABQAFAEBEQD/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/2gAIAQEAAD8A98+JHjbWrHxHZeCfBOn2N94mvLVr6aa/kKWemWitt+0T7fmbLZVUHUgnOBXmfhHxZ4x8LWeveINO8beF/ino0F7JqGu2emOyX2no+N7W+ZHUxIFJEZwCAdpr6D0fUrLV9Js9W024S5sb2BLi3mXpJG6hlYfUEV8++OvDtt4W+IPivT/EPiXU7bRviLobafZ67qVx5iafeK8p+zF8ARxFZMoCQMArmvOfhL8PLj4EXWueLPFviPRb+7vdNl0zRtG0m5NzPqk0pUIAmASuQvY4zk4xz9F/BD4fXvgv4Z6Poepa7rVxfJbxvcRy3nmJbSFFDQxcfLGpBwPXJ713mr6bp2r6dPpurWFrf2U67Zre5iWSOQejKwINcF8KPhX4G8F6lq+paHoNpHezalPLHcPChktkbH7mJgoKRjsOvJyTXpIr/9k=",t.logoIcon="data:image/png;base64,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",t.rainTexture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAACACAYAAAAhzrj3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFZSURBVHgBrVNBbsNACATiQ2+2f5D+pP8/tS9JD5UaKTZTYCG2ayenrKJ4BMMA4zXRi87l9/bhT6mAdNRhG5lo4v+pjNCTSJflNJXOVDqWugBDtBiI+qVq1SuroF0fYMZt3A7mf9cCb7tUA1pAdik7P9fpfYmcCsx0RH4AJJYwoLbTM/KUAMKD2AFBh/WobVaxB2/KOyeLMERVl5TOyg96yckLvEUIKsZGdtfl1IuLzdCxkY3XGYeJU9DcQmtBFhHi1CFwjLLp5TMd2sJIMorD/htCh8H9SpnNOony9BAoQU7AbaBMSUXunEjRLlUAcL/nUZhtUZY+dGxtIwebkyzlIaWgbu0FzgdjKK3LXVEbOS5IRMzhc7iRNG6XwQdzY9rdiE35PnPtnqEgr/bSSsX9xr3qbNH2mqyAWwvADLew2TD63XPkE8bqbUKmdRVRpkzs27F/lJ9G/PoD4CKlP3uMsAAAAAAASUVORK5CYII=",t.snowTexture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAH1SURBVHgBpVPtbtswDDxSst0m6pqkzZphzSPs9x6/L7CH2I8NSLAldmAj8ZfEUW6dtR3WPxUgWCbE4/GOAt656HVARGIsLQpcWoskxvoe3WyGWo8NEcl/ATTZVhXmkjTz4NkxJZmmI1jbcEBFGXIH5ArSjzl2PHwTSY7AkjOsuja7BftrIX+hVwS9bwLLAUe52lGSaqHtCGJH2iVw3XVYSefviXDHoLkPYcocRM/H4JHrN7PSYVM1reb8ju2MDFI0WFDfL0H0USD3Aloy0VUQAQMlQSYBGhVqp0mi9RB3PQBEwSiFA9MHrbIIgqXyWuu+4YEi7UAsCDgJSyGcuQK4OANEtQMpC0I20NbKGl4QeB0GVySqXZChS41nyjSjxg4ODQWc0xrooyPE4Gc2KX0VhF9aR13/9+ephaJP01nTwddMqvVjf7tHCOUm2Ks2pfhwAofaGGr7Ft1zgPrm06zS64fhcpCJJmgtOtAAoiYRtrr3YD4wbLkrvtfnQYo2avatP2LNxn8OPqxAZmEIF0EZkPBRtcjZYGPY/Cyb6sedc7/ONsbDw4PkX76eUus1ZKhRFkVQwYIXUgNqa+TQe9kZbzaavB9H+p9R3lbVYpK4mWE4r2rHRo1IyyYpqaty59yLUX7zMTW2Sqdw8vSYThpvXz+md68/1R4Na0qbii0AAAAASUVORK5CYII=",t.images={markerDefault:[t.markerDefault,t.markerDefault2x,t.markerDefault2x],myPosition:[t.myPosition,t.myPosition2x,t.myPosition2x],zoomOutIcon:[t.zoomOutIcon,t.zoomOutIcon,t.zoomOutIcon],zoomInIcon:[t.zoomInIcon,t.zoomInIcon,t.zoomInIcon],tiltUpIcon:[t.tiltUpIcon,t.tiltUpIcon,t.tiltUpIcon],tiltDownIcon:[t.tiltDownIcon,t.tiltDownIcon,t.tiltDownIcon],locationIcon:[t.locationIcon,t.locationIcon,t.locationIcon],logoIcon:[t.logoIcon,t.logoIcon,t.logoIcon],rainTexture:[t.rainTexture,t.rainTexture,t.rainTexture],snowTexture:[t.snowTexture,t.snowTexture,t.snowTexture]},t}(),_=function(){function t(){}return t.getStyleForControlOptions=function(t){switch(t){case hi.TOP_LEFT:return"mf-ui-top-left";case hi.TOP_RIGHT:return"mf-ui-top-right";case hi.BOTTOM_LEFT:return"mf-ui-bottom-left";case hi.BOTTOM_RIGHT:return"mf-ui-bottom-right"}},t.bgColor="rgba(255,255,255,1)",t.size="29px",t.content="\n.mf-mapgl {\n  overflow: hidden;\n  height: 100%;\n  width: 100%;\n  position: relative;\n  box-sizing: content-box;\n}\n\n.mf-mapgl canvas {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  display: inherit;\n}\n\n.mf-mapgl .mf-ui {\n  position: fixed;\n  width: 25px;\n}\n\n.mf-ui.mf-ui-top-left {\n  top: 20px;\n  left: 20px;\n}\n.mf-ui.mf-ui-top-right {\n  top: 20px;\n  right: 20px;\n}\n.mf-ui.mf-ui-bottom-right {\n  right: 20px;\n  bottom: 20px;\n}\n.mf-ui.mf-ui-bottom-left {\n  left: 20px;\n  bottom: 20px;\n}\n\n\n.mf-mapgl .mf-ui .mf-button {\n  margin: 3px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: space-around;\n    width: "+t.size+";\n    height: "+t.size+";\n    border-radius: 2px;\n    border: 1px solid darken("+t.bgColor+", 5%);\n    background-color: "+t.bgColor+";\n    cursor: pointer;\n    user-select: none;\n    -moz-user-select: none;\n}\n\n.mf-mapgl .mf-ui .mf-button:hover {\n    background-color: darken("+t.bgColor+", 5%);\n  }\n\n.mf-mapgl .mf-ui .mf-button:active {\n    background-color: darken("+t.bgColor+", 10%);\n  }\n \n.mf-mapgl .mf-ui .mf-zoom-in-icon { \n  background-image: url("+b.zoomInIcon+");   \n  background-position: center !important;\n  background-repeat: no-repeat !important;\n  background-size: cover !important;\n  width: 12px;\n  height: 12px;  \n  opacity: 0.5;\n  z-index: 1;  \n    \n}\n\n.mf-mapgl .mf-ui .mf-zoom-out-icon { \n    background-image: url("+b.zoomOutIcon+"); \n    background-position: center !important;\n    background-repeat: no-repeat !important;\n    background-size: cover !important;\n    width: 12px;\n    height: 12px;  \n    opacity: 0.5;\n    z-index: 1;      \n}\n\n.mf-mapgl .mf-ui a:hover {\n    background-position: center !important;\n    background-repeat: no-repeat !important;\n    background-size: cover !important;\n    width: 12px;\n    height: 12px;\n    opacity: 1;\n    z-index: 1;\n    \n}\n\n.mf-mapgl .mf-ui .mf-location {\n    background-image: url("+b.locationIcon+");\n    background-position: center !important;\n    background-repeat: no-repeat !important;\n    background-size: cover !important;\n    width: 17px;\n    height: 17px;     \n    position: absolute;\n    opacity: 0.5;\n    z-index: 1;\n}\n\n.mf-logo-container {\n  position: fixed;\n  left: 10px;\n  bottom: 10px;\n  z-index: 1;\n}\n\n.mf-logo {\n  cursor: pointer;\n  width: 75px;\n  opacity: 1;\n  z-index: 1;\n}\n\n.mf-info-window-container {\n    position: relative;\n    display: inline-block;\n    z-index: 1;\n}\n\n.mf-info-window-content {\n    background-color: #ffffff;\n    padding-left: 5px;\n    padding-right:5px;\n    padding-top: 1px;\n    padding-bottom: 1px;\n    text-align: center;\n    line-height: 3pt;\n}\n\n.mf-mapgl .mf-ui .mf-button-mode {\n  position: fixed;\n  bottom: 130px;\n  right :13px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: space-around;\n    width: "+t.size+";\n    height: "+t.size+";\n    border-radius: 2px;\n    border: 1px solid darken("+t.bgColor+", 5%);\n    background-color: "+t.bgColor+";\n    cursor: pointer;\n    user-select: none;\n    -moz-user-select: none;\n}\n",t}(),S=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),this.red=t,this.green=e,this.blue=n,this.alpha=i}return t.prototype.buffer=function(){return[this.red,this.green,this.blue,this.alpha]},Object.defineProperty(t.prototype,"rgba",{get:function(){return"rgba("+255*this.red+","+255*this.green+","+255*this.blue+",1)"},enumerable:!0,configurable:!0}),t.fromHex=function(e){void 0===e&&(e="000000"),7!=e.length&&9!=e.length||(e=e.substring(1,e.length));var n=parseInt(e,16);return 6==e.length?new t((n>>16)/255,(n>>8&255)/255,(255&n)/255):new t((n>>24&255)/255,(n>>16&255)/255,(n>>8&255)/255,(255&n)/255)},t.fromInt=function(e){return void 0===e&&(e=0),e<0&&(e=0),new t((e>>16&255)/255,(e>>8&255)/255,(255&e)/255)},t.mix=function(e,n,i){return new t(e.red*i+n.red*(1-i),e.green*i+n.green*(1-i),e.blue*i+n.blue*(1-i),e.alpha*i+n.alpha*(1-i))},Object.defineProperty(t.prototype,"code",{get:function(){var t=function(t){var e=(255*t).toString(16);e=(e=1==e.length?"0"+e:e).length>2?e.substr(0,2):e};return"#"+t(this.red)+t(this.green)+t(this.blue)+t(this.alpha)},enumerable:!0,configurable:!0}),t.isValid=function(t){return/^[0-9A-F]{8}$/i.test(t)},t}();!function(t){t[t.cameraWillChange=0]="cameraWillChange",t[t.cameraChanging=1]="cameraChanging",t[t.idle=2]="idle",t[t.click=3]="click",t[t.dblClick=4]="dblClick",t[t.drag=5]="drag",t[t.dragEnd=6]="dragEnd",t[t.dragStart=7]="dragStart",t[t.mouseMove=8]="mouseMove",t[t.mouseOut=9]="mouseOut",t[t.mouseOver=10]="mouseOver",t[t.projectionChanged=11]="projectionChanged",t[t.rightClick=12]="rightClick",t[t.tilesLoaded=13]="tilesLoaded",t[t.markerClick=14]="markerClick",t[t.buildingClick=15]="buildingClick",t[t.polygonClick=16]="polygonClick",t[t.polylineClick=17]="polylineClick",t[t.circleClick=18]="circleClick",t[t.modeChanged=19]="modeChanged"}(i||(i={})),function(t){t[t.Down=0]="Down",t[t.Up=1]="Up",t[t.Drag=2]="Drag",t[t.DragEnd=3]="DragEnd",t[t.Wheel=4]="Wheel",t[t.Move=5]="Move",t[t.Over=6]="Over",t[t.Out=7]="Out",t[t.Double=8]="Double",t[t.None=9]="None"}(o||(o={})),function(t){t[t.Left=0]="Left",t[t.Wheel=1]="Wheel",t[t.Right=2]="Right",t[t.None=3]="None"}(r||(r={}));var C=function(){function t(t,e){this.canvas=t,this.mapView=e,this.checkDragStart=!0,this.mouseOverTimeout=500,t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("mousemove",this.mouseMove.bind(this)),t.addEventListener("mouseup",this.mouseUp.bind(this)),t.addEventListener("wheel",this.mouseWheel.bind(this)),t.addEventListener("mouseover",this.mouseOver.bind(this)),t.addEventListener("mouseout",this.mouseOut.bind(this)),t.addEventListener("dblclick",this.doubleClick.bind(this)),t.addEventListener("contextmenu",function(t){return t.preventDefault()})}return t.prototype.drainInertiaBuffer=function(){for(var t=this.inertia,e=Date.now();t.length>0&&e-t[0][0]>160;)t.shift()},t.prototype.doubleClick=function(t){var e=new y(t.pageX,t.pageY);this.mapView.mapsEventManager.notify(i.dblClick,t),this.dispatch({dx:0,dy:0,x:e.x,y:e.y,action:o.Double,button:t.button})},t.prototype.mouseOut=function(t){this.mouseOutside=!0,clearTimeout(this.mouseOverTimeoutHandler);var e=new y(t.pageX,t.pageY);this.mapView.mapsEventManager.notify(i.mouseOut,t),this.dispatch({dx:0,dy:0,x:e.x,y:e.y,action:o.Out,button:t.button}),this.mousePosition=null},t.prototype.mouseWheel=function(t){if(0!=t.deltaY){var e=new y(t.pageX,t.pageY);this.dispatch({dx:t.deltaX,dy:t.deltaY,x:e.x,y:e.y,action:o.Wheel,button:t.button})}},t.prototype.mouseDown=function(t){return this.mapView.stopAnimation(),this.mousePosition=new y(t.pageX,t.pageY),this.mouseDownPosition=this.mousePosition,this.mouseDownTime=Date.now(),t.button==r.Right&&(this.lastDragRotatePosition=new y(this.mousePosition.x,this.mousePosition.y),this.inertia=[[Date.now(),this.mapView.mapState.getBearing()]]),this.dispatch({x:this.mousePosition.x,y:this.mousePosition.y,dx:0,dy:0,action:o.Down,button:t.button}),this.preMouseDown=t,!1},t.prototype.mouseMove=function(t){var e=new y(t.pageX,t.pageY),n=null!=this.preMouseDown?this.preMouseDown.button:t.button;if(this.mousePosition){var r=e.subtract(this.mousePosition);if(this.mousePosition=e,0==r.x&&0==r.y)return;this.checkDragStart&&(this.mapView.mapsEventManager.notify(i.dragStart,t),this.checkDragStart=!1),this.mapView.mapsEventManager.notify(i.drag,t),this.dispatch({x:e.x,y:e.y,dx:r.x,dy:r.y,action:o.Drag,button:n})}else this.mapView.mapState.isStill()&&(clearTimeout(this.mouseOverTimeoutHandler),this.mouseOverTimeoutHandler=setTimeout(function(){console.log("mouse over",t.clientX,"-",t.clientY)},this.mouseOverTimeout)),this.mapView.mapsEventManager.notify(i.mouseMove,t),this.dispatch({x:e.x,y:e.y,dx:0,dy:0,action:o.Move,button:n});return!1},t.prototype.mouseOver=function(t){this.mouseOutside=!1;var e=new y(t.pageX,t.pageY);this.mapView.mapsEventManager.notify(i.mouseOver,t),this.dispatch({x:e.x,y:e.y,dx:0,dy:0,action:o.Over,button:t.button})},t.prototype.mouseUp=function(e){var n=new y(e.pageX,e.pageY);this.mouseUpTime=Date.now();var a=n.subtract(this.mouseDownPosition),s=this.mouseUpTime-this.mouseDownTime;if(a.length<.01)if(this.dispatch({x:n.x,y:n.y,dx:0,dy:0,action:o.Up,button:e.button}),e.button==r.Left){var u=this.mapView.getCurrentMousePosition(e);this.mapView.mapsEventManager.onClickEvent(u)||this.mapView.mapsEventManager.notify(i.click,e)}else e.button==r.Right&&this.mapView.mapsEventManager.notify(i.rightClick,e);else this.dispatch({x:n.x,y:n.y,dx:s<t.TIME_DRAG_DETECT?a.x:0,dy:s<t.TIME_DRAG_DETECT?a.y:0,action:o.DragEnd,button:e.button}),this.mapView.mapsEventManager.notify(i.dragEnd,e),this.checkDragStart=!0;return this.mousePosition=null,this.preMouseDown=null,!1},t.prototype.dispatch=function(t){this.mouseEventHandler(t)},t.prototype.mouseEventHandler=function(e){switch(e.action){case o.Drag:if(e.button==r.Left){var n=new g(-e.dx*T.pixelScale,e.dy*T.pixelScale);this.mapView.moveBy(n)}if(e.button==r.Right){this.inertia.push([Date.now(),-e.x]);var i=.4*(this.lastDragRotatePosition.x-e.x),s=-.5*(this.lastDragRotatePosition.y-e.y);this.mapView.setBearing(this.mapView.mapState.getBearing()+i,0,!0),this.mapView.setTilt(this.mapView.mapState.cameraPosition.getTilt()-s,!0),this.lastDragRotatePosition=new y(e.x,e.y)}break;case o.Wheel:var u=this.mapView.mapState.getZoom(),l=e.dy*a.zoomSpeedMouseWheel/1e3;if(e.dy<0){if(e.dy>t.oldWheelMouseDy)return;t.oldWheelMouseDy=e.dy,u=Math.ceil(u),u-=l,u=Math.ceil(u)}else{if(e.dy<t.oldWheelMouseDy)return;t.oldWheelMouseDy=e.dy,u=Math.round(u),u-=l,u=Math.round(u-.5)}var h=new y(e.x,e.y).multiply(T.pixelScale);this.mapView.setZoom(u,h,500,!0);break;case o.DragEnd:if(t.oldWheelMouseDy=0,e.button==r.Left){n=new y(-e.dx,e.dy).multiply(T.pixelScale);this.mapView.moveByVelocity(new y(n.x,n.y).multiply(a.flingSpeedMultiply*T.pixelScale))}if(e.button==r.Right){if(this.drainInertiaBuffer(),this.inertia.length<2)return;var c=this.inertia,p=c.length,f=c[p-1],d=c[p-2],m=f[1]-d[1]>0?1:-1,v=(i=f[1]-d[1],3*Math.abs(i));Math.abs(v)>360&&(v=360),v*=m;var x=Math.abs(v)/90;x>1&&(x=1),this.mapView.setBearing(this.mapView.mapState.getBearing()+v,x,!0)}break;case o.Double:if(e.button==r.Left){u=this.mapView.mapState.getZoom()+1,h=new y(e.x,e.y).multiply(T.pixelScale);this.mapView.setZoom(u,h,0,!0)}}},t.TIME_DRAG_DETECT=300,t}(),E=function(){function t(){}return t.create=function(t,e,n){var i=window.document.createElement(t);return e&&(i.className=e),n&&n.appendChild(i),i},t.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)},t}(),R=function(){function t(){}return t.prototype.onMapWillChange=function(t){},t.prototype.onMapIsChanging=function(t){},t.prototype.onMapDidChange=function(t){},t}(),I=function(){function t(){}return t.prototype.notifyCameraWillChange=function(t){},t.prototype.notifyCameraIsChanging=function(){},t.prototype.notifyCameraDidChange=function(){},t}(),L=function(){function t(t){void 0===t&&(t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])),this.data=t}return t.translate=function(e,n,i){return void 0===i&&(i=0),new t(new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,n,i,1]))},Object.defineProperty(t.prototype,"position",{get:function(){return new x(this.data[12],this.data[13],this.data[14])},enumerable:!0,configurable:!0}),t.rotateX=function(e){e*=Math.PI/180;var n=Math.sin(e),i=Math.cos(e);return new t(new Float32Array([1,0,0,0,0,i,n,0,0,-n,i,0,0,0,0,1]))},t.rotateY=function(e){e*=Math.PI/180;var n=Math.sin(e),i=Math.cos(e);return new t(new Float32Array([i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1]))},t.rotateZ=function(e){e*=Math.PI/180;var n=Math.sin(e),i=Math.cos(e);return new t(new Float32Array([i,n,0,0,-n,i,0,0,0,0,1,0,0,0,0,1]))},t.scale=function(e,n,i){return null==n&&(n=e,i=e),new t(new Float32Array([e,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1]))},t.prototype.concat=function(e){var n=new t(new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]));if(null==e)return n;for(var i=0;i<4;++i)for(var o=0;o<4;++o)for(var r=0;r<4;++r)n.data[4*i+r]+=this.data[4*i+o]*e.data[4*o+r];return n},t.ortho=function(e,n,i,o,r,a){return void 0===r&&(r=-100),void 0===a&&(a=100),new t(new Float32Array([2/(n-e),0,0,0,0,2/(o-i),0,0,0,0,-2/(a-r),0,-(e+n)/(n-e),-(o+i)/(o-i),-(r+a)/(r-a),1]))},t.perspective=function(e,n,i,o){var r=Math.tan(e/2)*i,a=r*n;return t.frustum(-a,a,-r,r,i,o)},t.frustum=function(e,n,i,o,r,a){return void 0===r&&(r=-100),void 0===a&&(a=100),new t(new Float32Array([2*r/(n-e),0,0,0,0,2*r/(o-i),0,0,(n+e)/(n-e),(o+i)/(o-i),-(a+r)/(a-r),-1,0,0,-2*r*a/(a-r),0]))},t.prototype.transform=function(t,e){void 0===e&&(e=0);var n=this.data[0]*t.x+this.data[4]*t.y+this.data[8]*t.z+this.data[12]*e,i=this.data[1]*t.x+this.data[5]*t.y+this.data[9]*t.z+this.data[13]*e,o=this.data[2]*t.x+this.data[6]*t.y+this.data[10]*t.z+this.data[14]*e;return 0==(e=this.data[3]*t.x+this.data[7]*t.y+this.data[11]*t.z+this.data[15]*e)&&(e=1),new x(n/e,i/e,o/e)},t.prototype.buffer=function(){return this.data},t.lookAt=function(e,n,i,o){void 0===i&&(i=1),void 0===o&&(o=new x(0,0,1));var r=e.subtract(n).normalize(),a=o.cross(r).normalize(),s=r.cross(a).normalize(),u=new t(new Float32Array([a.x,s.x,r.x,0,a.y,s.y,r.y,0,a.z,s.z,r.z,0,0,0,0,1])),l=t.translate(-e.x,-e.y,-e.z),h=t.scale(i);return l.concat(u).concat(h)},t.prototype.inverse=function(){for(var e=this.data.slice(),n=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),i=0;i<4;++i){for(var o=i;o<4&&0==e[4*o+i];)++o;if(4==o||0==e[4*o+i])return console.log("Cannot calculate inverse, determinant is zero"),this;if(o!=i){var r=e.slice(4*i,4*(i+1)),a=e.slice(4*o,4*(o+1));e.set(a,4*i),e.set(r,4*o);var s=n.slice(4*i,4*(i+1)),u=n.slice(4*o,4*(o+1));n.set(u,4*i),n.set(s,4*o)}var l=e.slice(4*i,4*(i+1)),h=n.slice(4*i,4*(i+1));for(o=0;o<4;++o){a=e.slice(4*o,4*(o+1)),u=n.slice(4*o,4*(o+1));if(o!=i){if(0!=a[i]){for(var c=-a[i]/l[i],p=i;p<4;++p)a[p]=a[p]+c*l[p];e.set(a,4*o);for(p=0;p<4;++p)u[p]=u[p]+c*h[p];n.set(u,4*o)}}else{if(0==(c=l[i]))return console.log("Cannot calculate inverse, determinant is zero"),this;for(p=i;p<4;++p)a[p]=a[p]/c;e.set(a,4*o);for(p=0;p<4;++p)u[p]=u[p]/c;n.set(u,4*o)}}}return new t(n)},t}(),O=function(){function t(t){this.prefered2d=!1,this.scale=1,this.willChange=!1,this.zoomIn=!1,this.zoomOut=!1,this.panning=!1,this.flyingTo=!1,this.tilting=!1,this.bearing=!1,this.mapSettings=t,this.cameraPosition=new v([0,0],0,0,0)}return t.prototype.setScreenSize=function(t,e){this.screenWidth=t,this.screenHeight=e,this.projectionMatrix=L.perspective(u.fov,this.screenWidth/this.screenHeight,u.nearPlane,u.farPlane),this.orthoProjectionMatrix=L.ortho(0,this.screenWidth,this.screenHeight,0),this.recalculateMatrices()},t.prototype.matrixFor=function(t){var e=1<<t.getTileCoordinate().getZoom(),n=A.worldSize(this.scale)/e,i=t.toVec2(),o=i.x*n+n/2,r=i.y*n+n/2,a=w.pixelCoordinateToCameraCoordinate(new y(o,r),this),s=L.translate(a.x,a.y,0);return s=L.scale(n/2,n/2,1).concat(s)},t.prototype.recalculateMatrices=function(){this.viewMatrix=this.updateViewMatrix(),this.viewProjectionMatrixWithoutTilt=this.updateViewMatrix(!0).concat(this.projectionMatrix),this.inverseViewProjectionMatrixWithoutTilt=this.viewProjectionMatrixWithoutTilt.inverse(),this.viewProjectionMatrix=this.viewMatrix.concat(this.projectionMatrix),this.inverseViewProjectionMatrix=this.viewProjectionMatrix.inverse()},t.prototype.updateViewMatrix=function(t){void 0===t&&(t=!1);var e=T.getTileSize(),n=u.height*Math.tan(u.fov/2)*e/this.screenHeight/(e/2),i=L.rotateX(t?0:this.cameraPosition.getTilt()).transform(new x(0,0,u.height),0),o=L.rotateZ(this.cameraPosition.getBearing()).transform(i,0);i=L.rotateX(t?0:this.cameraPosition.getTilt()).transform(new x(0,1,0),0);var r=L.rotateZ(this.cameraPosition.getBearing()).transform(i,0),a=L.lookAt(o,new x(0,0,0),1,r);return a=L.scale(n,n,n).concat(a)},t.prototype.setTarget=function(t){this.cameraPosition.setTarget(t),this.recalculateMatrices()},t.prototype.setTilt=function(t){this.cameraPosition.setTilt(t),this.recalculateMatrices()},t.prototype.setBearing=function(t){this.cameraPosition.setBearing(t),this.recalculateMatrices()},t.prototype.setZoom=function(t){var e=this.getZoom();this.cameraPosition.setZoom(t),this.scale=Math.pow(2,t),e!=this.getZoom()&&(this.prefered2d=this.getZoom()>=a.defaultMinZoom3d&&!this.is3dMode()),this.recalculateMatrices()},t.prototype.enable3dMode=function(t){return this.mapSettings.enable3dMode(t)},t.prototype.getProjectionMatrix=function(){return this.projectionMatrix},t.prototype.getViewMatrix=function(){return this.viewMatrix},t.prototype.getViewProjectionMatrix=function(){return this.viewProjectionMatrix},t.prototype.getViewProjectionMatrixWithoutTilt=function(){return this.viewProjectionMatrixWithoutTilt},t.prototype.getInverseViewProjectionMatrixWithoutTilt=function(){return this.inverseViewProjectionMatrixWithoutTilt},t.prototype.getOrthoProjectionMatrix=function(){return this.orthoProjectionMatrix},t.prototype.getInverseViewProjectionMatrix=function(){return this.inverseViewProjectionMatrix},t.prototype.getScreenSize=function(){return new y(this.screenWidth,this.screenHeight)},t.prototype.getTilt=function(){return this.cameraPosition.getTilt()},t.prototype.getBearing=function(){return this.cameraPosition.getBearing()},t.prototype.getScale=function(){return this.scale},t.prototype.getZoom=function(){return this.cameraPosition.getZoom()},t.prototype.getTarget=function(){return this.cameraPosition.getTarget()},t.prototype.isZoomIn=function(){return this.zoomIn},t.prototype.isZoomOut=function(){return this.zoomOut},t.prototype.isTilting=function(){return this.tilting},t.prototype.isBearing=function(){return this.bearing},t.prototype.isPanning=function(){return this.panning},t.prototype.isFlyingTo=function(){return this.flyingTo},t.prototype.isStartedAnimation=function(){return this.startedAnimation},t.prototype.isMoving=function(){return this.movingTo},t.prototype.isStill=function(){return!(this.isBearing()||this.isFlyingTo()||this.isMoving()||this.isPanning()||this.isTilting()||this.isZoomIn()||this.isZoomOut())},t.prototype.getCamera=function(){return this.cameraPosition},t.prototype.isWillChange=function(){return this.willChange},t.prototype.setCamera=function(t){this.cameraPosition=t},t.prototype.getMaxNativeZoom=function(){return this.mapSettings.getMaxNativeZoom()},t.prototype.is3dMode=function(){return this.mapSettings.is3dMode()},t.prototype.setSwitchMode=function(t){this.mapSettings.setSwitchMode(t)},t.prototype.handleSwitchMode=function(){switch(this.mapSettings.getSwitchMode()){case li.Auto3DTo2D:this.getZoom()<a.defaultMinZoom3d&&this.enable3dMode(!1);break;case li.Auto2DTo3D:Math.round(this.getZoom())!=a.defaultMinZoom3d||this.prefered2d||this.enable3dMode(!0);break;case li.Auto:case li.Default:this.prefered2d||this.enable3dMode(Math.round(this.getZoom())==a.defaultMinZoom3d)}},t}(),D=function(){function t(t){this.map2dUrl=a.baseMapUrl+"?tileUrl="+a.defaultMap2dUrl+"&key=",this.map3dUrl=a.baseMapUrl+"?tileUrl="+a.defaultMap3dUrl+"&mode=3d&key=",this.minZoom=a.defaultMinZoom,this.maxZoom=a.defaultMaxZoom,this.maxNativeZoom=a.defaultMaxNativeZoom,this._3dMode=!1,this.switchMode=li.Auto3DTo2D,this.onModeChanged=t}return t.prototype.setMapUrl=function(t,e){void 0===e&&(e=!1),e?this.map3dUrl=a.baseMapUrl+"?tileUrl="+t+"&mode=3d&key=":this.map2dUrl=a.baseMapUrl+"?tileUrl="+t+"&key="},t.prototype.setMinZoom=function(t){this.minZoom=t,this.minZoom>this.maxZoom&&(this.minZoom+=this.maxZoom,this.maxZoom=this.minZoom-this.maxZoom,this.minZoom-=this.maxZoom)},t.prototype.setMaxZoom=function(t){this.maxZoom=t,this.minZoom>this.maxZoom&&(this.minZoom+=this.maxZoom,this.maxZoom=this.minZoom-this.maxZoom,this.minZoom-=this.maxZoom)},t.prototype.getMapUrl=function(){return(this._3dMode?this.map3dUrl:this.map2dUrl)+t.accessKey},t.prototype.getPreferMinZoom=function(){var t=this.minZoom,e=0;switch(this.switchMode){case li.Auto:case li.Default:case li.Auto3DTo2D:t=this.minZoom>a.defaultMinZoom?this.minZoom:a.defaultMinZoom;break;default:e=this.is3dMode()?a.defaultMinZoom3d:a.defaultMinZoom,t=this.minZoom>e?this.minZoom:e}return t},t.prototype.getMinZoom=function(){return this.minZoom},t.prototype.getMaxZoom=function(){return this.maxZoom},t.prototype.getMaxNativeZoom=function(){return this.maxNativeZoom},t.prototype.setTime=function(t){this.time=t},t.prototype.getTime=function(){return this.time},t.prototype.setMaxNativeZoom=function(t){this.maxNativeZoom=t},t.getAccessKey=function(){return this.accessKey},t.setAccessKey=function(t){this.accessKey=t},t.prototype.enable3dMode=function(t){return t!=this._3dMode&&(this._3dMode=t,this.onModeChanged(),!0)},t.prototype.is3dMode=function(){return this._3dMode},t.prototype.setSwitchMode=function(t){this.switchMode=t},t.prototype.getSwitchMode=function(){return this.switchMode},t.accessKey="98fd21346d83bee24dc734231f7609c9",t}(),P=function(){function t(t){this.orderedKeys=[],this.size=t,this.tiles=new Map}return t.prototype.setSize=function(t){for(this.size=t;this.orderedKeys.length>t;){var e=this.orderedKeys[0];this.orderedKeys.shift(),this.tiles.delete(e.toString())}},t.prototype.add=function(t,e){if(e.isRenderable()&&this.size){if(this.tiles.has(t)){var n=this.orderedKeys.indexOf(t,0);n>-1&&this.orderedKeys.splice(n,1);var i=this.tiles.get(t);i!=e&&i.destroy()}if(this.tiles.set(t,e),this.orderedKeys.push(t),this.orderedKeys.length>this.size-1)this.pop(this.orderedKeys[0]).destroy()}else e.destroy()},t.prototype.get=function(t){return this.tiles.get(t)},t.prototype.pop=function(t){var e=this.tiles.get(t);if(this.tiles.delete(t)){var n=this.orderedKeys.indexOf(t,0);n>-1&&this.orderedKeys.splice(n,1)}return e},t.prototype.has=function(t){return null!=this.tiles.get(t)},t.prototype.clear=function(){this.orderedKeys=[],this.tiles.forEach(function(t){t.destroy()}),this.tiles.clear()},t}(),B=function(){function t(t,e){this.unwrappedTileCoordinate=t,this.tile=e}return t.prototype.clone=function(){return new t(this.unwrappedTileCoordinate,this.tile)},t.prototype.getTile=function(){return this.tile},t.prototype.getUnwrappedTileCoordinate=function(){return this.unwrappedTileCoordinate},t}(),k=function(){function t(t,e,n,i){void 0===i&&(i=!1),this.x=t,this.y=e,this.zoom=n,this.mode3D=i}return t.fromLatLng=function(e,n,i){var o=A.projectScale(e,Math.pow(2,n)).multiply(1/T.getTileSize());return new t(Math.floor(o.x),Math.floor(o.y),n,i)},t.prototype.parent=function(){return new t(this.x/2,this.y/2,this.zoom-1,this.mode3D)},t.prototype.children=function(){var e=this.zoom+1,n=2*this.x,i=2*this.y;return[new t(n,i,e,this.mode3D),new t(n,i+1,e,this.mode3D),new t(n+1,i,e,this.mode3D),new t(n+1,i+1,e,this.mode3D)]},t.prototype.set3DMode=function(t){this.mode3D=t},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.getZoom=function(){return this.zoom},t.prototype.is3DMode=function(){return this.mode3D},t.prototype.equal=function(t){return this.x==t.x&&this.y==t.y&&this.zoom==t.zoom&&this.mode3D==t.mode3D},t.prototype.notEqual=function(t){return this.x!=t.x||this.y!=t.y||this.zoom!=t.zoom||this.mode3D!=t.mode3D},t.prototype.lessThan=function(t){return this.x==t.x?this.y==t.y?this.zoom<t.zoom:this.y<t.y:this.x<t.x},t.prototype.isChildOf=function(t){return this.mode3D==t.mode3D&&(0==t.zoom||t.zoom<this.zoom&&t.x==this.x>>this.zoom-t.zoom&&t.y==this.y>>this.zoom-t.zoom)},t.prototype.toString=function(){return'{"x":'+this.getX()+',"y":'+this.getY()+',"z":'+this.getZoom()+',"mode3D":'+this.mode3D+"}"},t}(),N=function(){function t(){}return t.createWithXYZoom=function(e,n,i,o){void 0===o&&(o=!1);var r=new t;return r.wrap=(e<0?e-(1<<i)+1:e)/(1<<i)>>0,r.tileCoordinate=new k(e&(1<<i)-1,n<0?0:Math.min(n,(1<<i)-1),i,o),r},t.createWithWrapAndTileCoordinate=function(e,n){var i=new t;return i.wrap=e,i.tileCoordinate=n,i},t.fromLatLng=function(e,n){var i=A.projectScale(e,Math.pow(2,n)).multiply(1/T.getTileSize());return t.createWithXYZoom(Math.floor(i.x),Math.floor(i.y),n)},t.prototype.toVec2=function(){var t=this.tileCoordinate.getX()+this.wrap*(1<<this.tileCoordinate.getZoom());return new y(t,this.tileCoordinate.getY())},t.prototype.parent=function(){var e=this.tileCoordinate.zoom-1,n=this.tileCoordinate.x/2>>0,i=this.tileCoordinate.y/2>>0;return t.createWithWrapAndTileCoordinate(this.wrap,new k(n,i,e,this.tileCoordinate.is3DMode()))},t.prototype.children=function(){var e=this.tileCoordinate.zoom+1,n=2*this.tileCoordinate.x,i=2*this.tileCoordinate.y;return[t.createWithWrapAndTileCoordinate(this.wrap,new k(n,i,e,this.tileCoordinate.is3DMode())),t.createWithWrapAndTileCoordinate(this.wrap,new k(n,i+1,e,this.tileCoordinate.is3DMode())),t.createWithWrapAndTileCoordinate(this.wrap,new k(n+1,i,e,this.tileCoordinate.is3DMode())),t.createWithWrapAndTileCoordinate(this.wrap,new k(n+1,i+1,e,this.tileCoordinate.is3DMode()))]},t.prototype.getWrap=function(){return this.wrap},t.prototype.getTileCoordinate=function(){return this.tileCoordinate},t.prototype.equal=function(t){return this.wrap==t.getWrap()&&this.tileCoordinate.equal(t.getTileCoordinate())},t.prototype.notEqual=function(t){return this.wrap!=t.getWrap()},t.prototype.lessThan=function(t){return this.wrap==t.getWrap()?this.tileCoordinate.lessThan(t.getTileCoordinate()):this.wrap<t.getWrap()},t}(),Z=function(){function t(){}return t.scanTriangle=function(t,e,n,i,o,r){var a=new F(t,e),s=new F(e,n),u=new F(n,t);if(a.dy>s.dy){var l=a;a=s,s=l}if(a.dy>u.dy){l=a;a=u,u=l}if(s.dy>u.dy){l=s;s=u,u=l}a.dy&&U(u,a,i,o,r),s.dy&&U(u,s,i,o,r)},t}(),F=function(){return function(t,e){if(this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.dx=0,this.dy=0,t.y>e.y){var n=t;t=e,e=n}this.x0=t.x,this.y0=t.y,this.x1=e.x,this.y1=e.y,this.dx=e.x-t.x,this.dy=e.y-t.y}}();function U(t,e,n,i,o){var r=Math.max(n,Math.floor(e.y0)),a=Math.min(i,Math.ceil(e.y1));if(t.x0==e.x0&&t.y0==e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var u=t.dx/t.dy,l=e.dx/e.dy,h=t.dx>0?1:0,c=e.dx<0?1:0,p=r;p<a;++p){var f=u*Math.max(0,Math.min(t.dy,p+h-t.y0))+t.x0,d=l*Math.max(0,Math.min(e.dy,p+c-e.y0))+e.x0;o(Math.floor(d),Math.ceil(f),p)}}var j,z=function(){function t(){}return t.getTileUrl=function(t,e,n,i){for(var o=0,r=0,a="";r<t.length;)if("{"==t[r]){switch(a+=t.substring(o,r),t[r+1]){case"x":a+=e.toString();break;case"y":a+=n.toString();break;case"z":a+=i.toString();break;default:console.log("Invalid map url pattern: "+t)}o=r+=3}else++r;return a+=t.substr(o)},t.getBuildingDataUrl=function(t,e,n){for(var i=0,o=0,r="";o<t.length;)if("{"==t[o]){switch(r+=t.substring(i,o),t[o+1]){case"s":r+=e;break;case"k":r+=n;break;default:console.log("Invalid Model url pattern: "+t)}i=o+=3}else++o;return r+=t.substr(i)},t}(),V=function(){function t(){}return t.generate=function(){return Math.random().toString(36).substring(2)+(new Date).getTime().toString(36)+this.count++},t.count=0,t}();!function(t){t[t.RasterTile=0]="RasterTile",t[t.Model=1]="Model",t[t.Texture=2]="Texture",t[t.MAX=3]="MAX"}(j||(j={}));var Y,W=function(){return function(t){this.method="GET",this.params=null,this.id=V.generate(),this.type=t}}(),X=function(){return function(t){this.id=t,this.success=!1,this.data=null}}(),G=function(){function t(t,e,n,i,o,r){this.minX=t,this.maxX=e,this.minY=n,this.maxY=i,this.minZoom=o,this.maxZoom=r}return t.fromLatLngBounds=function(e,n,i){var o=A.projectZoom(e.getSouthwest(),i),r=A.projectZoom(e.getNortheast(),i),a=Math.pow(2,i);return new t(Math.floor(o.x),Math.floor(r.x),f.clamp(Math.floor(r.y),0,a),f.clamp(Math.floor(o.y),0,a),n,i)},t.prototype.contains=function(t){var e=t.getX(),n=t.getY(),i=t.getZoom();if(i<=this.maxZoom&&i>=this.minZoom){if(0==i)return!0;var o=this.maxZoom-i,r=this.minX>>o,a=this.maxX>>o,s=this.minY>>o,u=this.maxY>>o;return(this.minX>this.maxX?e>=r||e<=a:e<=a&&e>=r)&&n<=u&&n>=s}return!1},t}(),H=function(){function t(){}return t.prototype.setModel=function(t){this.model=t},t.prototype.setTexture=function(t){this.texture=t},t.prototype.getModel=function(){return this.model},t.prototype.getTexture=function(){return this.texture},t.prototype.getModelMatrix=function(){return this.modelMatrix},t.prototype.getMvpMatrix=function(){return this.mvpMatrix},t}(),Q=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),J=function(t){function e(){var e=t.call(this)||this;return e.location=new p(0,0),e.scale=new x(1,1,1),e.bearing=0,e.name="Unknown name",e.elevation=0,e.selectionCode=0,e.objData=null,e.textureData=null,e.bounds={minX:0,minY:0,maxX:0,maxY:0},e}return Q(e,t),e.prototype.getId=function(){return this.id},e.prototype.setId=function(t){this.id=t},e.prototype.getName=function(){return this.name},e.prototype.setName=function(t){this.name=t},e.prototype.setPlaces=function(t){this.places=t},e.prototype.getPlaces=function(){return this.places},e.prototype.getScale=function(){return this.scale},e.prototype.setScale=function(t){this.scale=t},e.prototype.setBearing=function(t){this.bearing=t},e.prototype.getBearing=function(){return this.bearing},e.prototype.setLocation=function(t){this.location=p.convert(t)},e.prototype.getLocation=function(){return this.location},e.prototype.getElevation=function(){return this.elevation},e.prototype.setElevation=function(t){this.elevation=t},e.prototype.setHeightScale=function(t){this.heightScale=t},e.prototype.getHeightScale=function(){return this.heightScale},e.prototype.setCamera=function(t){this.camera=t},e.prototype.getCamera=function(){return this.camera},e.prototype.setTypes=function(t){this.types=t},e.prototype.getTypes=function(){return this.types},e.prototype.setVerified=function(t){this._isVerified=t},e.prototype.isVerified=function(){return this._isVerified},e.prototype.setMinZoom=function(t){this.minZoom=t},e.prototype.getMinZoom=function(){return this.minZoom},e.prototype.setMaxZoom=function(t){this.maxZoom=t},e.prototype.getMaxZoom=function(){return this.maxZoom},e.prototype.setStartDate=function(t){this.startDate=t},e.prototype.getStartDate=function(){return this.startDate},e.prototype.setEndDate=function(t){this.endDate=t},e.prototype.getEndDate=function(){return this.endDate},e.prototype.getTextureName=function(){return this.textureName},e.prototype.setTextureName=function(t){this.textureName=t},e.prototype.getTextureData=function(){return this.textureData},e.prototype.setTextureData=function(t){this.textureData=t},e.prototype.getObjName=function(){return this.objName},e.prototype.setObjName=function(t){this.objName=t},e.prototype.getObjData=function(){return this.objData},e.prototype.setObjData=function(t){this.objData=t},e.prototype.getDistance=function(){return this.distance},e.prototype.setDistance=function(t){this.distance=t},e.prototype.getBuildingType=function(){return this.buildingType},e.prototype.setBuildingType=function(t){this.buildingType=t},e.prototype.getSelectionCode=function(){return this.selectionCode},e.prototype.setSelectionCode=function(t){this.selectionCode=t},e.prototype.getBounds=function(){return this.bounds},e.prototype.setBounds=function(t){this.bounds=t},e.prototype.updateMatrices=function(t){var n=1/A.getMetersPerPixelAtLatitude(t.getTarget().lat(),t.getZoom()),i=A.projectScale(this.location,t.getScale()),o=w.pixelCoordinateToCameraCoordinate(new y(i.x,i.y),t),r=w.getElevationPixelFromMeter(this.getElevation(),t);this.modelMatrix=L.translate(o.x,o.y,r),this.modelMatrix=L.scale(this.scale.x*n,this.scale.y*n,this.scale.z*n).concat(this.modelMatrix),this.modelMatrix=L.rotateZ(this.bearing).concat(this.modelMatrix),this.modelMatrix=L.rotateX(e.buildingRotationX).concat(this.modelMatrix),this.mvpMatrix=this.modelMatrix.concat(t.getViewProjectionMatrix())},e.buildingRotationX=90,e}(H);!function(t){t[t.Texture=0]="Texture",t[t.Color=1]="Color",t[t.Polygon=2]="Polygon",t[t.External=3]="External"}(Y||(Y={}));var q=n(2),K=n.n(q),$=function(){function t(){}return t.extrudePolygon=function(e,n){if(!(0==e.length||e[0].length<=2)){var i=[],o=[];t.convertToClockwise(e[0]);var r=[];e[0].forEach(function(t){r.push(t.x),r.push(t.y)});var a=K()(r),s=e[0],u=s.length,l=u;a.length;6*(l-0)*1,2*(2*(l-0));for(var h=0,c=0;c<s.length;++c)i.push([-s[c].y,n,-s[c].x,0,0,0,0,0]);for(c=0;c<a.length;++c)o.push(h+a[c]);var p=l-0,f=2*p;h=i.length;for(var d=0;d<2;++d){var g=0==d?n:0;for(c=0;c<p;++c)for(var m=0;m<2;++m){var y=(c+m)%p+0;i.push([-s[y].y,g,-s[y].x,0,0,0,0,0])}}for(c=0;c<p;++c)for(var v=0;v<6;++v){m=(t.quadToTriangle[v][0]+2*c)%f;var A=t.quadToTriangle[v][1]+1;o.push((A-1)*f+m+h)}for(var M=0;M<o.length;){var w=o[M++],T=o[M++],b=o[M++],_=new x(i[w][0],i[w][1],i[w][2]),S=new x(i[T][0],i[T][1],i[T][2]),C=new x(i[b][0],i[b][1],i[b][2]),E=_.subtract(S),R=S.subtract(C);A=E.cross(R);i[w][5]=i[w][5]+A.x,i[w][6]=i[w][6]+A.y,i[w][7]=i[w][7]+A.z,i[T][5]=i[T][5]+A.x,i[T][6]=i[T][6]+A.y,i[T][7]=i[T][7]+A.z,i[b][5]=i[b][5]+A.x,i[b][6]=i[b][6]+A.y,i[b][7]=i[b][7]+A.z}for(c=0;c<i.length;++c){var I=new x(i[c][5],i[c][6],i[c][7]);I=I.normalize(),i[c][5]=I.x,i[c][6]=I.y,i[c][7]=I.z}return{vertices:i,indices:o}}},t.convertToClockwise=function(e){t.calculatePolygonArea(e)>0&&t.reversePoints(e)},t.calculatePolygonArea=function(t){var e=t.length;if(!(e<3)){for(var n=0,i=0,o=e-1;i<e;){var r=t[o].x,a=t[o].y,s=t[i].x,u=t[i].y;o=i,i+=1,n+=r*u-s*a}return n}},t.reversePoints=function(t){for(var e=t.length,n=e/2,i=0;i<n;++i){var o=t[i];t[i]=t[e-i-1],t[e-i-1]=o}},t.quadToTriangle=[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]],t}(),tt=n(0),et=function(){function t(t,e,n,i,o,r,s){this.renderTiles=[],this.visibleTiles=[],this.mapView=t,this.tileTaskManager=e,this.mapState=n,this.tileCache=new P(a.tileCacheSize),this.tiles=new Map,this.annotationTiles=new Map,this.finishedLoad=!0,this.mapSettings=i,this.lastZoom=this.mapState.getZoom(),this.tileAreas=new Map,this.tileRequestsMap=new Map,this.buildingResourceManager=o,this.mapObjectTree=tt(),this.mapObjects=new Map,this.createAnnotationTile=r,this.requestRender=s}return t.prototype.isDirty=function(){var t=this.mapState.getZoom(),e=!0;return(this.finishedLoad||this.mapState.isZoomIn()||this.mapState.isZoomOut()||!this.mapState.isFlyingTo()&&(Math.ceil(t-s.epsilon)>t||Math.floor(t+s.epsilon)<t))&&(e=!1),e},t.prototype.update=function(t){this.isDirty()&&(this.updateRenderableTiles(t),this.updateMapObjectBounds(),this.tileRequestsMap.size||(this.finishedLoad=!0,this.lastZoom=this.mapState.getZoom()))},t.prototype.reload=function(){var t=this;this.tiles.forEach(function(t){t.tile.destroy()}),this.annotationTiles.forEach(function(t){t.tile.destroy()}),this.tiles.clear(),this.annotationTiles.clear(),this.renderTiles=[],this.tileCache.clear(),this.finishedLoad=!1,this.mapView.dirty=!0,this.tileRequestsMap.forEach(function(e){t.tileTaskManager.cancelTask(e)}),this.tileRequestsMap.clear()},t.prototype.destroy=function(){this.reload(),this.visibleTiles=[],this.buildingResourceManager.removeAllResources()},t.prototype.getRenderTiles=function(){return this.renderTiles},t.prototype.getVisibleTiles=function(){return this.visibleTiles},t.prototype.updateVisibleTilesForZoom=function(t){var e=this;this.mapState.getZoom()>this.mapSettings.getMaxNativeZoom()&&(t=this.mapSettings.getMaxNativeZoom());var n=this.mapState.getScreenSize(),i=Math.pow(2,t),o=A.projectScale(w.screenCoordinateToLatLngZoom(new y(0,0),this.mapState,t),i).multiply(1/T.getTileSize()),r=A.projectScale(w.screenCoordinateToLatLngZoom(new y(n.x,0),this.mapState,t),i).multiply(1/T.getTileSize()),a=A.projectScale(w.screenCoordinateToLatLngZoom(new y(n.x,n.y),this.mapState,t),i).multiply(1/T.getTileSize()),s=A.projectScale(w.screenCoordinateToLatLngZoom(new y(0,n.y),this.mapState,t),i).multiply(1/T.getTileSize()),u=A.projectScale(w.screenCoordinateToLatLngZoom(new y(n.x/2,n.y/2),this.mapState,t),i).multiply(1/T.getTileSize()),l=1<<Math.floor(t),h=[],c=function(t,e,n){if(n>=0&&n<=l)for(var i=t;i<e;++i){var o=i+.5-u.x,r=n+.5-u.y,a={x:i,y:n,sqDist:o*o+r*r};h.push(a)}};Z.scanTriangle(o,r,a,0,l,c),Z.scanTriangle(a,s,o,0,l,c),h.sort(function(t,e){return t.sqDist==e.sqDist?t.x==e.x?t.y-e.y:t.x-e.x:t.sqDist-e.sqDist}),h.filter(function(t,e,n){return 0==e||t.x!=n[e-1].x||t.y!=n[e-1].y}).forEach(function(n){return e.visibleTiles.push(N.createWithXYZoom(n.x,n.y,t,e.mapState.is3dMode()))})},t.prototype.updateVisibleTiles=function(){this.finishedLoad=!1,this.visibleTiles=[];var t=this.mapState.getZoom();this.mapState.isFlyingTo()?(this.updateVisibleTilesForZoom(Math.floor(t)),this.updateVisibleTilesForZoom(Math.ceil(t))):this.mapState.isZoomIn()?this.updateVisibleTilesForZoom(Math.ceil(t)):this.mapState.isZoomOut()?this.updateVisibleTilesForZoom(Math.floor(t)):this.updateVisibleTilesForZoom(t),this.cancelOutdatedTasks()},t.prototype.cancelOutdatedTasks=function(){var t=this;this.tileRequestsMap.forEach(function(e,n,i){t.visibleTiles.some(function(t){return t.getTileCoordinate().toString()==n})||(i.delete(n),t.tileTaskManager.cancelTask(e))})},t.prototype.updateRenderableTiles=function(t){var e=this,n=[],i=[],o=[];if(this.mapState.getZoom()<this.lastZoom&&0!=this.visibleTiles.length){var r=this.visibleTiles[0].getTileCoordinate().getZoom();this.renderTiles.forEach(function(t){t.getUnwrappedTileCoordinate().getTileCoordinate().getZoom()>r&&o.push(t)})}this.renderTiles=[],this.visibleTiles.forEach(function(r){var a=r.getTileCoordinate(),s=e.getTile(a);if(null==s&&(a.set3DMode(e.mapState.is3dMode()),s=e.createTile(a,t)),s.isRenderable())e.renderTiles.push(new B(r,s)),n.push(a);else{if(n.push(a),e.mapState.isFlyingTo())return;if(e.mapState.getZoom()>e.lastZoom)for(var u=r.parent();u.getTileCoordinate().getZoom()>=e.lastZoom;){if(a=u.getTileCoordinate(),null!=(s=e.getTile(a))&&s.isRenderable()){n.some(function(t){return t.equal(a)})||(n.push(a),i.push(new B(u,s)));break}u=u.parent()}else e.mapState.getZoom()<e.lastZoom&&o.forEach(function(t){var i=t.getUnwrappedTileCoordinate();i.getTileCoordinate().isChildOf(r.getTileCoordinate())&&(a=i.getTileCoordinate(),null!=(s=e.getTile(a))&&s.isRenderable()&&(n.some(function(t){return t.equal(a)})||(n.push(a),e.renderTiles.push(new B(i,s)))))})}}),0!=i.length&&(this.renderTiles.forEach(function(t){i.push(t)}),this.renderTiles=i),n.sort(function(t,e){return t.lessThan(e)?-1:t.lessThan(e)?0:1});for(var a=[],s=0;s<n.length-1;++s)n[s]!==n[s+1]&&a.push(n[s]);a.push(n[n.length-1]),n=a;var u=Array.from(this.tiles),l=Array.from(this.annotationTiles);u.sort(function(t,e){return t[1].tileCoordinate.lessThan(e[1].tileCoordinate)?-1:t[1].tileCoordinate.lessThan(e[1].tileCoordinate)?0:1}),l.sort(function(t,e){return t[1].tileCoordinate.lessThan(e[1].tileCoordinate)?-1:t[1].tileCoordinate.lessThan(e[1].tileCoordinate)?0:1});for(var h=0,c=0,p=0;h<this.tiles.size;)if(c==n.length||u[h][1].tileCoordinate.lessThan(n[c])){u[h][1].tile.getBuildings().forEach(function(t){e.buildingResourceManager.decreaseBuildingReference(t.id)}),this.tileCache.add(u[h][0],u[h][1].tile),this.tiles.delete(u[h][0].toString());var f=l[p][1].tile;this.annotationTiles.delete(l[p][0]),f.destroy(),++h,++p}else n[c].lessThan(u[h][1].tileCoordinate)||(++h,++p),++c},t.prototype.getTile=function(t){if(!this.tiles.has(t.toString())){var e=this.tileCache.pop(t.toString());if(null!=e){var n=e;return this.addBuildings(n.getBuildings(),n),this.tiles.set(t.toString(),{tileCoordinate:t,tile:e}),this.annotationTiles.set(t.toString(),{tileCoordinate:t,tile:this.createAnnotationTile(t)}),e}return null}return this.tiles.get(t.toString()).tile},t.prototype.clearTileCache=function(){this.tileCache.clear()},t.prototype.createTile=function(t,e){var n=this,i=this.tileCache.pop(t.toString());if(null==i){var o=this.mapSettings.getMapUrl(),r=t.getZoom(),s=!1;this.tileAreas.forEach(function(e){s||r<=e.getMaxZoom()&&r>=e.getMinZoom()&&G.fromLatLngBounds(e.getBounds(),r,r).contains(t)&&(o=a.baseMapUrl+"?tileUrl="+e.getUrl(),n.mapSettings.is3dMode()&&(o+="&mode=3d"),o+="&key="+D.getAccessKey(),s=!0)});var u=z.getTileUrl(o,t.getX(),t.getY(),t.getZoom());i=e(t);var l=new W(j.RasterTile);l.url=u,l.completion=function(e){if(null!=e.data){i.init(e.data.result,function(){n.requestRender(),n.tileRequestsMap.delete(t.toString())});var o=e.data.result.objects||[],r=n.mapView.mapSettings.getTime();null==r&&(r=Date.now());for(var a=o.length;a--;){var s=o[a],u=null!=s.startDate?s.startDate:Number.NEGATIVE_INFINITY,l=null!=s.endDate?s.endDate:Number.POSITIVE_INFINITY;(u>r||l<r)&&o.splice(a,1)}n.addBuildings(o,i);var h=i;if(h.addBuildings(o),n.mapState.is3dMode()){var c=w.tileCoordinateToLatLngBounds(i.getTileCoordinate()),p={minX:c.getSouthwest().lng(),minY:c.getSouthwest().lat(),maxX:c.getNortheast().lng(),maxY:c.getNortheast().lat()},f=[];n.mapObjectTree.search(p).forEach(function(t){var e={id:t.getId(),name:t.getName(),location:t.getLocation(),scale:t.getScale(),bearing:t.getBearing(),elevation:t.getElevation(),heightScale:t.getHeightScale(),model:{type:"External",objName:t.getObjUrl(),objData:t.getObjData(),textureName:t.getTextureUrl(),textureData:t.getTextureData()}};f.push(e),h.getBuildings().push(e)}),n.addBuildings(f,i)}}},this.tileRequestsMap.set(t.toString(),l),this.tileTaskManager.postTask(l)}return null!=this.tiles&&this.tiles.set(t.toString(),{tileCoordinate:t,tile:i}),this.annotationTiles.set(t.toString(),{tileCoordinate:t,tile:this.createAnnotationTile(t)}),i},t.prototype.addTileArea=function(t,e){this.tileAreas.set(t,e),this.reload()},t.prototype.updateTileArea=function(t,e){this.tileAreas.has(t)&&(this.tileAreas.delete(t),this.addTileArea(t,e))},t.prototype.removeTileArea=function(t){this.tileAreas.has(t)&&(this.tileAreas.delete(t),this.reload())},t.prototype.addBuildings=function(t,e){var n=this;t.forEach(function(t){if(n.buildingResourceManager.hasBuilding(t.id))n.buildingResourceManager.increaseBuildingReference(t.id);else{var e=new J;if(e.setId(t.id),null==t.name?e.setName("Unknown name"):e.setName(t.name),e.setPlaces(t.places),e.setScale(new x(t.scale,t.scale,t.scale*t.heightScale)),e.setBearing(t.bearing),e.setLocation(t.location),e.setElevation(t.elevation),e.setHeightScale(t.heightScale),e.setCamera(t.camera),e.setTypes(t.types),e.setVerified(t.isVerified),e.setMinZoom(t.minZoom),e.setMaxZoom(t.maxZoom),e.setStartDate(t.startDate),e.setEndDate(t.endDate),e.setObjName(t.model.objName),null!=t.model.objData&&(e.setObjName(t.id),e.setObjData(t.model.objData)),e.setTextureName(t.model.textureName),null!=t.model.textureData&&(e.setTextureName(t.id),e.setTextureData(t.model.textureData)),e.setBuildingType(n.getBuildingType(t.model)),e.getBuildingType()==Y.Polygon){for(var i=A.convertToMeterFromLatLng(e.getLocation()),o=[],r=[],a=0;a<t.model.coordinates.length;++a){var s=t.model.coordinates[a],u=A.convertToMeterFromLatLng(p.convert(s));r.push(new g(u.x-i.x,i.y-u.y))}o.push(r);var l=$.extrudePolygon(o,1);n.buildingResourceManager.addBuildingWithData(t.id,e,l.vertices,l.indices)}else n.buildingResourceManager.addBuilding(t.id,e)}})},t.prototype.getBuildingType=function(t){var e=t.type;return"Object"==e?"boxtexture.png"==t.textureName?Y.Color:Y.Texture:"Polygon"==e?Y.Polygon:"External"==e?Y.External:void 0},t.prototype.addMapObject=function(t){this.mapObjectTree.insert(t),this.mapObjects.set(t.getId(),t)},t.prototype.removeMapObject=function(t){var e=this.mapObjects.get(t);this.mapObjectTree.remove(e),this.mapObjects.delete(t)},t.prototype.updateMapObjectBounds=function(){var t=this;this.mapObjects.forEach(function(e){if(e.isNeedUpdateBounds()){var n=t.buildingResourceManager.buildings.get(e.getId());if(null!=n){var i=n.building.getBounds();0==i.minX&&0==i.minY&&0==i.maxX&&0==i.maxY||(e.setNeedUpdateBounds(!1),e.updateBounds(i.minX,i.minY,i.maxX,i.maxY))}}})},t}(),nt=function(){function t(){}return Object.defineProperty(t,"isWorker",{get:function(){try{return!window.document}catch(t){return!0}},enumerable:!0,configurable:!0}),t}(),it=function(){function t(t){this.maxTask=3,this.numberOfRunningTask=0,this.worker=t}return t.prototype.finishedTask=function(){this.numberOfRunningTask-=1},t.prototype.canExecuteTask=function(){return this.numberOfRunningTask<this.maxTask},t.prototype.executeTask=function(t){if(this.canExecuteTask()){var e={execute:!0,payload:JSON.stringify(t)};this.worker.postMessage(e),this.numberOfRunningTask+=1}},t.prototype.cancel=function(t){var e={execute:!1,payload:JSON.stringify(t)};this.worker.postMessage(e),this.numberOfRunningTask=Math.min(this.numberOfRunningTask-1,0)},t}(),ot=function(){return function(){this.numberOfVertices=0,this.data=[]}}(),rt=function(){function t(){}return t.loadModel=function(t){if(0==t.length)return null;for(var e=t.split("\n").map(function(t){return t.trim().toLowerCase().split(" ").filter(function(t){return""!==t})}),n=[new x],i=[new x],o=[new y],r=[],a=null,s=0,u=e;s<u.length;s++){var l=u[s],h=l[0];if("v"==h){var c=+l[1]||0,p=+l[2]||0,f=+l[3]||0;n.push(new x(c,p,f))}else if("vn"==h){c=+l[1]||0,p=+l[2]||0,f=+l[3]||0;i.push(new x(c,p,f))}else if("vt"==h){c=+l[1]||0,p=+l[2]||0;o.push(new y(c,p))}else if("f"==h)for(var d=0;d<3;d++){var g=l[d+1].split("/"),m=n[+g[0]||0],v=o[+g[1]||0],A=i[+g[2]||0];a||(a=new ot,r.push(a)),a.data.push(m.x),a.data.push(m.y),a.data.push(m.z),a.data.push(v.x),a.data.push(v.y),a.data.push(A.x),a.data.push(A.y),a.data.push(A.z),a.numberOfVertices++}}return r},t}(),at=function(){function t(t){this.id=t}return t.prototype.abort=function(){null!=this.request&&this.request.abort()},t}(),st=function(){function t(){}return t.createWorker=function(t){var e=this.workerUrl,n=new Worker(e),i=new it(n);return n.onmessage=function(e){var n=e.data;i.finishedTask(),t(n)},i},Object.defineProperty(t,"workerUrl",{get:function(){for(var t=document.getElementsByTagName("script"),e=[],n=0;n<t.length;++n){var i=t[n];i.src.indexOf("map4dsdk@")>-1&&e.push(i.src)}var o="importScripts("+e.map(function(t){return'"'+t+'"'}).join(",")+");",r=new Blob([o],{type:"application/javascript"});return window.URL.createObjectURL(r)},enumerable:!0,configurable:!0}),t.setupWorkerThread=function(){var t=this;self.onmessage=function(e){var n=e.data;n.execute?t.execute(JSON.parse(n.payload)):t.cancel(JSON.parse(n.payload))}},t.execute=function(t){var e=new at(t.id);if(this.executeTasks.push(e),t.type==j.Texture){var n=new XMLHttpRequest;return n.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE){var e=new X(t.id);200==n.status&&(e.success=!0,e.data=this.response),postMessage(e)}},n.open("GET",t.url),n.responseType="blob",n.send(),void(e.request=n)}if(t.type==j.Model){var i=new XMLHttpRequest;return i.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE){var e=new X(t.id);200==i.status&&(e.success=!0,e.data=rt.loadModel(this.responseText)),postMessage(e)}},i.open("GET",t.url),i.send(),void(e.request=i)}var o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState==XMLHttpRequest.DONE){var e=new X(t.id);200==o.status&&(e.success=!0,e.data=JSON.parse(o.responseText)),postMessage(e)}},o.open(t.method,t.url,!0),null!=t.params&&o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Accept","application/json"),o.send(t.params),e.request=o},t.cancel=function(t){var e=this.removeTask(t.id);null!=e&&e.abort()},t.removeTask=function(t){var e=this.executeTasks.findIndex(function(e){return e.id==t});if(e>=0){var n=this.executeTasks[e];return this.executeTasks.splice(e,1),n}return null},t.executeTasks=[],t}();nt.isWorker&&st.setupWorkerThread();var ut,lt=function(){function t(){var t=this;this.maxConcurrentRequest=5,this.maxWorker=3,this.workers=[],this.pendingTasks=[],this.activedTasks=[];for(var e=0;e<this.maxWorker;++e){var n=st.createWorker(function(e){t.onCompletionTask(e)});this.workers.push(n)}for(e=0;e<j.MAX;e++)this.pendingTasks.push([])}return t.prototype.postTask=function(t){this.pendingTasks[t.type].unshift(t),this.executeTasks()},t.prototype.executeTasks=function(){if(!(this.activedTasks.length>this.maxConcurrentRequest))for(var t=0,e=this.workers;t<e.length;t++){var n=e[t];if(n.canExecuteTask()&&this.hasTask()){var i=this.getTask();this.activedTasks.push(i),i.worker=n,n.executeTask(i)}}},t.prototype.hasTask=function(){for(var t=0;t<j.MAX;t++)if(this.pendingTasks[t].length>0)return!0;return!1},t.prototype.getTask=function(){for(var t=0;t<j.MAX;t++)if(this.pendingTasks[t].length>0)return this.pendingTasks[t].pop();return null},t.prototype.cancelTask=function(t){var e=this.removeTask(t.id);null!=e&&(e.worker&&e.worker.cancel(e),e.completion&&e.completion(new X(t.id)))},t.prototype.onCompletionTask=function(t){var e=this.activedTasks.findIndex(function(e){return e.id==t.id});if(e<0)this.executeTasks();else{var n=this.activedTasks[e];this.activedTasks.splice(e,1),n.completion&&n.completion(t),this.executeTasks()}},t.prototype.removeTask=function(t){for(var e=0;e<j.MAX;e++){var n=this.pendingTasks[e].findIndex(function(e){return e.id==t});if(n>=0){var i=this.pendingTasks[e][n];return this.pendingTasks[e].splice(n,1),i}}var o=this.activedTasks.findIndex(function(e){return e.id==t});if(o>=0){i=this.activedTasks[o];return this.activedTasks.splice(o,1),i}return null},t}(),ht=n(3);!function(t){t[t.RASTER=0]="RASTER",t[t.BUILDING=1]="BUILDING",t[t.ANNOTATION=2]="ANNOTATION",t[t.LINE=3]="LINE",t[t.FILL=4]="FILL",t[t.CIRCLE=5]="CIRCLE"}(ut||(ut={}));var ct=function(){function t(t,e){void 0===e&&(e=0),this.id=t,this.order=e}return t.prototype.equal=function(t){return this.id==t.id},t.prototype.lessThan=function(t){return this.order==t.order?this.id<t.id:this.order<t.order},t}();function pt(t,e){return t.order==e.order?t.id==e.id?0:t.id>e.id:t.order>e.order}var ft,dt,gt=function(){function t(t,e,n,i){this.layerId=new ct(t,e),this.layerType=n,this.tileManager=i}return t.prototype.getOrder=function(){return this.layerId.order},t.prototype.getLayerId=function(){return this.layerId.id},t.prototype.getLayerType=function(){return this.layerType},t}(),mt=function(){return function(t,e,n,i,o){void 0===i&&(i=0),void 0===o&&(o=0),this.name=t,this.buffer=e,this.size=n,this.offset=i,this.stride=o}}(),yt=function(){return function(t,e,n){this.name=t,this.type=e,this.value=n}}(),vt=function(){function t(t,e,n){this.gl=t,this.textureUnit=0,this.uniforms={},this.attributes={},this.program=t.createProgram(),this.fragmentShader=this.loadShader(t.FRAGMENT_SHADER,n),this.vertexShader=this.loadShader(t.VERTEX_SHADER,e),t.attachShader(this.program,this.vertexShader),t.attachShader(this.program,this.fragmentShader),t.linkProgram(this.program),t.getProgramParameter(this.program,t.LINK_STATUS)||(console.log("Error linking shader program"),console.log(t.getProgramInfoLog(this.program))),this.loadAttributes(),this.loadUniforms()}return t.prototype.loadAttributes=function(){for(var t=this.gl,e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),n=0;n<e;++n){var i=t.getActiveAttrib(this.program,n).name;this.attributes[i]=t.getAttribLocation(this.program,i)}},t.prototype.loadUniforms=function(){for(var t=this.gl,e=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),n=0;n<e;++n){var i=t.getActiveUniform(this.program,n).name;this.uniforms[i]=t.getUniformLocation(this.program,i)}},t.prototype.loadShader=function(t,e){var n=this.gl,i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),n.getShaderParameter(i,n.COMPILE_STATUS)||(console.log("Error loading shader"),console.log(e),console.log(n.getShaderInfoLog(i))),i},t.prototype.bind=function(){this.gl.useProgram(this.program),this.resetTextureUnit()},t.prototype.resetTextureUnit=function(){this.textureUnit=0},t.prototype.setAttributes=function(t){for(var e=this.gl,n=null,i=0,o=t;i<o.length;i++){var r=o[i],a=this.attributes[r.name];r.buffer!=n&&(n=r.buffer,e.bindBuffer(e.ARRAY_BUFFER,n)),null!=a&&(e.enableVertexAttribArray(a),e.vertexAttribPointer(a,r.size,e.FLOAT,!1,4*r.stride,4*r.offset))}},t.prototype.setUniforms=function(t){for(var e=this.gl,n=0,i=t;n<i.length;n++){var o=i[n],r=this.uniforms[o.name];if(null!==r)if("matrix"==o.type)e.uniformMatrix4fv(r,!1,o.value.buffer());else if("texture"==o.type)e.activeTexture(e.TEXTURE0+this.textureUnit),e.bindTexture(e.TEXTURE_2D,o.value.textureId),e.uniform1i(r,this.textureUnit),this.textureUnit+=1;else if("textureCube"==o.type)e.activeTexture(e.TEXTURE0+this.textureUnit),e.bindTexture(e.TEXTURE_CUBE_MAP,o.value.textureId),e.uniform1i(r,this.textureUnit),this.textureUnit+=1;else if("3f"==o.type)e.uniform3f(r,o.value.x,o.value.y,o.value.z);else{e["uniform"+o.type](r,o.value)}}},t.prototype.disableAttributes=function(){for(var t in this.attributes)this.gl.disableVertexAttribArray(this.attributes[t])},t.prototype.destroy=function(){this.uniforms={},this.attributes={},this.gl.deleteProgram(this.program),this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader)},t}(),xt=function(){function t(t,e,n,i,o,r){if(void 0===n&&(n=null),void 0===i&&(i=null),void 0===o&&(o=null),this.gl=t,this.type=e,this.attributeInfos=[],this.uniformInfos=[],n){this.vertices=n.length;for(var a=[],s=0,u=n;s<u.length;s++)for(var l=u[s],h=0,c=i;h<c.length;h++)for(var p=0,f=l[v=c[h]];p<f.length;p++){var d=f[p];a.push(d)}this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(a),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null);for(var g=n[0],m=0,y=0;y<i.length;++y){var v=i[y],x=o[y],A=g[v].length,M=new mt(x,this.buffer,A,m,0);this.attributeInfos.push(M),m+=A}for(var w=0,T=this.attributeInfos;w<T.length;w++){(M=T[w]).stride=m}null!=r&&this.setIndices(r)}}return t.prototype.init=function(t,e,n){var i=this;if(void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=null),null!=this.gl&&null!=t&&null!=n&&null!=e){this.type=this.gl.TRIANGLES;var o=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.setIndices(n),this.buffer=o,this.vertices=n.length,e.forEach(function(t){return t.buffer=i.buffer}),this.attributeInfos=e}else console.log("GL or data or dicies is missing")},t.prototype.initBuilding=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=null),null!=this.gl){this.type=this.gl.TRIANGLES;var n=this.gl.createBuffer();if(null!=t){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.buffer=n;null!=e?this.setIndices(e):this.vertices=t.length/8,this.attributeInfos=[new mt("a_position",n,3,0,8),new mt("a_uv",n,2,3,8),new mt("a_normal",n,3,5,8)]}else console.log("Vertices size can not be null")}else console.log("init model Building no data")},t.prototype.setIndices=function(t){if(t){var e=this.gl;this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Int16Array(t),e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.vertices=t.length}},t.prototype.render=function(){var t=this.gl;this.indexBuffer?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.drawElements(this.type||t.TRIANGLES,this.vertices,t.UNSIGNED_SHORT,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindBuffer(t.ARRAY_BUFFER,null)):this.vertices>0&&(t.drawArrays(this.type||t.TRIANGLES,0,this.vertices),t.bindBuffer(t.ARRAY_BUFFER,null))},t.prototype.setUniform=function(t){this.uniformInfos.push(t)},t.prototype.destroy=function(){this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null),this.indexBuffer&&(this.gl.deleteBuffer(this.indexBuffer),this.indexBuffer=null),this.attributeInfos=[],this.uniformInfos=[]},t}(),At=function(){function t(){}return t.basicVS="\nattribute vec3 a_position;\nattribute vec2 a_uv;\n\nuniform mat4 u_mvpMatrix;\n\nvarying vec2 v_uv;\n\nvoid main() {\n\tgl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n\tv_uv = a_uv;\n}\n   ",t.basicFS="\nprecision mediump float;\n\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\n\nvoid main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n}  \n  ",t.polylineVS="\nattribute vec2 a_position;\nattribute vec2 a_extrude;\n\nuniform float u_lineWidth;\nuniform mat4 u_mvpMatrix;\n\nvoid main() {\n\tvec2 delta = (u_lineWidth / 2.0) * a_extrude;\n\n\tgl_Position = u_mvpMatrix * vec4(a_position + delta, 0.0, 1.0);\n}\n  ",t.polylineFS="\nprecision mediump float;\n\nuniform vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}  \n  ",t.fillVS="\nattribute vec2 a_position;\n\nuniform mat4 u_mvpMatrix;\n\nvoid main() {\n\tgl_Position = u_mvpMatrix * vec4(a_position, 0.0, 1.0);\n}\n  ",t.fillFS="\nprecision mediump float;\n\nuniform vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n  ",t.circleVS="\nattribute vec2 a_extrude;\n\nuniform float u_radius;\nuniform mat4 u_mvpMatrix;\n\nvoid main() {\n  gl_Position = u_mvpMatrix * vec4(u_radius * a_extrude, 0.0, 1.0);\n}\n  ",t.circleFS="\nprecision mediump float;\n\nuniform vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n  ",t.markerVS="\nattribute vec3 a_position;\nattribute vec2 a_uv;\n\nuniform mat4 u_mvpMatrix;\n\nvarying vec2 v_uv;\n\nvoid main() {\n\tgl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n\tv_uv = a_uv;\n}\n  ",t.markerFS="\nprecision mediump float;\n\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\n\nvoid main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n}\n  ",t.buildingVS="\nattribute vec3 a_position;\nattribute vec2 a_uv;\nattribute vec3 a_normal;\n\nuniform mat4 u_modelMatrix;\nuniform mat4 u_mvpMatrix;\nuniform vec3 u_light_color;\nuniform vec3 u_light_position;\n\nvarying vec2 v_uv;\nvarying vec3 v_lighting;\n\nvoid main() {\n    float u_light_intensity = 1.0;  \n    gl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n    v_uv = a_uv;\n    // Convert normal vector to world space (make sure that we don't translate it)\n    vec3 normal = normalize(vec3((u_modelMatrix * vec4(a_normal, 0.0)).xyz));\n    \n    float directional = max(0.0, dot(normal, normalize(u_light_position)));\n    directional = mix((1.0 - u_light_intensity), max((0.5 + u_light_intensity), 1.0), directional);\n    v_lighting = clamp(directional * u_light_color, mix(vec3(0.0), vec3(0.3), 1.0 - u_light_color), vec3(1.0)); \n}\n  ",t.buildingFS="\nprecision mediump float;\n\nuniform sampler2D u_texture;\n\nvarying vec2 v_uv;\nvarying vec3 v_lighting;\n\nvoid main() {\n    vec4 materialColor = texture2D(u_texture, v_uv);\n    gl_FragColor = vec4(mix(materialColor.rgb, v_lighting, 0.2), materialColor.a); \n    if (gl_FragColor.a < 0.3) {\n      discard;\n    }\n}\n  ",t.buildingSelectionVS="\nattribute vec3 a_position;\nuniform mat4 u_mvpMatrix;\n\nvoid main() {\n    gl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n}\n  ",t.buildingSelectionFS="\nprecision mediump float;\nuniform vec3 u_color;\n\nvoid main() {\n    gl_FragColor = vec4(u_color, 1.0);\n}\n  ",t.debugSelectionVS="\n    attribute vec3 a_position;\n    attribute vec2 a_uv;\n    \n    varying vec2 v_uv;\n    \n    void main() {\n      gl_Position = vec4(a_position, 1.0);\n      v_uv = a_uv;\n    }\n  ",t.debugSelectionFS="\n    precision mediump float;\n    \n    uniform sampler2D u_texture;\n    varying vec2 v_uv;\n    \n    void main() {\n        gl_FragColor = texture2D(u_texture, vec2(v_uv.x , 1.0 - v_uv.y));\n    }\n\n  ",t}();!function(t){t[t.Butt=0]="Butt",t[t.Square=1]="Square",t[t.Round=2]="Round"}(ft||(ft={})),function(t){t[t.Miter=0]="Miter",t[t.Bevel=1]="Bevel",t[t.Round=2]="Round"}(dt||(dt={}));var Mt=function(){return function(t){void 0===t&&(t=function(t){}),this.indices=[],this.addVertex=t}}();var wt=function(){return function(t){void 0===t&&(t=function(t){}),this.indices=[],this.addVertex=t}}();function Tt(t,e){var n=[],i=[];t.forEach(function(t,o){0!=o&&i.push(n.length/2),t.forEach(function(t){n.push(t.x),n.push(t.y),e.addVertex(t)})}),e.indices=K()(n,i)}var bt,_t,St,Ct=function(){function t(t,e,n,i,o){void 0===t&&(t=function(t,e){}),void 0===e&&(e=ft.Butt),void 0===n&&(n=dt.Bevel),void 0===i&&(i=!1),void 0===o&&(o=3),this.indices=[],this.addVertex=t,this.lineCapType=e,this.lineJoinType=n,this.closedPolyline=i,this.miterLimit=o,this.numVertices=0}return t.prototype.buildPolyLine=function(t,e){void 0===e&&(e=null),this.buildPolyLineSegment(t,e)},t.prototype.clear=function(){this.indices=[],this.numVertices=0},t.prototype.buildPolyLineSegment=function(t,e){var n=this.closedPolyline?t.length+2:t.length,i=t.length,o=n-0;if(!(o<2)){var r,a,s,u=t[0],h=t[1];a=new y(h.y-u.y,u.x-h.x).normalize(),this.closedPolyline||this.addCap(u,a,!0),this.addPolyLineVertex(u,a),this.addPolyLineVertex(u,a.multiply(-1));for(var c=1;c<o-1;++c){if((u=h)!=(h=t[(c+0+1)%i])){r=a,a=new y(h.y-u.y,u.x-h.x).normalize();var p=1;0==(s=r.add(a)).x&&0==s.y?s=new y(r.y-a.y,a.x-r.x):p=2/s.dot(s),s=s.multiply(p);var f=this.lineJoinType==dt.Bevel;if(s.length>this.miterLimit&&(f=!0,s=s.multiply(this.miterLimit/s.length)),this.lineJoinType!=dt.Miter||f){var d=f||this.lineJoinType==dt.Bevel?1:l.numTrianglesOnRoundJoin;a.x*r.y-a.y*r.x>0?(this.addPolyLineVertex(u,s),this.addPolyLineVertex(u,r.multiply(-1)),this.addIndices(),this.addFan(u,r.multiply(-1),a.multiply(-1),s,d),this.addPolyLineVertex(u,s),this.addPolyLineVertex(u,a.multiply(-1))):(this.addPolyLineVertex(u,r),this.addPolyLineVertex(u,s.multiply(-1)),this.addIndices(),this.addFan(u,r,a,s.multiply(-1),d),this.addPolyLineVertex(u,a),this.addPolyLineVertex(u,s.multiply(-1)))}else this.addPolyLineVertex(u,s),this.addPolyLineVertex(u,s.multiply(-1)),this.addIndices()}}this.addPolyLineVertex(h,a),this.addPolyLineVertex(h,a.multiply(-1)),this.addIndices(),this.closedPolyline||this.addCap(h,a,!1),e&&e()}},t.prototype.addCap=function(t,e,n){switch(this.lineCapType){case ft.Butt:break;case ft.Square:var i=new y(-e.y,e.x);this.addPolyLineVertex(t,e.add(i)),this.addPolyLineVertex(t,e.multiply(-1).add(i)),n||this.addIndices();break;case ft.Round:var o=e,r=e.multiply(-1),a=new y(0,0);n&&(o=o.multiply(-1),r=r.multiply(-1)),this.addFan(t,o,r,a,l.numTrianglesOnRoundCap);break;default:console.log("Invalid line cap type")}},t.prototype.addPolyLineVertex=function(t,e){++this.numVertices,this.addVertex(t,e)},t.prototype.addIndices=function(){this.indices.push(this.numVertices-4),this.indices.push(this.numVertices-2),this.indices.push(this.numVertices-3),this.indices.push(this.numVertices-3),this.indices.push(this.numVertices-2),this.indices.push(this.numVertices-1)},t.prototype.addFan=function(t,e,n,i,o){var r=e.x*n.y-e.y*n.x,a=Math.atan2(r,e.dot(n)),s=this.numVertices;this.addPolyLineVertex(t,i),this.addPolyLineVertex(t,e);for(var u=e,l=0;l<o;l++){var h=(l+1)/o;u=e.rotateByRadian(a*h),this.addPolyLineVertex(t,u),this.indices.push(s),this.indices.push(s+l+(a>0?1:2)),this.indices.push(s+l+(a>0?2:1))}},t}(),Et=function(){return function(t,e){this.min=t,this.mag=e}}(),Rt=function(){return function(t,e){this.wraps=t,this.wrapt=e}}(),It=function(){return function(t,e,n,i,o,r){this.target=t,this.internalFormat=e,this.format=n,this.type=i,this.filtering=o,this.wrapping=r}}(),Lt=function(){function t(t,e){void 0===e&&(e=null),this.gl=t,this.options=e,null==e&&this.initDefault()}return t.prototype.initDefault=function(){var t=this.gl;this.textureId=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.textureId);var e=new Uint8Array([255,255,255,255]);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null)},t.prototype.initWithSize=function(t,e){var n=this.gl;this.width=t,this.height=e,this.textureId=n.createTexture(),n.bindTexture(this.options.target,this.textureId),this.setTextureParameter(this.gl.TEXTURE_MAG_FILTER,this.options.filtering.mag),this.setTextureParameter(this.gl.TEXTURE_MIN_FILTER,this.options.filtering.min),this.setTextureParameter(this.gl.TEXTURE_WRAP_S,this.options.wrapping.wraps),this.setTextureParameter(this.gl.TEXTURE_WRAP_T,this.options.wrapping.wrapt),n.texImage2D(this.options.target,0,this.options.internalFormat,this.width,this.height,0,this.options.format,this.options.type,null),n.bindTexture(n.TEXTURE_2D,null)},t.prototype.bind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.textureId)},t.prototype.unbind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,null)},t.prototype.loadImage=function(t,e){var n=this;void 0===e&&(e=null);var i=this.gl,o=new Image;-1!=t.indexOf("data:image")?o.src=t:o.src="data:image;base64,"+t,o.onload=function(){null!=n.textureId&&(i.bindTexture(i.TEXTURE_2D,n.textureId),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,0),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,o),i.generateMipmap(i.TEXTURE_2D),i.bindTexture(i.TEXTURE_2D,null)),n.width=o.width,n.height=o.height,e&&e()}},t.prototype.loadImageFromBlob=function(t,e){var n=this;void 0===e&&(e=null);var i=this.gl,o=new Image;o.crossOrigin="*";var r=window.URL.createObjectURL(t);o.src=r,o.onload=function(){null!=n.textureId&&(i.bindTexture(i.TEXTURE_2D,n.textureId),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,o),i.generateMipmap(i.TEXTURE_2D),i.bindTexture(i.TEXTURE_2D,null)),n.width=o.width,n.height=o.height,e&&e(),window.URL.revokeObjectURL(r)}},t.prototype.loadImageFromUrl=function(t,e){var n=this;void 0===e&&(e=null);var i=this.gl,o=new Image;o.crossOrigin="*",o.src=t,o.onload=function(){null!=n.textureId&&(i.bindTexture(i.TEXTURE_2D,n.textureId),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,o),i.generateMipmap(i.TEXTURE_2D),i.bindTexture(i.TEXTURE_2D,null)),n.width=o.width,n.height=o.height,e&&e()}},t.prototype.setFilter=function(t){var e=this.gl;e.bindTexture(e.TEXTURE_2D,this.textureId),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.bindTexture(e.TEXTURE_2D,null)},t.prototype.destroy=function(){this.textureId&&(this.gl.deleteTexture(this.textureId),this.textureId=null)},t.prototype.setTextureParameter=function(t,e){null!=t&&this.gl.texParameteri(this.options.target,t,e)},t}();!function(t){t[t.MARKER_SHADER=0]="MARKER_SHADER",t[t.POLYLINE_SHADER=1]="POLYLINE_SHADER",t[t.FILL_SHADER=2]="FILL_SHADER",t[t.RASTER_SHADER=3]="RASTER_SHADER",t[t.CIRCLE_SHADER=4]="CIRCLE_SHADER",t[t.BUILDING_SHADER=5]="BUILDING_SHADER",t[t.BUILDING_SELECTION_SHARDER=6]="BUILDING_SELECTION_SHARDER",t[t.DEBUG_SELECTION_SHARDER=7]="DEBUG_SELECTION_SHARDER",t[t.PARTICLE_SHADER=8]="PARTICLE_SHADER"}(bt||(bt={})),function(t){t[t.MARKER_MODEL=0]="MARKER_MODEL",t[t.RASTER_MODEL=1]="RASTER_MODEL",t[t.CIRCLE_MODEL=2]="CIRCLE_MODEL",t[t.POLYLINE_SHADER=3]="POLYLINE_SHADER",t[t.BUILDING_MODEL=4]="BUILDING_MODEL",t[t.SELECTION_DEBUG_MODEL=5]="SELECTION_DEBUG_MODEL",t[t.PARTICLE_QUAD_MODEL=6]="PARTICLE_QUAD_MODEL"}(_t||(_t={})),function(t){t[t.WHITE_TEXTURE=0]="WHITE_TEXTURE",t[t.RAIN_TEXTURE=1]="RAIN_TEXTURE",t[t.SNOW_TEXTURE=2]="SNOW_TEXTURE"}(St||(St={}));var Ot,Dt=function(){function t(){this.initialized=!1,this.shaders=new Map,this.models=new Map,this.textures=new Map}return Object.defineProperty(t,"Instance",{get:function(){return this.instance||(this.instance=new this)},enumerable:!0,configurable:!0}),t.prototype.createShader=function(t,e){return new vt(this.gl,t,e)},t.prototype.createModel=function(t){var e=this.gl,n=new xt(e,e.TRIANGLES),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null);var o=[new mt("a_position",i,3,0,5),new mt("a_uv",i,2,3,5)];return n.vertices=6,n.buffer=i,n.attributeInfos=o,n},t.prototype.init=function(t){if(this.gl=t,!this.initialized){this.initialized=!0;var e=this.createShader(At.basicVS,At.basicFS);this.shaders.set(bt.RASTER_SHADER,e),this.shaders.set(bt.MARKER_SHADER,this.createShader(At.markerVS,At.markerFS)),this.shaders.set(bt.POLYLINE_SHADER,this.createShader(At.polylineVS,At.polylineFS)),this.shaders.set(bt.FILL_SHADER,this.createShader(At.fillVS,At.fillFS)),this.shaders.set(bt.CIRCLE_SHADER,this.createShader(At.circleVS,At.circleFS)),this.shaders.set(bt.BUILDING_SHADER,this.createShader(At.buildingVS,At.buildingFS)),this.shaders.set(bt.BUILDING_SELECTION_SHARDER,this.createShader(At.buildingSelectionVS,At.buildingSelectionFS)),this.shaders.set(bt.DEBUG_SELECTION_SHARDER,this.createShader(At.debugSelectionVS,At.debugSelectionFS)),this.shaders.set(bt.PARTICLE_SHADER,e);var n=new Float32Array([-1,-1,0,0,1,-1,1,0,0,0,1,1,0,1,0,-1,-1,0,0,1,1,1,0,1,0,1,-1,0,1,1]),i=this.createModel(n),o=[],r=new Mt;r.addVertex=function(t){o.push(t.x,t.y)},function(t){var e=l.numTrianglesPerCircle,n=2*Math.PI;t.addVertex(new y(0,0));for(var i=0;i<e;++i)t.addVertex(new y(Math.cos(i*n/e),Math.sin(i*n/e)).normalize()),0!=i&&(t.indices.push(0),t.indices.push(0+i),t.indices.push(0+i+1));t.indices.push(0),t.indices.push(e),t.indices.push(1)}(r);var a=new xt(this.gl,this.gl.TRIANGLES);a.init(o,[new mt("a_extrude",null,2,0,2)],r.indices),this.models.set(_t.RASTER_MODEL,i),this.models.set(_t.MARKER_MODEL,i),this.models.set(_t.CIRCLE_MODEL,a),this.models.set(_t.SELECTION_DEBUG_MODEL,i),this.models.set(_t.PARTICLE_QUAD_MODEL,i);var s=new Lt(this.gl);this.textures.set(St.WHITE_TEXTURE,s);var u=new Lt(this.gl);u.loadImageFromUrl(b.get("rainTexture"),null),this.textures.set(St.RAIN_TEXTURE,u);var h=new Lt(this.gl);h.loadImageFromUrl(b.get("snowTexture"),null),this.textures.set(St.SNOW_TEXTURE,h)}},t.prototype.getShader=function(t){return this.shaders.get(t)},t.prototype.getModel=function(t){return this.models.get(t)},t.prototype.getTexture=function(t){return this.textures.get(t)},t.instance=null,t}();!function(t){t[t.RASTER=0]="RASTER",t[t.ANNOTAION=1]="ANNOTAION"}(Ot||(Ot={}));var Pt,Bt=function(){function t(t,e,n){this.renderable=!1,this.kind=t,this.tileCoordinate=e,this.gl=n}return t.prototype.isRenderable=function(){return this.renderable},t.prototype.getKind=function(){return this.kind},t.prototype.getTileCoordinate=function(){return this.tileCoordinate},t}(),kt=function(){function t(t,e){this.mapState=t,this.layer=e,this.selectionCode=0}return t.prototype.renderSelection=function(){},t.prototype.getRenderTiles=function(){return this.layer.tileManager.getRenderTiles()},t.prototype.getVisibleTiles=function(){return this.layer.tileManager.getVisibleTiles()},t.prototype.getSelectionCode=function(){return this.selectionCode++,(this.selectionCode<t.MIN_SELECTION_CODE||this.selectionCode>t.MAX_SELECTION_CODE)&&(this.selectionCode=t.MIN_SELECTION_CODE),this.selectionCode},t.prototype.resetSelectionCode=function(){this.selectionCode=0},t.MIN_SELECTION_CODE=1,t.MAX_SELECTION_CODE=16777215,t}(),Nt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Zt=function(t){function e(e,n){return t.call(this,e,n)||this}return Nt(e,t),e.prototype.render=function(){var t=this,e=Dt.Instance.getShader(bt.RASTER_SHADER),n=Dt.Instance.getModel(_t.RASTER_MODEL);this.getRenderTiles().forEach(function(i){var o=i.getTile();if(o.getKind()==Ot.RASTER){var r=t.mapState.getViewProjectionMatrix(),a=t.mapState.matrixFor(i.getUnwrappedTileCoordinate()).concat(r);e.bind(),e.setAttributes(n.attributeInfos);var s=o.getTexture();e.setUniforms([new yt("u_texture","texture",s),new yt("u_mvpMatrix","matrix",a)]),n.render()}else console.log("Tile is not raster tile")})},e}(kt),Ft=function(){return function(){}}();!function(t){t[t.MARKER=0]="MARKER"}(Pt||(Pt={}));var Ut=function(){function t(t){this.shapeType=t}return t.prototype.update=function(t){},t.prototype.getShapeType=function(){return this.shapeType},t}(),jt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),zt=function(t){function e(e){var n=t.call(this)||this;return n.gl=e,n}return jt(e,t),e.prototype.render=function(t,e){var n=Dt.Instance.getShader(bt.MARKER_SHADER),i=Dt.Instance.getModel(_t.MARKER_MODEL);if(t.getShapeType()==Pt.MARKER){var o=t;if(o.isVisible()){o.hasTexture()||o.initTexture(this.url),n.bind(),n.setAttributes(i.attributeInfos);var r=o.getTexture(),a=o.getWidth()*T.pixelScale,s=o.getHeight()*T.pixelScale,u=w.latLngToScreenCoordinate(o.getPosition(),o.getElevation(),e),l=L.translate(u.x,u.y,0),h=o.getAnchor();l=L.translate((.5-h.x)*a,(.5-h.y)*s,0).concat(l);var c=(l=L.scale(a/2,s/2,1).concat(l)).concat(e.getOrthoProjectionMatrix());n.setUniforms([new yt("u_mvpMatrix","matrix",c),new yt("u_texture","texture",r)]),i.render()}}else console.warn("Shape is not MARKER ...")},e.prototype.enableBlend=function(){this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)},e.prototype.disableBlend=function(){this.gl.disable(this.gl.BLEND)},e}(Ft),Vt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Yt=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.mapState=e,i.layer=n,i.markerRenderer=new zt(i.layer.tileManager.mapView.gl),i}return Vt(e,t),e.prototype.render=function(){var t=this;if(this.layer.getLayerType()==ut.ANNOTATION){var e=this.layer,n=e.markerAnnotations;n.size>0&&(this.markerRenderer.enableBlend(),n.forEach(function(t){switch(t.getShapeType()){case Pt.MARKER:}}),e.getVisibleMarkers().forEach(function(e){return t.markerRenderer.render(e,t.mapState)}),e.getInfoWindowManager().update(),this.markerRenderer.disableBlend())}},e}(kt),Wt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Xt=function(t){function e(e,n){return t.call(this,e,n)||this}return Wt(e,t),e.prototype.render=function(){var t=this;if(this.layer.getLayerType()==ut.LINE){var e=this.layer;if(0!=e.renderTiles.size&&e.isVisible()){var n=Dt.Instance.getShader(bt.POLYLINE_SHADER),i=this.layer.tileManager.mapView.gl;i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),n.bind();var o=A.worldSize(this.mapState.getScale()),r=this.layer.getLayerId();e.renderTiles.forEach(function(i){var a=i.getTile();if(a.getKind()==Ot.ANNOTAION){var s=a;if(s.hasData(r)){var u=s.getLayerData(r,ut.LINE);if(u.getType()==ut.LINE){var l=u.getModel();n.setAttributes(l.attributeInfos);var h=s.getTileCoordinate(),c=1<<h.getZoom(),p=o/c,f=p/T.getTileSize(),d=w.pixelCoordinateToCameraCoordinate(new y(h.getX()*p+p/2,h.getY()*p+p/2),t.mapState),g=L.translate(d.x,d.y,0);g=L.scale(f,f,1).concat(g),n.setUniforms([new yt("u_lineWidth","1f",e.getStrokeWidth()),new yt("u_color","4fv",e.getStrokeColor().buffer()),new yt("u_mvpMatrix","matrix",g.concat(t.mapState.getViewProjectionMatrix()))]),l.render()}else console.warn("ERROR: layerData.getType() != LayerType.LINE .............")}}else console.warn("ERROR: tile.getKind() != Kind.ANNOTAION .............")})}}},e}(kt),Gt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Ht=function(t){function e(e,n){return t.call(this,e,n)||this}return Gt(e,t),e.prototype.render=function(){var t=this;if(this.layer.getLayerType()==ut.FILL){var e=this.layer;if(0!=e.renderTiles.size&&e.visible){var n=Dt.Instance.getShader(bt.FILL_SHADER),i=this.layer.tileManager.mapView.gl;i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),n.bind();var o=A.worldSize(this.mapState.getScale()),r=this.layer.getLayerId();e.renderTiles.forEach(function(i){var a=i.getTile();if(a.getKind()==Ot.ANNOTAION){var s=a;if(s.hasData(r)){var u=s.getLayerData(r,ut.FILL);if(u.getType()==ut.FILL){var l=u.getModel();n.setAttributes(l.attributeInfos);var h=s.getTileCoordinate(),c=1<<h.getZoom(),p=o/c,f=p/T.getTileSize(),d=w.pixelCoordinateToCameraCoordinate(new y(h.getX()*p+p/2,h.getY()*p+p/2),t.mapState),g=L.translate(d.x,d.y,0);g=L.scale(f,f,1).concat(g),n.setUniforms([new yt("u_color","4fv",e.fillColor.buffer()),new yt("u_mvpMatrix","matrix",g.concat(t.mapState.getViewProjectionMatrix()))]),l.render()}else console.warn("ERROR: layerData.getType() != LayerType.FILL .............")}}else console.warn("ERROR: tile.getKind() != Kind.Annotation.............")})}}else console.log("Invalid layer type")},e}(kt),Qt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Jt=function(t){function e(e,n){return t.call(this,e,n)||this}return Qt(e,t),e.prototype.render=function(){if(this.layer.getLayerType()==ut.CIRCLE){var t=this.layer;if(0!=t.renderTiles.size&&t.visible){var e=Dt.Instance.getShader(bt.CIRCLE_SHADER),n=this.layer.tileManager.mapView.gl;n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),e.bind();var i=Dt.Instance.getModel(_t.CIRCLE_MODEL),o=this.mapState.cameraPosition.getTarget(),r=A.getMetersPerPixelAtLatitude(o.lat(),this.mapState.getZoom()),a=t.radius/r,s=w.pixelCoordinateToCameraCoordinate(A.projectScale(t.center,this.mapState.scale),this.mapState),u=L.translate(s.x,s.y,0);e.setUniforms([new yt("u_color","4fv",t.fillColor.buffer()),new yt("u_radius","1f",a),new yt("u_mvpMatrix","matrix",u.concat(this.mapState.getViewProjectionMatrix()))]),e.setAttributes(i.attributeInfos),i.render()}}else console.log("Invalid layer type")},e}(kt),qt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Kt=function(t){function e(e,n,i){var o=t.call(this,n,i)||this;return o.gl=e,o}return qt(e,t),e.prototype.render=function(){if(this.mapState.is3dMode())if(this.layer.getLayerType()==ut.BUILDING){var t=this.layer;if(0!=t.colorBuildingGroups.size||0!=t.textureBuildingGroups.size||0!=t.extrudeBuildings.length){var e=Dt.Instance;this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.CULL_FACE);var n=e.getShader(bt.BUILDING_SHADER);n.bind();var i=t.lightManager.sunLight;n.setUniforms([new yt("u_light_position","3f",i.lightPosition),new yt("u_light_color","3f",i.lightColor)]);var o=e.getTexture(St.WHITE_TEXTURE);if(0!=t.textureBuildingGroups.size&&t.textureBuildingGroups.forEach(function(t){var e=t.getModel();0!=e.attributeInfos.length&&(n.setAttributes(e.attributeInfos),t.buildings.forEach(function(t){var i=t.getTexture();null==i&&(i=o),n.setUniforms([new yt("u_modelMatrix","matrix",t.getModelMatrix()),new yt("u_mvpMatrix","matrix",t.getMvpMatrix()),new yt("u_texture","texture",i)]),e.render(),n.resetTextureUnit()}))}),0!=t.colorBuildingGroups.size&&(n.setUniforms([new yt("u_texture","texture",o)]),t.colorBuildingGroups.forEach(function(t){var e=t.getModel();0!=e.attributeInfos.length&&(n.setAttributes(e.attributeInfos),t.buildings.forEach(function(t){n.setUniforms([new yt("u_modelMatrix","matrix",t.getModelMatrix()),new yt("u_mvpMatrix","matrix",t.getMvpMatrix())]),e.render(),n.resetTextureUnit()}))})),0!=t.extrudeBuildings.length){n.setUniforms([new yt("u_texture","texture",o)]);for(var r=0,a=t.extrudeBuildings;r<a.length;r++){var s=a[r],u=s.getModel();null!=u&&(n.setAttributes(u.attributeInfos),n.setUniforms([new yt("u_modelMatrix","matrix",s.getModelMatrix()),new yt("u_mvpMatrix","matrix",s.getMvpMatrix())]),u.render(),n.resetTextureUnit())}}this.gl.disable(this.gl.DEPTH_TEST),this.gl.disable(this.gl.CULL_FACE),n.disableAttributes()}}else console.warn("This layer is not building !")},e.prototype.renderSelection=function(){var t=this;if(this.mapState.is3dMode())if(this.layer.getLayerType()==ut.BUILDING){var e=this.layer;if(0!=e.colorBuildingGroups.size||0!=e.textureBuildingGroups.size||0!=e.extrudeBuildings.length){var n=Dt.Instance;this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.CULL_FACE),this.gl.disable(this.gl.BLEND);var i=n.getShader(bt.BUILDING_SELECTION_SHARDER);i.bind(),this.resetSelectionCode(),0!=e.textureBuildingGroups.size&&e.textureBuildingGroups.forEach(function(e){var n=e.getModel();0!=n.attributeInfos.length&&(i.setAttributes(n.attributeInfos),e.buildings.forEach(function(e){var o=t.getSelectionCode();e.setSelectionCode(o);var r=S.fromInt(o);i.setUniforms([new yt("u_color","3f",new x(r.red,r.green,r.blue)),new yt("u_mvpMatrix","matrix",e.getMvpMatrix())]),n.render(),i.resetTextureUnit()}))}),0!=e.colorBuildingGroups.size&&e.colorBuildingGroups.forEach(function(e){var n=e.getModel();0!=n.attributeInfos.length&&(i.setAttributes(n.attributeInfos),e.buildings.forEach(function(e){var o=t.getSelectionCode();e.setSelectionCode(o);var r=S.fromInt(o);i.setUniforms([new yt("u_color","3f",new x(r.red,r.green,r.blue)),new yt("u_mvpMatrix","matrix",e.getMvpMatrix())]),n.render(),i.resetTextureUnit()}))}),0!=e.extrudeBuildings.length&&e.extrudeBuildings.forEach(function(e){var n=e.getModel();i.setAttributes(n.attributeInfos);var o=t.getSelectionCode();e.setSelectionCode(o);var r=S.fromInt(o);i.setUniforms([new yt("u_color","3f",new x(r.red,r.green,r.blue)),new yt("u_mvpMatrix","matrix",e.getMvpMatrix())]),n.render(),i.resetTextureUnit()}),this.gl.disable(this.gl.DEPTH_TEST),this.gl.disable(this.gl.CULL_FACE),i.disableAttributes()}}else console.warn("This layer is not building !")},e}(kt),$t=function(){function t(){}return t.create=function(t,e,n){switch(n.getLayerType()){case ut.RASTER:return new Zt(e,n);case ut.BUILDING:return new Kt(t,e,n);case ut.ANNOTATION:return new Yt(e,n);case ut.LINE:return new Xt(e,n);case ut.FILL:return new Ht(e,n);case ut.CIRCLE:return new Jt(e,n);default:console.log("Invalid layer type")}},t}(),te=function(){function t(t,e){this.mapState=e,this.gl=t,this.layerRenderers=ht(pt)}return t.prototype.render=function(){this.layerRenderers.forEach(function(t,e){e.render()})},t.prototype.renderSelection=function(){this.layerRenderers.forEach(function(t,e){e.renderSelection()})},t.prototype.addLayer=function(t){this.layerRenderers=this.layerRenderers.insert(new ct(t.getLayerId(),t.getOrder()),$t.create(this.gl,this.mapState,t))},t.prototype.removeLayer=function(t,e){var n=new ct(t,e);this.layerRenderers=this.layerRenderers.remove(n)},t}(),ee=function(){function t(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by}return t.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},t.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},t.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},t.prototype.solveCurveX=function(t,e){var n,i,o,r,a,s;for(o=t,s=0;s<8;++s){if(r=this.sampleCurveX(o)-t,Math.abs(r)<e)return o;if(a=this.sampleCurveDerivativeX(o),Math.abs(a)<1e-6)break;o-=r/a}if(i=1,(o=t)<(n=0))return n;if(o>i)return i;for(;n<i;){if(r=this.sampleCurveX(o),Math.abs(r-t)<e)return o;t>r?n=o:i=o,o=.5*(i-n)+n}return o},t.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))},t}(),ne=function(){function t(t){this.dx=0,this.dy=0,this.timeConstant=t,this.initialSpeedRate=0,this.velocityRatioX=0,this.velocityRatioY=0}return t.prototype.getDisplacement=function(t,e,n){return t*e*-Math.expm1(-n/t)},t.prototype.getDuration=function(e,n){return-e*Math.log(t.minTrackSpeed/n)},t.prototype.startFling=function(e,n){(e=f.clamp(e,a.flingMinVelocity,a.flingMaxVelocity),n=f.clamp(n,a.flingMinVelocity,a.flingMaxVelocity),e*=t.secToMs,n*=t.secToMs,this.initialSpeedRate=Math.sqrt(e*e+n*n),this.initialSpeedRate<t.minTrackSpeed)?this.stopFling():(this.flingDuration=this.getDuration(this.timeConstant,this.initialSpeedRate),this.getDisplacement(this.timeConstant,this.initialSpeedRate,this.flingDuration)<t.minDisplacement?this.stopFling():(this.velocityRatioX=e/this.initialSpeedRate,this.velocityRatioY=n/this.initialSpeedRate,this.previousPositionX=0,this.previousPositionY=0,this.flingStart=Date.now()))},t.prototype.stopFling=function(){this.initialSpeedRate=0},t.prototype.isFlingInProgress=function(){return this.initialSpeedRate>0},t.prototype.trackMovement=function(){if(!this.isFlingInProgress())return!1;var t=Date.now()-this.flingStart;if(t>this.flingDuration)return this.stopFling(),!1;var e=this.getDisplacement(this.timeConstant,this.initialSpeedRate,t),n=e*this.velocityRatioX,i=e*this.velocityRatioY;return this.dx=n-this.previousPositionX,this.dy=i-this.previousPositionY,this.previousPositionX=n,this.previousPositionY=i,!0},t.secToMs=.001,t.minTrackSpeed=.01,t.minDisplacement=20,t}(),ie=function(){return function(){}}(),oe=function(){return function(){this.anchor=null,this.target=null,this.zoom=null,this.tilt=null,this.bearing=null}}();var re,ae=function(t,e,n,i){var o=new ee(t,e,n,i);return function(t){return o.solve(t,s.epsilon)}}(0,0,.25,1),se=function(){function t(t,e,n){this.onUpdateTransitions=null,this.mapState=t,this.cameraAnimationObserver=e,this.mapSettings=n,this.flingTracker=new ne(a.flingTimeConstant)}return t.prototype.moveBy=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var i=new oe,o=this.mapState.getTarget(),r=A.getMetersPerPixelAtLatitude(a.metersPerPixelAtLatitude,this.mapState.getZoom()),s=new y(t.y,t.x).multiply(r);s=s.rotateBy(-this.mapState.cameraPosition.getBearing()),i.target=A.convertToLatLngFromMeter(A.convertToMeterFromLatLng(o).add(s)),null==e?e=new ie:null==e.duration&&(e.duration=T.getTimePanTo(this.mapState.getTarget(),i.target,this.mapState.getZoom())),e.gesture=n,this.mapState.movingTo=!0,this.easeTo(i,e)},t.prototype.moveTo=function(t,e,n,i){void 0===n&&(n=null),void 0===i&&(i=!1),null==n&&(n=new ie),n.gesture=i;var o=new oe;o.target=t,e>=this.mapSettings.getPreferMinZoom()&&(e=f.clamp(e,this.mapSettings.getPreferMinZoom(),this.mapSettings.getMaxZoom()),o.zoom=e),this.mapState.movingTo=!0,this.easeTo(o,n)},t.prototype.zoom=function(t,e,n){this.mapState.startedZoom=!0,this.flingTracker.stopFling(),n.duration||(n.duration=a.defaultAnimationDuration);var i=new oe;i.zoom=t,i.anchor=e,this.easeTo(i,n)},t.prototype.isAnimated=function(){return this.mapState.panning||this.mapState.zoomIn||this.mapState.zoomOut||this.mapState.flyingTo},t.prototype.moveByVelocity=function(t){this.flingTracker.startFling(t.x,t.y)},t.prototype.setTilt=function(t,e){void 0===e&&(e=!1);var n=new oe,i=new ie;i.gesture=e,t=f.clamp(t,a.minTilt,a.maxTilt),n.tilt=t,this.mapState.tilting=!0,this.easeTo(n,i)},t.prototype.setBearing=function(t,e,n){void 0===n&&(n=!1);var i=new oe,o=new ie;o.gesture=n,i.bearing=t,e>0&&(o.duration=1e3*e),this.mapState.bearing=!0,this.easeTo(i,o)},t.prototype.easeTo=function(t,e){var n=this,i=this.mapState.getZoom(),o=null!=t.zoom?t.zoom:this.mapState.getZoom();o=Math.round(o);var r=this.mapState.getBearing(),u=this.mapState.getTilt(),l=this.mapState.getTarget(),h=t.bearing,c=t.tilt,f=null!=t.target?t.target:this.mapState.getTarget(),d=t.anchor,g=new p(0,0);d&&(g=w.screenCoordinateToLatLng(d,this.mapState)),this.mapState.zoomIn=o>i&&o-i>s.epsilon,this.mapState.zoomOut=i>o&&i-o>s.epsilon,this.mapState.panning=l!=f;this.startTransition(e,function(t){var e=i*(1-t)+o*t;if(null!=h){for(var s=r+(h-r)*t;s>=360;)s-=360;for(;s<0;)s+=360;n.mapState.setBearing(s)}if(null!=c){var m=u+(c-u)*t;n.mapState.setTilt(m)}var y=l.lat()*(1-t)+f.lat()*t,v=l.lng()*(1-t)+f.lng()*t,x=new p(y,v);if(n.mapState.setZoom(e),n.mapState.setTarget(x),Math.round(n.mapState.getZoom())<=a.defaultMinZoom3d&&(n.mapState.isZoomIn()||n.mapState.isZoomOut())&&n.mapState.handleSwitchMode(),d){var M=Math.pow(2,e),T=A.projectScale(n.mapState.getTarget(),M),b=A.projectScale(g,M),_=A.projectScale(w.screenCoordinateToLatLng(d,n.mapState),Math.pow(2,e));n.mapState.setTarget(A.unproject(T.add(b).subtract(_),M))}})},t.prototype.startTransition=function(t,e){var n=this,i=t.duration?t.duration:0,o=t.easing?t.easing:ae,r=0!=i;this.transitionStart=Date.now(),this.transitionDuration=i,this.mapState.isWillChange()||(this.mapState.willChange=!0,this.cameraAnimationObserver.notifyCameraWillChange(t.gesture)),this.mapState.startedAnimation=!0,this.onUpdateTransitions=function(t){var i=r?(t-n.transitionStart)/n.transitionDuration:1;return e(i>=1?1:o(i)),n.cameraAnimationObserver.notifyCameraIsChanging(),!(i<1)},r||(this.updateTransitions(),this.onUpdateTransitions=null)},t.prototype.stopAnimation=function(){this.mapState.isBearing()&&(this.mapState.bearing=!1,this.onUpdateTransitions=null)},t.prototype.updateTransitions=function(){if(null!=this.onUpdateTransitions){var t=Date.now(),e=this.onUpdateTransitions;this.onUpdateTransitions=null,e&&e(t)?(this.mapState.zoomIn=!1,this.mapState.zoomOut=!1,this.mapState.panning=!1,this.mapState.flyingTo=!1,this.mapState.movingTo=!1,this.mapState.bearing=!1,this.mapState.tilting=!1,e=null,this.mapState.startedAnimation=!1,this.mapState.timeMoving=Date.now(),this.onUpdateTransitions=null):null==this.onUpdateTransitions&&((this.mapState.isZoomIn()||this.mapState.isZoomOut())&&(this.mapState.timeMoving=Date.now()),this.onUpdateTransitions=e)}else if(this.flingTracker.isFlingInProgress())this.flingTracker.trackMovement()&&this.moveBy(new g(this.flingTracker.dx,this.flingTracker.dy),null,!0);else if(!this.mapState.startedAnimation&&this.mapState.willChange){var n=Date.now()-this.mapState.timeMoving;this.mapState.startedZoom?n>a.minTimeDoubleZoom&&(C.oldWheelMouseDy=0,this.mapState.willChange=!1,this.mapState.setZoom(Math.round(this.mapState.getZoom())),this.updateTransitions(),this.cameraAnimationObserver.notifyCameraDidChange()):n>a.minTimeMoving&&(this.mapState.willChange=!1,this.mapState.setZoom(Math.round(this.mapState.getZoom())),this.updateTransitions(),this.cameraAnimationObserver.notifyCameraDidChange(),C.oldWheelMouseDy=0)}},t.prototype.flyTo=function(t,e){var n=this;if(this.flingTracker.stopFling(),!this.isAnimated()){var i=this.mapState.getZoom(),o=t.target,r="zoom"in t?f.clamp(+t.zoom,this.mapSettings.getMinZoom(),this.mapSettings.getMaxZoom()):i,u=this.mapState.getTarget(),l=A.projectScale(u,this.mapState.getScale()),h=A.projectScale(o,this.mapState.getScale()),c=Math.max(this.mapState.getScreenSize().x,this.mapState.getScreenSize().y),p=c/Math.pow(2,r-i),d=Math.hypot(h.x-l.x,h.y-l.y),g=1.42;if("minZoom"in e){var m=f.clamp(Math.min(e.minZoom,i,r),this.mapSettings.getMinZoom(),this.mapSettings.getMaxZoom()),v=c/Math.pow(2,m-i);g=Math.sqrt(v/d*2)}var x=g*g,M=function(t){var e=(p*p-c*c+(t?-1:1)*x*x*d*d)/(2*(t?p:c)*x*d);return Math.log(Math.sqrt(e*e+1)-e)},w=M(0),T=function(t){return I(w)/I(w+g*t)},b=function(t){return c*(I(w)*function(t){return R(t)/I(t)}(w+g*t)-R(w))/x/d},_=(M(1)-w)/g;if(Math.abs(d)<s.epsilon||!isFinite(_)){if(Math.abs(c-p)<s.epsilon)return this.easeTo(t,e);var S=p<c?-1:1;_=Math.abs(Math.log(p/c))/g,b=function(){return 0},T=function(t){return Math.exp(S*g*t)}}if("duration"in e&&null!=e.duration)e.duration=+e.duration;else{var C="velocity"in e?+e.velocity/g:1.2;e.duration=1e3*_/C}e.duration>a.maxDurationFlyTo&&(e.duration=a.maxDurationFlyTo);var E=this.mapState.getScale();this.mapState.flyingTo=!0,this.startTransition(e,function(t){var e=t*_,o=1===t?1:b(e),u=new y(l.x*(1-o)+h.x*o,l.y*(1-o)+h.y*o),c=1/T(e),p=1===t?r:i+Math.log(c)/Math.LN2;p=f.clamp(p,n.mapSettings.getMinZoom(),n.mapSettings.getMaxZoom()),Math.abs(t-1)<s.epsilon&&(p=r),p!=p&&(p=r);var d=A.unproject(u,E);n.mapState.setZoom(p),n.mapState.setTarget(d),Math.round(n.mapState.getZoom())<=a.defaultMinZoom3d&&n.mapState.handleSwitchMode()})}function R(t){return(Math.exp(t)-Math.exp(-t))/2}function I(t){return(Math.exp(t)+Math.exp(-t))/2}},t}();!function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"}(re||(re={}));var ue=function(){function t(t,e,n){this.properties=new Map,this.type=t,this.geometries=e,this.properties=n}return t.prototype.getType=function(){return this.type},t.prototype.getGeometries=function(){return this.geometries},t}(),le=function(){function t(t){this.features=[],this.name=t}return t.prototype.featureCount=function(){return this.features.length},t.prototype.getFeature=function(t){return this.features[t]},t.prototype.getName=function(){return this.name},t}(),he=function(){return function(){}}(),ce=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),pe=function(t){function e(e,n,i,o){var r=t.call(this,n,i,o)||this;return r._id=e,r}return ce(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e}(ue),fe=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.addFeature=function(t,e,n,i){void 0===i&&(i=new Map),this.features.push(new pe(t,e,n,i))},e}(le),de=function(t){function e(){var e=t.call(this)||this;return e.layerIds=[],e.layers=new Map,e}return ce(e,t),e.prototype.addLayer=function(t){return this.layers.has(t)||(this.layerIds.push(t),this.layers.set(t,new fe(t))),this.layers.get(t)},e.prototype.getLayerIds=function(){return this.layerIds},e.prototype.getLayer=function(t){return this.layers.has(t)?this.layers.get(t):null},e}(he),ge=function(){function t(t,e){this._id=t,this._layerId=un.annotationLayerId+t.toString(),this._circleAnnotation=e,this.updateBounds()}return t.prototype.updateLayer=function(t){var e=t.getLayer(this._layerId);null==e&&(e=t.createLayer(this._layerId,ut.CIRCLE,a.circleAnnotationLayerOrder));var n=e;n.setCenter(this._circleAnnotation.getCenter()),n.setRadius(this._circleAnnotation.getRadius()),n.setFillColor(this._circleAnnotation.getFillColor()),n.setFillOpacity(this._circleAnnotation.getFillOpacity()),n.setVisible(this._circleAnnotation.isVisible())},t.prototype.updateBounds=function(){var t=this._circleAnnotation.getCenter(),e=this._circleAnnotation.getRadius(),n=A.convertToMeterFromLatLng(t),i=new y(n.x-e,n.y-e),o=new y(n.x+e,n.y+e),r=new M(A.convertToLatLngFromMeter(i),A.convertToLatLngFromMeter(o));this._minX=r.getSouthwest().lng(),this._minY=r.getSouthwest().lat(),this._maxX=r.getNortheast().lng(),this._maxY=r.getNortheast().lat()},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layerId",{get:function(){return this._layerId},enumerable:!0,configurable:!0}),t.prototype.getAnnotation=function(){return this._circleAnnotation},Object.defineProperty(t.prototype,"minX",{get:function(){return this._minX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minY",{get:function(){return this._minY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxX",{get:function(){return this._maxX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxY",{get:function(){return this._maxY},enumerable:!0,configurable:!0}),t}(),me=function(){function t(t,e){this._min=new d(t.x,t.y),this._max=new d(e.x,e.y)}return Object.defineProperty(t.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),t}(),ye=function(){function t(){this._id=null,this._map=null}return t.prototype.getId=function(){return this._id},t.prototype.getMap=function(){return this._map},t}(),ve=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),xe=function(t){function e(e){var n=t.call(this)||this;n.defaultCircleOptions={radius:0,fillColor:"#0000ff",fillOpacity:1,visible:!0};var i={};return T.extendOptions(i,n.defaultCircleOptions,e),n._center=p.convert(i.center),n._radius=i.radius,n._fillColor=i.fillColor,n._fillOpacity=i.fillOpacity,n._visible=i.visible,n}return ve(e,t),e.prototype.setMap=function(t){this._map!==t&&(null!=this._map&&(this._map.mapView.removeAnnotation(this._id),this._id=-1),this._map=t,null!=this._map&&(this._id=this._map.mapView.addAnnotation(this)))},e.prototype.setCenter=function(t){var e=p.convert(t);this._center.equals(e)||(this._center=e,null!=this._map&&this._map.mapView.updateAnnotation(this._id,!0))},e.prototype.setRadius=function(t){this._radius!=t&&(this._radius=t,null!=this._map&&this._map.mapView.updateAnnotation(this._id,!0))},e.prototype.setFillColor=function(t){this._fillColor!=t&&(this._fillColor=t,null!=this._map&&this._map.mapView.updateAnnotation(this._id))},e.prototype.setFillOpacity=function(t){this._fillOpacity!=t&&(this._fillOpacity=t,null!=this._map&&this._map.mapView.updateAnnotation(this._id))},e.prototype.setVisible=function(t){this._visible!==t&&(this._visible=t,null!=this._map&&this._map.mapView.updateAnnotation(this._id))},e.prototype.getCenter=function(){return new p(this._center.lat(),this._center.lng())},e.prototype.getRadius=function(){return this._radius},e.prototype.getFillColor=function(){return this._fillColor},e.prototype.getFillOpacity=function(){return this._fillOpacity},e.prototype.isVisible=function(){return this._visible},e}(ye),Ae=function(){function t(t,e,n){this.width=t,this.height=e,this.url=n}return t.prototype.clone=function(){return new t(this.width,this.height,this.url)},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.getUrl=function(){return null==this.url?null:this.url.replace("@1x","@"+T.resourceScale+"x")},t.defaultMarker=new t(32,32,null),t}(),Me=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),we=function(t){function e(e){var n=t.call(this)||this;n.defaultMarkerOptions={visible:!0,anchor:new g(.5,1),icon:new Ae(32,32,null),elevation:0,windowAnchor:new g(.5,0),title:"",snippet:""};var i={};return T.extendOptions(i,n.defaultMarkerOptions,e),n._position=p.convert(i.position),n._anchor=g.convert(i.anchor),n._visible=i.visible,n._icon=i.icon,n._elevation=i.elevation,n.title=i.title,n.snippet=i.snippet,n.windowAnchor=i.windowAnchor,n}return Me(e,t),e.prototype.getTitle=function(){return this.title},e.prototype.getSnippet=function(){return this.snippet},e.prototype.getWindowAnchor=function(){return this.windowAnchor},e.prototype.hideInfoWindow=function(){null!=this._map&&this._map.mapView.hideInfoWindow(this._id)},e.prototype.isInfoWindowShown=function(){if(null==this._map)return!1;this._map.mapView.isInfoWindowShown(this._id)},e.prototype.showInfoWindow=function(){null!=this._map&&this._map.mapView.showInfoWindow(this._id)},e.prototype.setMap=function(t){this._map!==t&&(null!=this._map&&(this._map.mapView.removeAnnotation(this._id),this._map.mapView.hideInfoWindow(this._id),this._id=-1),this._map=t,null!=this._map&&(this._id=this._map.mapView.addAnnotation(this)))},e.prototype.setPosition=function(t){var e=p.convert(t);this._position.equals(e)||(this._position=e,null!=this._map&&this._map.mapView.updateAnnotation(this._id,!0))},e.prototype.setTitle=function(t){this.title!==t&&(this.title=t,null!=this._map&&this._map.mapView.updateInfoContents(this._id))},e.prototype.setSnippet=function(t){this.snippet!==t&&(this.snippet=t,null!=this._map&&this._map.mapView.updateInfoContents(this._id))},e.prototype.setWindowAnchor=function(t){var e=g.convert(t);this.windowAnchor.equals(e)||(this.windowAnchor=e)},e.prototype.setVisible=function(t){this._visible!==t&&(this._visible=t,null!=this._map&&(this._map.mapView.dirty=!0,t||this._map.mapView.hideInfoWindow(this._id)))},e.prototype.setAnchor=function(t){var e=g.convert(t);this._anchor.equals(e)||(this._anchor=e,null!=this._map&&(this._map.mapView.dirty=!0))},e.prototype.setIcon=function(t){this._icon=t,null!=this._map&&this._map.mapView.updateAnnotation(this._id)},e.prototype.setElevation=function(t){this._elevation=t,null!=this._map&&(this._map.mapView.dirty=!0)},e.prototype.getPosition=function(){return new p(this._position.lat(),this._position.lng())},e.prototype.isVisible=function(){return this._visible},e.prototype.getAnchor=function(){return new g(this._anchor.x,this._anchor.y)},e.prototype.getIcon=function(){return this._icon instanceof Ae?new Ae(this._icon.width,this._icon.height,this._icon.url):this._icon},e.prototype.getElevation=function(){return this._elevation},e.prototype.getMap=function(){return this._map},e}(ye),Te=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),be=function(t){function e(e){var n=t.call(this)||this;n.defaultPolygonOptions={fillColor:"#0000ff",fillOpacity:1,visible:!0};var i={};return T.extendOptions(i,n.defaultPolygonOptions,e),n._paths=i.paths.map(function(t){return t.map(function(t){return p.convert(t)})}),n._fillColor=i.fillColor,n._fillOpacity=i.fillOpacity,n._visible=i.visible,n}return Te(e,t),e.prototype.setMap=function(t){this._map!==t&&(null!=this._map&&(this._map.mapView.removeAnnotation(this._id),this._id=-1),this._map=t,null!=this._map&&(this._id=this._map.mapView.addAnnotation(this)))},e.prototype.setPaths=function(t){this._paths=t.map(function(t){return t.map(function(t){return p.convert(t)})}),null!=this._map&&this._map.mapView.updateAnnotation(this._id,!0)},e.prototype.setFillColor=function(t){this._fillColor!=t&&(this._fillColor=t,null!=this._map&&this._map.mapView.updateAnnotation(this._id))},e.prototype.setFillOpacity=function(t){this._fillOpacity!=t&&(this._fillOpacity=t,null!=this._map&&this._map.mapView.updateAnnotation(this._id))},e.prototype.setVisible=function(t){this._visible!==t&&(this._visible=t,null!=this._map&&this._map.mapView.updateAnnotation(this._id))},e.prototype.getPaths=function(){return this._paths.slice(0)},e.prototype.getFillColor=function(){return this._fillColor},e.prototype.getFillOpacity=function(){return this._fillOpacity},e.prototype.isVisible=function(){return this._visible},e}(ye);function _e(t,e,n,i,o,r){var a=o-n,s=r-i;if(0!==a||0!==s){var u=((t-n)*a+(e-i)*s)/(a*a+s*s);u>1?(n=o,i=r):u>0&&(n+=a*u,i+=s*u)}return(a=t-n)*a+(s=e-i)*s}function Se(t,e,n,i){var o={id:void 0===t?null:t,type:e,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)Ce(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var i=0;i<e.length;i++)Ce(t,e[i]);else if("MultiPolygon"===n)for(i=0;i<e.length;i++)for(var o=0;o<e[i].length;o++)Ce(t,e[i][o])}(o),o}function Ce(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function Ee(t,e,n,i){if(e.geometry){var o=e.geometry.coordinates,r=e.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=e.id;if(n.promoteId?u=e.properties[n.promoteId]:n.generateId&&(u=i||0),"Point"===r)Re(o,s);else if("MultiPoint"===r)for(var l=0;l<o.length;l++)Re(o[l],s);else if("LineString"===r)Ie(o,s,a,!1);else if("MultiLineString"===r){if(n.lineMetrics){for(l=0;l<o.length;l++)s=[],Ie(o[l],s,a,!1),t.push(Se(u,"LineString",s,e.properties));return}Le(o,s,a,!1)}else if("Polygon"===r)Le(o,s,a,!0);else{if("MultiPolygon"!==r){if("GeometryCollection"===r){for(l=0;l<e.geometry.geometries.length;l++)Ee(t,{id:u,geometry:e.geometry.geometries[l],properties:e.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<o.length;l++){var h=[];Le(o[l],h,a,!0),s.push(h)}}t.push(Se(u,r,s,e.properties))}}function Re(t,e){e.push(Oe(t[0])),e.push(De(t[1])),e.push(0)}function Ie(t,e,n,i){for(var o,r,a=0,s=0;s<t.length;s++){var u=Oe(t[s][0]),l=De(t[s][1]);e.push(u),e.push(l),e.push(0),s>0&&(a+=i?(o*l-u*r)/2:Math.sqrt(Math.pow(u-o,2)+Math.pow(l-r,2))),o=u,r=l}var h=e.length-3;e[2]=1,function t(e,n,i,o){for(var r,a=o,s=i-n>>1,u=i-n,l=e[n],h=e[n+1],c=e[i],p=e[i+1],f=n+3;f<i;f+=3){var d=_e(e[f],e[f+1],l,h,c,p);if(d>a)r=f,a=d;else if(d===a){var g=Math.abs(f-s);g<u&&(r=f,u=g)}}a>o&&(r-n>3&&t(e,n,r,o),e[r+2]=a,i-r>3&&t(e,r,i,o))}(e,0,h,n),e[h+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function Le(t,e,n,i){for(var o=0;o<t.length;o++){var r=[];Ie(t[o],r,n,i),e.push(r)}}function Oe(t){return t/360+.5}function De(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function Pe(t,e,n,i,o,r,a,s){if(i/=e,r>=(n/=e)&&a<i)return t;if(a<n||r>=i)return null;for(var u=[],l=0;l<t.length;l++){var h=t[l],c=h.geometry,p=h.type,f=0===o?h.minX:h.minY,d=0===o?h.maxX:h.maxY;if(f>=n&&d<i)u.push(h);else if(!(d<n||f>=i)){var g=[];if("Point"===p||"MultiPoint"===p)Be(c,g,n,i,o);else if("LineString"===p)ke(c,g,n,i,o,!1,s.lineMetrics);else if("MultiLineString"===p)Ze(c,g,n,i,o,!1);else if("Polygon"===p)Ze(c,g,n,i,o,!0);else if("MultiPolygon"===p)for(var m=0;m<c.length;m++){var y=[];Ze(c[m],y,n,i,o,!0),y.length&&g.push(y)}if(g.length){if(s.lineMetrics&&"LineString"===p){for(m=0;m<g.length;m++)u.push(Se(h.id,p,g[m],h.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===g.length?(p="LineString",g=g[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===g.length?"Point":"MultiPoint"),u.push(Se(h.id,p,g,h.tags))}}}return u.length?u:null}function Be(t,e,n,i,o){for(var r=0;r<t.length;r+=3){var a=t[r+o];a>=n&&a<=i&&(e.push(t[r]),e.push(t[r+1]),e.push(t[r+2]))}}function ke(t,e,n,i,o,r,a){for(var s,u,l=Ne(t),h=0===o?Ue:je,c=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],g=t[p+2],m=t[p+3],y=t[p+4],v=0===o?f:d,x=0===o?m:y,A=!1;a&&(s=Math.sqrt(Math.pow(f-m,2)+Math.pow(d-y,2))),v<n?x>n&&(u=h(l,f,d,m,y,n),a&&(l.start=c+s*u)):v>i?x<i&&(u=h(l,f,d,m,y,i),a&&(l.start=c+s*u)):Fe(l,f,d,g),x<n&&v>=n&&(u=h(l,f,d,m,y,n),A=!0),x>i&&v<=i&&(u=h(l,f,d,m,y,i),A=!0),!r&&A&&(a&&(l.end=c+s*u),e.push(l),l=Ne(t)),a&&(c+=s)}var M=t.length-3;f=t[M],d=t[M+1],g=t[M+2],(v=0===o?f:d)>=n&&v<=i&&Fe(l,f,d,g),M=l.length-3,r&&M>=3&&(l[M]!==l[0]||l[M+1]!==l[1])&&Fe(l,l[0],l[1],l[2]),l.length&&e.push(l)}function Ne(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function Ze(t,e,n,i,o,r){for(var a=0;a<t.length;a++)ke(t[a],e,n,i,o,r,!1)}function Fe(t,e,n,i){t.push(e),t.push(n),t.push(i)}function Ue(t,e,n,i,o,r){var a=(r-e)/(i-e);return t.push(r),t.push(n+(o-n)*a),t.push(1),a}function je(t,e,n,i,o,r){var a=(r-n)/(o-n);return t.push(e+(i-e)*a),t.push(r),t.push(1),a}function ze(t,e){for(var n=[],i=0;i<t.length;i++){var o,r=t[i],a=r.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)o=Ve(r.geometry,e);else if("MultiLineString"===a||"Polygon"===a){o=[];for(var s=0;s<r.geometry.length;s++)o.push(Ve(r.geometry[s],e))}else if("MultiPolygon"===a)for(o=[],s=0;s<r.geometry.length;s++){for(var u=[],l=0;l<r.geometry[s].length;l++)u.push(Ve(r.geometry[s][l],e));o.push(u)}n.push(Se(r.id,a,o,r.tags))}return n}function Ve(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var i=0;i<t.length;i+=3)n.push(t[i]+e,t[i+1],t[i+2]);return n}function Ye(t,e){if(t.transformed)return t;var n,i,o,r=1<<t.z,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],l=u.geometry,h=u.type;if(u.geometry=[],1===h)for(i=0;i<l.length;i+=2)u.geometry.push(We(l[i],l[i+1],e,r,a,s));else for(i=0;i<l.length;i++){var c=[];for(o=0;o<l[i].length;o+=2)c.push(We(l[i][o],l[i][o+1],e,r,a,s));u.geometry.push(c)}}return t.transformed=!0,t}function We(t,e,n,i,o,r){return[Math.round(n*(t*i-o)),Math.round(n*(e*i-r))]}function Xe(t,e,n,i,o){for(var r=e===o.maxZoom?0:o.tolerance/((1<<e)*o.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,Ge(a,t[s],r,o);var u=t[s].minX,l=t[s].minY,h=t[s].maxX,c=t[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),h>a.maxX&&(a.maxX=h),c>a.maxY&&(a.maxY=c)}return a}function Ge(t,e,n,i){var o=e.geometry,r=e.type,a=[];if("Point"===r||"MultiPoint"===r)for(var s=0;s<o.length;s+=3)a.push(o[s]),a.push(o[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===r)He(a,o,t,n,!1,!1);else if("MultiLineString"===r||"Polygon"===r)for(s=0;s<o.length;s++)He(a,o[s],t,n,"Polygon"===r,0===s);else if("MultiPolygon"===r)for(var u=0;u<o.length;u++){var l=o[u];for(s=0;s<l.length;s++)He(a,l[s],t,n,!0,0===s)}if(a.length){var h=e.tags||null;if("LineString"===r&&i.lineMetrics){for(var c in h={},e.tags)h[c]=e.tags[c];h.mapbox_clip_start=o.start/o.size,h.mapbox_clip_end=o.end/o.size}var p={geometry:a,type:"Polygon"===r||"MultiPolygon"===r?3:"LineString"===r||"MultiLineString"===r?2:1,tags:h};null!==e.id&&(p.id=e.id),t.features.push(p)}}function He(t,e,n,i,o,r){var a=i*i;if(i>0&&e.size<(o?a:i))n.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===i||e[u+2]>a)&&(n.numSimplified++,s.push(e[u]),s.push(e[u+1])),n.numPoints++;o&&function(t,e){for(var n=0,i=0,o=t.length,r=o-2;i<o;r=i,i+=2)n+=(t[i]-t[r])*(t[i+1]+t[r+1]);if(n>0===e)for(i=0,o=t.length;i<o/2;i+=2){var a=t[i],s=t[i+1];t[i]=t[o-2-i],t[i+1]=t[o-1-i],t[o-2-i]=a,t[o-1-i]=s}}(s,r),t.push(s)}}function Qe(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)Ee(n,t.features[i],e,i);else"Feature"===t.type?Ee(n,t,e):Ee(n,{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(t,e){var n=e.buffer/e.extent,i=t,o=Pe(t,1,-1-n,n,0,-1,2,e),r=Pe(t,1,1-n,2+n,0,-1,2,e);return(o||r)&&(i=Pe(t,1,-n,1+n,0,-1,2,e)||[],o&&(i=ze(o,1).concat(i)),r&&(i=i.concat(ze(r,-1)))),i}(i,e)).length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Je(t,e,n){return 32*((1<<t)*n+e)+t}Qe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Qe.prototype.splitTile=function(t,e,n,i,o,r,a){for(var s=[t,e,n,i],u=this.options,l=u.debug;s.length;){i=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var h=1<<e,c=Je(e,n,i),p=this.tiles[c];if(!p&&(l>1&&console.time("creation"),p=this.tiles[c]=Xe(t,e,n,i,u),this.tileCoords.push({z:e,x:n,y:i}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,o){if(e===u.maxZoom||e===o)continue;var d=1<<o-e;if(n!==Math.floor(r/d)||i!==Math.floor(a/d))continue}else if(e===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==t.length){l>1&&console.time("clipping");var g,m,y,v,x,A,M=.5*u.buffer/u.extent,w=.5-M,T=.5+M,b=1+M;g=m=y=v=null,x=Pe(t,h,n-M,n+T,0,p.minX,p.maxX,u),A=Pe(t,h,n+w,n+b,0,p.minX,p.maxX,u),t=null,x&&(g=Pe(x,h,i-M,i+T,1,p.minY,p.maxY,u),m=Pe(x,h,i+w,i+b,1,p.minY,p.maxY,u),x=null),A&&(y=Pe(A,h,i-M,i+T,1,p.minY,p.maxY,u),v=Pe(A,h,i+w,i+b,1,p.minY,p.maxY,u),A=null),l>1&&console.timeEnd("clipping"),s.push(g||[],e+1,2*n,2*i),s.push(m||[],e+1,2*n,2*i+1),s.push(y||[],e+1,2*n+1,2*i),s.push(v||[],e+1,2*n+1,2*i+1)}}},Qe.prototype.getTile=function(t,e,n){var i=this.options,o=i.extent,r=i.debug;if(t<0||t>24)return null;var a=1<<t,s=Je(t,e=(e%a+a)%a,n);if(this.tiles[s])return Ye(this.tiles[s],o);r>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var u,l=t,h=e,c=n;!u&&l>0;)l--,h=Math.floor(h/2),c=Math.floor(c/2),u=this.tiles[Je(l,h,c)];return u&&u.source?(r>1&&console.log("found parent tile z%d-%d-%d",l,h,c),r>1&&console.time("drilling down"),this.splitTile(u.source,l,h,c,t,e,n),r>1&&console.timeEnd("drilling down"),this.tiles[s]?Ye(this.tiles[s],o):null):null};var qe,Ke=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),$e=function(t){function e(e){var n=t.call(this,e)||this;return n.normalizeGeometryCoordinates(),n}return Ke(e,t),e.prototype.normalizeGeometryCoordinates=function(){for(var t=[],e=0;e<this.geometryCoordinates.length;++e){for(var n=[],i=0;i<this.geometryCoordinates[e].length;++i)n.push([this.geometryCoordinates[e][i][0]/a.tileExtend-.5,.5-this.geometryCoordinates[e][i][1]/a.tileExtend]);t.push(n)}this.geometryCoordinates=t},e}(function(){return function(t){this.geometryCoordinates=[],this.geometryCoordinates=t}}()),tn=function(){function t(t){this.id=t,this.layerId=un.annotationLayerId+t.toString()}return t.prototype.reloadLayout=function(){this.geoJsonIndexer=null},t.prototype.updateTileData=function(t,e){var n=this;if(!this.geoJsonIndexer){var i={maxZoom:a.defaultMaxNativeZoom,buffer:0,extent:a.tileExtend,tolerance:4};this.geoJsonIndexer=function(t,e){return new Qe(t,e)}(this.getFeatures(),i)}var o=this.geoJsonIndexer.getTile(t.getZoom(),t.getX(),t.getY());if(null!=o&&0!==o.features.length){var r=e.addLayer(this.layerId);o.features.forEach(function(t){var e=t.type,i=new $e(t.geometry);r.addFeature(n.id,e,i)})}},t.prototype.getLayerId=function(){return this.layerId},t}(),en=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),nn=function(t){function e(e,n){var i=t.call(this,e)||this;return i.polygonAnnotation=n,i}return en(e,t),e.prototype.getAnnotation=function(){return this.polygonAnnotation},e.prototype.updateLayer=function(t){var e=this.getLayerId(),n=t.getLayer(e);null==n&&(n=t.createLayer(e,ut.FILL,a.polygonAnnotationLayerOrder));var i=n;i.setFillColor(this.polygonAnnotation.getFillColor()),i.setFillOpacity(this.polygonAnnotation.getFillOpacity()),i.setVisible(this.polygonAnnotation.isVisible())},e.prototype.getFeatures=function(){var t,e=[];this.polygonAnnotation.getPaths().forEach(function(t){var n=[];t.forEach(function(t){return n.push([t.lng(),t.lat()])}),e.push(n)});var n={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:e}}]};return t=JSON.stringify(n,null,2),JSON.parse(t)},e}(tn),on=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),rn=function(t){function e(e){var n=t.call(this)||this;n.defaultPolylineOptions={strokeWidth:0,strokeColor:"#0000ff",strokeOpacity:1,visible:!0,closed:!1};var i={};return T.extendOptions(i,n.defaultPolylineOptions,e),n._path=i.path.map(function(t){return p.convert(t)}),n._strokeWidth=i.strokeWidth,n._strokeColor=i.strokeColor,n._strokeOpacity=i.strokeOpacity,n._visible=i.visible,n.setClosed(i.closed),n}return on(e,t),e.prototype.setClosed=function(t){if(this._closed!=t){if(this._closed=t,this._closed){if(null!=this._path)if(1==this._path.length){var e=this._path[0];this._path.push(e)}else if(this._path.length>1){e=this._path[0];var n=this._path[this._path.length-1];e.equals(n)||this._path.push(e)}}else if(null!=this._path&&this._path.length>1){e=this._path[0],n=this._path[this._path.length-1];e.equals(n)&&this._path.splice(this._path.length-1,1)}null!=this._map&&this._map.mapView.updateAnnotation(this._id,!0)}},e.prototype.setMap=function(t){this._map!==t&&(null!=this._map&&(this._map.mapView.removeAnnotation(this._id),this._id=-1),this._map=t,null!=this._map&&(this._id=this._map.mapView.addAnnotation(this)))},e.prototype.setPath=function(t){this._path=t.map(function(t){return p.convert(t)}),null!=this._map&&this._map.mapView.updateAnnotation(this._id,!0)},e.prototype.setStrokeWidth=function(t){this._strokeWidth!=t&&(this._strokeWidth=t,null!=this._map&&this._map.mapView.updateAnnotation(this._id))},e.prototype.setStrokeColor=function(t){this._strokeColor!=t&&(this._strokeColor=t,null!=this._map&&this._map.mapView.updateAnnotation(this._id))},e.prototype.setStrokeOpacity=function(t){this._strokeOpacity!=t&&(this._strokeOpacity=t,null!=this._map&&this._map.mapView.updateAnnotation(this._id))},e.prototype.setVisible=function(t){this._visible!=t&&(this._visible=t,null!=this._map&&this._map.mapView.updateAnnotation(this._id))},e.prototype.getPath=function(){return this._path.slice(0)},e.prototype.getStrokeWidth=function(){return this._strokeWidth},e.prototype.getStrokeColor=function(){return this._strokeColor},e.prototype.getStrokeOpacity=function(){return this._strokeOpacity},e.prototype.isVisible=function(){return this._visible},e.prototype.isClosed=function(){return this._closed},e}(ye),an=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),sn=function(t){function e(e,n){var i=t.call(this,e)||this;return i.polylineAnnotation=n,i}return an(e,t),e.prototype.getAnnotation=function(){return this.polylineAnnotation},e.prototype.updateLayer=function(t){var e=this.getLayerId(),n=t.getLayer(e);null==n&&(n=t.createLayer(e,ut.LINE,a.polylineAnnotationLayerOrder));var i=n;i.setStrokeColor(this.polylineAnnotation.getStrokeColor()),i.setStrokeOpacity(this.polylineAnnotation.getStrokeOpacity()),i.setStrokeWidth(this.polylineAnnotation.getStrokeWidth()),i.setVisible(this.polylineAnnotation.isVisible())},e.prototype.getFeatures=function(){var t,e=[];this.polylineAnnotation.getPath().forEach(function(t){e.push([t.lng(),t.lat()])});var n={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:e}}]};return t=JSON.stringify(n,null,2),JSON.parse(t)},e}(tn),un=function(){function t(t,e){this.idCounter=0,this.markerAnnotations=[],this.tiles=new Map,this.shapeAnnotations=new Map,this.map=t,this.dirty=!1;var n=t.createLayer("annotationLayer",ut.ANNOTATION,a.markerAnnotationLayerOrder);this.annotationLayer=n,this.circleTree=tt(),this.circleAnnotations=new Map,this.annotationLayer.setMap(t),this.requestRender=e}return t.prototype.update=function(){var t=this;this.dirty&&(this.tiles.forEach(function(e){var n=t.getTileData(e.getTileCoordinate());t.updateRenderTile(n,e),e.setData(n)}),this.dirty=!1)},t.prototype.addTile=function(t){var e=t.getTileCoordinate(),n=this.getTileData(e);this.updateRenderTile(n,t),t.setData(n),this.tiles.set(e.toString(),t)},t.prototype.removeTile=function(t){var e=this,n=t.getTileData();if(null!=n){var i=n.getLayerIds(),o=t.getTileCoordinate().toString();i.forEach(function(t){var n=e.map.getLayer(t),i=n.getLayerType();if(i==ut.LINE)n.removeRenderTile(o);else if(i==ut.FILL){n.removeRenderTile(o)}else if(i==ut.CIRCLE){n.removeRenderTile(o)}})}this.tiles.delete(t.getTileCoordinate().toString())},t.prototype.getTileData=function(t){if(0==this.markerAnnotations.length&&0==this.shapeAnnotations.size&&0==this.circleAnnotations.size)return null;var e=new de;this.shapeAnnotations.forEach(function(n){n.updateTileData(t,e)});var n=w.tileCoordinateToLatLngBounds(t),i={minX:n.getSouthwest().lng(),minY:n.getSouthwest().lat(),maxX:n.getNortheast().lng(),maxY:n.getNortheast().lat()};return this.circleTree.search(i).forEach(function(t){return e.addLayer(t.layerId)}),e},t.prototype.addAnnotation=function(t){this.dirty=!0;var e=this.idCounter++;return this.idCounter<0&&(this.idCounter=0),this.addAnnotationInternal(e,t),e},t.prototype.addAnnotationInternal=function(t,e){if(e instanceof we)this.markerAnnotations.push(t),this.annotationLayer.addAnnotation(t,e,this.requestRender);else if(e instanceof rn){var n=new sn(t,e);n.updateLayer(this.map),this.shapeAnnotations.set(t,n)}else if(e instanceof be){var i=new nn(t,e);i.updateLayer(this.map),this.shapeAnnotations.set(t,i)}else if(e instanceof xe){var o=new ge(t,e);o.updateLayer(this.map),this.circleAnnotations.set(t,o),this.circleTree.insert(o)}},t.prototype.hideInfoWindow=function(t){this.annotationLayer.hideInfoWindow(t)},t.prototype.isInfoWindowShown=function(t){return this.annotationLayer.isInfoWindowShown(t)},t.prototype.showInfoWindow=function(t){this.annotationLayer.showInfoWindow(t)},t.prototype.deselectedMarker=function(){this.annotationLayer.deselectedMarker()},t.prototype.selectedMarker=function(t){this.annotationLayer.selectedMarker(t)},t.prototype.setInfoWindow=function(t){this.annotationLayer.setInfoWindow(t)},t.prototype.setInfoContents=function(t){this.annotationLayer.setInfoContents(t)},t.prototype.updateInfoContents=function(t){this.annotationLayer.updateInfoContents(t)},t.prototype.updateAnnotation=function(e,n){if(-1!=this.markerAnnotations.indexOf(e))this.annotationLayer.updateAnnotation(e,n);else if(this.shapeAnnotations.has(e)){var i=this.shapeAnnotations.get(e);if(n){var o=t.annotationLayerId+e.toString();i.reloadLayout(),this.tiles.forEach(function(t){return t.removeLayerData(o)}),this.dirty=!0}i.updateLayer(this.map)}else if(this.circleAnnotations.has(e)){var r=this.circleAnnotations.get(e);r.updateLayer(this.map),n&&(r.updateBounds(),this.circleTree.remove(r),this.circleTree.insert(r),this.dirty=!0)}},t.prototype.removeAnnotation=function(e){this.dirty=!0;var n=this.markerAnnotations.indexOf(e);if(-1!=n)this.markerAnnotations.splice(n,1),this.annotationLayer.removeAnnotation(e);else if(this.shapeAnnotations.has(e)){var i=-1,o=this.shapeAnnotations.get(e);o instanceof nn?i=a.polygonAnnotationLayerOrder:o instanceof sn&&(i=a.polylineAnnotationLayerOrder),this.shapeAnnotations.delete(e),this.map.removeLayer(t.annotationLayerId+e.toString(),i)}else this.circleAnnotations.has(e)?(this.circleTree.remove(this.circleAnnotations.get(e)),this.circleAnnotations.delete(e),this.map.removeLayer(t.annotationLayerId+e.toString(),a.circleAnnotationLayerOrder)):console.error("Invalid annotation's id: "+e)},t.prototype.updateRenderTile=function(t,e){var n=this;if(null!=t){var i=e.getTileCoordinate(),o=i.toString();t.getLayerIds().forEach(function(t){var r=n.map.getLayer(t),a=r.getLayerType(),s=new B(N.createWithXYZoom(i.getX(),i.getY(),i.getZoom()),e);if(a==ut.LINE)r.addRenderTile(o,s);else if(a==ut.FILL){r.addRenderTile(o,s)}else if(a==ut.CIRCLE){r.addRenderTile(o,s)}})}},t.prototype.queryMarkerAnnotation=function(t){var e=this.annotationLayer.getVisibleMarkers();e=e.reverse();for(var n=0;n<e.length;++n){var i=e[n],o=i.getWidth()*T.pixelScale,r=i.getHeight()*T.pixelScale,a=i.getAnchor(),s=w.latLngToScreenCoordinate(i.getPosition(),i.getElevation(),this.map.mapState),u=new y(s.x+(.5-a.x)*o,s.y+(.5-a.y)*r),l=new me(new g(u.x-o/2,u.y-r/2),new g(u.x+o/2,u.y+r/2));if(m.pointIntersectsBox(new g(t.x,t.y),l))return i.getMarker()}return null},t.prototype.queryShapeAnnotation=function(t){var e=this.map.mapState,n=k.fromLatLng(w.screenCoordinateToLatLng(t,e),e.getZoom(),e.is3dMode()),i=1,o=e.getMaxNativeZoom();if(e.getZoom()>o&&(n=k.fromLatLng(w.screenCoordinateToLatLng(t,e),e.getMaxNativeZoom(),e.is3dMode()),i=Math.pow(2,Math.round(e.getZoom())-o)),this.tiles.has(n.toString())){var r=this.tiles.get(n.toString()).getTileData();if(null==r||0==r.getLayerIds().length)return null;for(var a=e.scale,s=n.getX(),u=n.getY(),l=w.pixelCoordinateToVectorTileCoordinate(A.projectScale(w.screenCoordinateToLatLng(t,e),a),s,u,i),h=this.queryShapeAnnotationInternal(new g(l.x,l.y),r),c=h.clickedAnnotation,p=h.clickedAnnotationId,f=w.tileCoordinateToLatLngBounds(n),d={minX:f.getSouthwest().lng(),minY:f.getSouthwest().lat(),maxX:f.getNortheast().lng(),maxY:f.getNortheast().lat()},y=this.circleTree.search(d),v=0;v<y.length;++v){var x=y[v],M=x.getAnnotation(),T=M.getCenter(),b=M.getRadius(),_=e.getScale(),S=b/A.getMetersPerPixelAtLatitude(e.getCamera().getTarget().lat(),e.getZoom()),C=A.projectScale(T,_),E=w.screenCoordinateToLatLng(t,e),R=A.projectScale(E,_);m.pointIntersectsCircle(new g(R.x,R.y),new g(C.x,C.y),S)&&(null==c||null!=c&&p<x.id)&&(c=this.circleAnnotations.get(x.id).getAnnotation(),p=x.id)}return c}return null},t.prototype.queryShapeAnnotationInternal=function(t,e){for(var n=T.getTileSize(),i=e.getLayerIds(),o=e.getLayerIds().length,r=null,a=null,s=0;s<o;++s)for(var u=i[s],l=e.getLayer(u),h=function(e){var i=l.getFeature(e);if(!(i instanceof pe))return"continue";var o=i,s=o.getGeometries().geometryCoordinates,h=c.map.getLayer(u);if(null==h)return console.error("There is problem while querying shape annotation"),{value:null};var p=h.getLayerType();if(p==ut.LINE){var f=h.getStrokeWidth()/2,d=c.map.mapState;d.getZoom()>d.getMaxNativeZoom()&&(f/=Math.pow(2,Math.round(d.getZoom())-d.getMaxNativeZoom()));var y=[];s.forEach(function(t){var e=[];t.forEach(function(t){return e.push(new g(t[0],t[1]))}),y.push(e)}),m.pointIntersectsBufferedMultiLine(t,y,f/n)&&(null==r||null!=r&&a<o.id)&&(r=c.shapeAnnotations.get(o.id).getAnnotation(),a=o.id)}else if(p==ut.FILL){for(var v=!1,x=function(e){var n=[];if(s[e].forEach(function(t){return n.push(new g(t[0],t[1]))}),0==e){if(!(v=m.polygonIntersectsPolygon([t],n)))return"break"}else if(m.polygonIntersectsPolygon([t],n))return v=!1,"break"},A=0;A<s.length;++A){if("break"===x(A))break}v&&(null==r||null!=r&&a<o.id)&&(r=c.shapeAnnotations.get(o.id).getAnnotation(),a=o.id)}},c=this,p=0;p<l.featureCount();++p){var f=h(p);if("object"==typeof f)return f.value}return{clickedAnnotation:r,clickedAnnotationId:a}},t.annotationLayerId="maplink.annotation.layer.",t}(),ln=function(){function t(t){this.idCounter=0,this.tileManager=t,this.tileAreas=new Map}return t.prototype.addTileArea=function(t){var e=this.idCounter++;return this.tileAreas.set(e,t),this.tileManager.addTileArea(e,t),e},t.prototype.updateTileArea=function(t,e){this.tileAreas.has(t)&&(this.tileAreas.delete(t),this.tileAreas.set(t,e),this.tileManager.updateTileArea(t,e))},t.prototype.removeTileArea=function(t){this.tileAreas.delete(t),this.tileManager.removeTileArea(t)},t}(),hn=function(){function t(t){this.layerType=t}return t.prototype.getType=function(){return this.layerType},t}(),cn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),pn=function(t){function e(e){var n=t.call(this,ut.RASTER)||this;return n.texture=e,n}return cn(e,t),e.prototype.destroy=function(){this.texture&&this.texture.destroy()},e}(hn),fn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),dn=function(t){function e(e,n){var i=t.call(this,Ot.RASTER,e,n)||this;return i.buildings=[],i}return fn(e,t),e.prototype.init=function(t,e){var n=this,i=new Lt(this.gl);i.loadImage(t.rasterTile,function(){n.renderable=!0,e()}),this.rasterLayerData=new pn(i)},e.prototype.getTexture=function(){return this.rasterLayerData?this.rasterLayerData.texture:null},e.prototype.addBuildings=function(t){this.buildings=t},e.prototype.getBuildings=function(){return this.buildings},e.prototype.destroy=function(){this.rasterLayerData&&this.rasterLayerData.destroy()},e}(Bt),gn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),mn=function(t){function e(e,n,i){return t.call(this,e,n,ut.RASTER,i)||this}return gn(e,t),e.prototype.update=function(){var t=this;this.tileManager.update(function(e){return new dn(e,t.tileManager.mapView.gl)})},e}(gt),yn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),vn=function(t){function e(e,n,i,o){void 0===n&&(n=null),void 0===i&&(i=null);var r=t.call(this,Pt.MARKER)||this;return r.marker=e,r.gl=n,r.requestRender=o,r.updateBounds(),r.updateIcon(),r}return yn(e,t),e.prototype.initTexture=function(t,e){var n=this;void 0===e&&(e=null),null!=this.texture&&this.texture.destroy(),this.texture=new Lt(this.gl),null==t&&(t=b.get("markerDefault")),this.texture.loadImageFromUrl(t,function(){e&&e(),n.requestRender()})},e.prototype.updateIcon=function(){var t=this.marker.getIcon();if(t instanceof Ae)this.url=t.getUrl(),this.width=t.getWidth(),this.height=t.getHeight();else{var e=Ae.defaultMarker;e.url=t,this.url=e.getUrl(),this.width=e.getWidth(),this.height=e.getHeight()}this.initTexture(this.url,null)},e.prototype.updateBounds=function(){var t=this.marker.getPosition();this.minX=t.lng(),this.minY=t.lat(),this.maxX=t.lng(),this.maxY=t.lat()},e.prototype.destroy=function(){this.texture&&this.texture.destroy()},e.prototype.getMarker=function(){return this.marker},e.prototype.hasTexture=function(){return null!=this.texture},e.prototype.getTexture=function(){return this.texture},e.prototype.isVisible=function(){return this.marker.isVisible()},e.prototype.getPosition=function(){return this.marker.getPosition()},e.prototype.getAnchor=function(){return this.marker.getAnchor()},e.prototype.getElevation=function(){return this.marker.getElevation()},e.prototype.getWidth=function(){return this.width},e.prototype.getHeight=function(){return this.height},e}(Ut),xn=function(){function t(t,e){this.content=t,this.windowAnchor=e}return t.prototype.getContent=function(){return this.content},t.prototype.getPositionByMarker=function(t,e){if(null==this.content)return null;if(t.getShapeType()==Pt.MARKER){var n=t,i=n.getMarker(),o=w.latLngToScreenCoordinate(i.getPosition(),i.getElevation(),e);return o.x/=T.pixelScale,o.y/=T.pixelScale,o.x-=this.content.offsetWidth/2,o.y-=this.content.offsetHeight,o.x+=(.5-i.getAnchor().x)*n.getWidth()*T.pixelScale-(.5-this.windowAnchor.x)*n.getWidth(),o.y+=(.5-i.getAnchor().y)*n.getHeight()-(.5-this.windowAnchor.y)*n.getHeight(),new g(o.x,o.y)}return null},t.prototype.setContent=function(t){this.content=t},t}(),An=function(){function t(t){this.infoWindows=new Map,this.markerAnnotations=t}return t.prototype.createInfoWindowContainer=function(){this.infoWindowContainer||(this.infoWindowContainer=E.create("div","mf-info-window-container",this.map.getMapContainer()))},t.prototype.createInfoContentsContainer=function(){this.infoContentsContainer||(this.createInfoWindowContainer(),this.infoContentsContainer=E.create("div","mf-info-window-content",this.infoWindowContainer))},t.prototype.createInfoWindow=function(t){var e=this.getInfoWindow(t);return null!=e?(null==this.infoContentsContainer&&(this.infoContentsContainer=E.create("div",null,this.infoWindowContainer)),this.setContentsHTMLElement(e),this.infoContentsContainer):null},t.prototype.createInfoContents=function(t){var e=this.getInfoContents(t);return null!=e?(this.createInfoContentsContainer(),this.setContentsHTMLElement(e),this.infoContentsContainer):null},t.prototype.createDefaultInfoContents=function(t){if(!(""!==t.getTitle()&&null!=t.getTitle()||""!==t.getSnippet()&&null!=t.getSnippet()))return null;this.createInfoContentsContainer();var e=this.getDefaultContents(t);return this.setContentsHTMLElement(e),this.infoContentsContainer},t.prototype.deselectedMarker=function(){null!=this.selectedMakerId&&(this.hideInfoWindow(this.selectedMakerId),this.removeContent())},t.prototype.getDefaultContents=function(t){return"<h4>"+t.getTitle()+"</h4><p>"+t.getSnippet()+"</p>"},t.prototype.getInfoContents=function(t){return null!=this.infoContentsCallback?this.infoContentsCallback(t):null},t.prototype.getInfoWindow=function(t){return null!=this.infoWindowCallback?this.infoWindowCallback(t):null},t.prototype.getInfoWindowHTMLElement=function(t){var e=this.createInfoWindow(t);if(null!=e)return e;var n=this.createInfoContents(t);return null!=n?n:this.createDefaultInfoContents(t)},t.prototype.getSelectedMarkerId=function(){return this.selectedMakerId},t.prototype.isInfoWindowShown=function(t){return null!=this.selectedMakerId&&this.selectedMakerId==t},t.prototype.removeContent=function(){this.infoContentsContainer&&(E.remove(this.infoContentsContainer),this.infoContentsContainer=null)},t.prototype.selectedMarker=function(t){this.isInfoWindowShown(t)||(this.deselectedMarker(),this.showInfoWindow(t))},t.prototype.update=function(){if(null!=this.selectedMakerId){var t=this.markerAnnotations.get(this.selectedMakerId);if(null!=t){var e=this.infoWindows.get(this.selectedMakerId).getPositionByMarker(t,this.map.mapState);if(null==e)return;var n=e.x,i=e.y;this.infoWindowContainer.style.top=i.toString()+"px",this.infoWindowContainer.style.left=n.toString()+"px"}}},t.prototype.hideInfoWindow=function(t){this.isInfoWindowShown(t)&&(this.infoWindows.delete(t),this.selectedMakerId=null)},t.prototype.showInfoWindow=function(t){if(!this.isInfoWindowShown(t)){var e=this.markerAnnotations.get(t);if(null!=e&&e.getShapeType()==Pt.MARKER){var n=e.getMarker(),i=this.getInfoWindowHTMLElement(n),o=new xn(i,n.getWindowAnchor());this.infoWindows.clear(),this.infoWindows.set(t,o),this.selectedMakerId=t,this.update()}}},t.prototype.setContentsHTMLElement=function(t){this.infoContentsContainer&&(this.infoContentsContainer.innerHTML=t.toString())},t.prototype.setInfoWindow=function(t){this.infoWindowCallback=t},t.prototype.setInfoContents=function(t){this.infoContentsCallback=t},t.prototype.setMap=function(t){this.map!==t&&(this.map=t,this.createInfoWindowContainer())},t.prototype.updateInfoContents=function(t){var e=this.markerAnnotations.get(t);if(e.getShapeType()==Pt.MARKER){var n=e.getMarker(),i=this.getInfoWindowHTMLElement(n),o=this.infoWindows.get(t);null!=o&&(o.setContent(i),this.setContentsHTMLElement(i))}},t}(),Mn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),wn=function(t){function e(e,n,i){var o=t.call(this,e,n,ut.ANNOTATION,i)||this;return o.markerAnnotations=new Map,o.rBushTree=tt(),o.infoWindowManager=new An(o.markerAnnotations),o}return Mn(e,t),e.prototype.update=function(t){this.markerAnnotations.forEach(function(e){e.update(t)})},e.prototype.addAnnotation=function(t,e,n){if(e instanceof we){var i=new vn(e,this.tileManager.mapView.gl,null,n);this.markerAnnotations.set(t,i),this.rBushTree.insert(i)}else console.error("Invalid annotation type: "+e)},e.prototype.deselectedMarker=function(){this.infoWindowManager.deselectedMarker()},e.prototype.selectedMarker=function(t){this.infoWindowManager.selectedMarker(t)},e.prototype.hideInfoWindow=function(t){this.infoWindowManager.hideInfoWindow(t)},e.prototype.isInfoWindowShown=function(t){return this.infoWindowManager.isInfoWindowShown(t)},e.prototype.showInfoWindow=function(t){this.infoWindowManager.showInfoWindow(t)},e.prototype.setInfoWindow=function(t){this.infoWindowManager.setInfoWindow(t)},e.prototype.setInfoContents=function(t){this.infoWindowManager.setInfoContents(t)},e.prototype.updateInfoContents=function(t){this.infoWindowManager.updateInfoContents(t)},e.prototype.setMap=function(t){this.infoWindowManager.setMap(t)},e.prototype.updateAnnotation=function(t,e){if(this.markerAnnotations.has(t)){var n=this.markerAnnotations.get(t);if(n.getShapeType()==Pt.MARKER){var i=n;e?(i.updateBounds(),this.rBushTree.remove(i),this.rBushTree.insert(i)):i.updateIcon()}}},e.prototype.removeAnnotation=function(t,e){if(void 0===e&&(e=null),this.markerAnnotations.has(t)){var n=this.markerAnnotations.get(t);if(n.getShapeType()==Pt.MARKER){var i=n;this.rBushTree.remove(i),i.destroy()}this.markerAnnotations.delete(t)}},e.prototype.getInfoWindowManager=function(){return this.infoWindowManager},e.prototype.getVisibleMarkers=function(){var t=this,e=[];return this.tileManager.getVisibleTiles().forEach(function(n){var i=n.getTileCoordinate(),o=w.tileCoordinateToLatLngBounds(i),r={minX:o.getSouthwest().lng(),minY:o.getSouthwest().lat(),maxX:o.getNortheast().lng(),maxY:o.getNortheast().lat()};t.rBushTree.search(r).forEach(function(t){e.push(t)})}),e},e}(gt),Tn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),bn=function(t){function e(e,n,i){var o=t.call(this,e,n,ut.LINE,i)||this;return o._strokeWidth=5,o._strokeColor=new S(0,0,0,1),o._strokeOpacity=1,o.renderTiles=new Map,o}return Tn(e,t),e.prototype.update=function(t){},e.prototype.setStrokeWidth=function(t){this._strokeWidth=t},e.prototype.setStrokeColor=function(t){null!==t?(this._strokeColor=S.fromHex(t),this._strokeColor.alpha=this._strokeOpacity):this._strokeColor=new S(255,0,0,this._strokeOpacity)},e.prototype.setStrokeOpacity=function(t){this._strokeOpacity=t,this._strokeColor.alpha=this._strokeOpacity},e.prototype.setVisible=function(t){this._visible=t},e.prototype.getStrokeWidth=function(){return this._strokeWidth},e.prototype.getStrokeColor=function(){return this._strokeColor},e.prototype.getStrokeOpacity=function(){return this._strokeOpacity},e.prototype.isVisible=function(){return this._visible},e.prototype.addRenderTile=function(t,e){this.renderTiles.has(t)||this.renderTiles.set(t,e)},e.prototype.removeRenderTile=function(t){this.renderTiles.delete(t)},e}(gt),_n=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Sn=function(t){function e(e,n,i){var o=t.call(this,e,n,ut.FILL,i)||this;return o._fillColor=new S(0,0,0,1),o._fillOpacity=1,o._visible=!0,o._renderTiles=new Map,o}return _n(e,t),e.prototype.update=function(t){},e.prototype.setFillColor=function(t){null!==t?(this._fillColor=S.fromHex(t),this._fillColor.alpha=this._fillOpacity):this._fillColor=new S(255,0,0,this._fillOpacity)},e.prototype.setFillOpacity=function(t){this._fillOpacity=t,this._fillColor.alpha=this._fillOpacity},e.prototype.setVisible=function(t){this._visible=t},e.prototype.addRenderTile=function(t,e){this._renderTiles.has(t)||this._renderTiles.set(t,e)},e.prototype.removeRenderTile=function(t){this._renderTiles.delete(t)},Object.defineProperty(e.prototype,"renderTiles",{get:function(){return this._renderTiles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillColor",{get:function(){return this._fillColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillOpacity",{get:function(){return this._fillOpacity},enumerable:!0,configurable:!0}),e}(gt),Cn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),En=function(t){function e(e,n,i){var o=t.call(this,e,n,ut.CIRCLE,i)||this;return o._center=new p(0,0),o._radius=0,o._fillColor=new S(0,0,0,1),o._fillOpacity=1,o._visible=!0,o._renderTiles=new Map,o}return Cn(e,t),e.prototype.update=function(t){},e.prototype.setCenter=function(t){this._center=t},e.prototype.setRadius=function(t){this._radius=t},e.prototype.setFillColor=function(t){null!==t?(this._fillColor=S.fromHex(t),this.fillColor.alpha=this.fillOpacity):this._fillColor=new S(255,0,0,this.fillOpacity)},e.prototype.setFillOpacity=function(t){this._fillOpacity=t,this.fillColor.alpha=this.fillOpacity},e.prototype.setVisible=function(t){this._visible=t},Object.defineProperty(e.prototype,"center",{get:function(){return this._center},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillColor",{get:function(){return this._fillColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillOpacity",{get:function(){return this._fillOpacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderTiles",{get:function(){return this._renderTiles},enumerable:!0,configurable:!0}),e.prototype.addRenderTile=function(t,e){this._renderTiles.has(t)||this._renderTiles.set(t,e)},e.prototype.removeRenderTile=function(t){this._renderTiles.delete(t)},e}(gt),Rn=function(){function t(t){this.buildings=[],this.id=t}return t.prototype.addBuilding=function(t){this.buildings.push(t)},t.prototype.getModel=function(){return 0==this.buildings.length?null:this.buildings[0].getModel()},t}(),In=function(){function t(){}return t.calculateDistanceBetweenPointToLineBy2Point=function(t,e,n){return 100},t.calculateDistanceBetweenPointToLine=function(t,e){return 100},t}(),Ln=n(4),On=function(){function t(t){this._lightColor=t}return Object.defineProperty(t.prototype,"lightColor",{get:function(){return this._lightColor},set:function(t){this._lightColor=t},enumerable:!0,configurable:!0}),t}(),Dn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Pn=function(t){function e(e,n){var i=t.call(this,e)||this;return i._lightPosition=n,i}return Dn(e,t),Object.defineProperty(e.prototype,"lightPosition",{get:function(){return this._lightPosition},set:function(t){this._lightPosition=t},enumerable:!0,configurable:!0}),e}(On),Bn=function(){function t(){this._lastUpdateTime=0,this._sunLight=new Pn(new x(1,1,1),new x(0,0,1))}return t.prototype.update=function(t){var e=(new Date).getTime();if(!(e-this._lastUpdateTime<6e4)){this._lastUpdateTime=e;var n=Ln.getPosition(new Date,t.lat(),t.lng()),i=-1*n.azimuth,o=f.clamp(Math.abs(n.altitude),Math.PI/6,Math.PI/2);this._sunLight.lightPosition=new x(Math.cos(o)*Math.sin(i),Math.cos(o)*Math.cos(i),Math.sin(o))}},Object.defineProperty(t.prototype,"sunLight",{get:function(){return this._sunLight},enumerable:!0,configurable:!0}),t}(),kn=function(){function t(t){if(this.defaultMapObjectOptions={name:"object",scale:1,bearing:0,elevation:0,heightScale:1,objUrl:null,textureUrl:null,objData:null,textureData:null,objName:null,textureName:null},null!=t){this.needUpdateBounds=!0;var e={};T.extendOptions(e,this.defaultMapObjectOptions,t),this.id=e.id,this.location=p.convert(e.location),this.name=e.name,this.scale=e.scale,this.bearing=e.bearing,this.elevation=e.elevation,this.heightScale=e.heightScale,null!=e.objUrl?this.objUrl=e.objUrl:null!=e.objData?this.objData=e.objData:null!=e.objName&&(this.objUrl=e.objName),null!=e.textureUrl?this.textureUrl=e.textureUrl:null!=e.textureData?this.textureData=e.textureData:null!=e.textureName&&(this.textureUrl=e.textureName),this.updateBounds()}}return t.prototype.initWithBuilding=function(t){this.id=t.getId(),this.name=t.getName(),this.places=t.getPlaces(),this.scale=t.getScale(),this.bearing=t.getBearing(),this.location=t.getLocation(),this.elevation=t.getElevation(),this.heightScale=t.getHeightScale(),this.camera=t.getCamera(),this.types=t.getTypes(),this._isVerified=t.isVerified(),this.minZoom=t.getMinZoom(),this.maxZoom=t.getMaxZoom(),this.startDate=new Date(t.getStartDate()),this.endDate=new Date(t.getEndDate())},t.prototype.setId=function(t){this.id=t},t.prototype.getId=function(){return this.id},t.prototype.getName=function(){return this.name},t.prototype.setName=function(t){this.name=t},t.prototype.setPlaces=function(t){this.places=t},t.prototype.getPlaces=function(){return this.places},t.prototype.setScale=function(t){this.scale=t},t.prototype.getScale=function(){return this.scale},t.prototype.setBearing=function(t){this.bearing=t},t.prototype.getBearing=function(){return this.bearing},t.prototype.setLocation=function(t){this.location=p.convert(t)},t.prototype.getLocation=function(){return this.location},t.prototype.setElevation=function(t){this.elevation=t},t.prototype.getElevation=function(){return this.elevation},t.prototype.setHeightScale=function(t){this.heightScale=t},t.prototype.getHeightScale=function(){return this.heightScale},t.prototype.setCamera=function(t){this.camera=v.convert(t),null==this.camera.getTarget()&&this.camera.setTarget({lat:0,lng:0}),null==this.camera.getZoom()&&this.camera.setZoom(a.defaultMinZoom3d),null==this.camera.getTilt()&&this.camera.setTilt(0),null==this.camera.getBearing()&&this.camera.setBearing(0)},t.prototype.getCamera=function(){return this.camera},t.prototype.setTypes=function(t){this.types=t},t.prototype.getTypes=function(){return this.types},t.prototype.setVerified=function(t){this._isVerified=t},t.prototype.isVerified=function(){return this._isVerified},t.prototype.setMinZoom=function(t){this.minZoom=t},t.prototype.getMinZoom=function(){return this.minZoom},t.prototype.setMaxZoom=function(t){this.maxZoom=t},t.prototype.getMaxZoom=function(){return this.maxZoom},t.prototype.setStartDate=function(t){this.startDate=t},t.prototype.getStartDate=function(){return this.startDate},t.prototype.setEndDate=function(t){this.endDate=t},t.prototype.getEndDate=function(){return this.endDate},t.prototype.setObjUrl=function(t){this.needUpdateBounds=!0,this.objUrl=t},t.prototype.setTextureUrl=function(t){this.textureUrl=t},t.prototype.setObjData=function(t){this.needUpdateBounds=!0,this.objData=t},t.prototype.setTextureData=function(t){this.textureData=t},t.prototype.setObjName=function(t){this.needUpdateBounds=!0,this.objUrl=t},t.prototype.setTextureName=function(t){this.textureUrl=t},t.prototype.getTextureData=function(){return this.textureData},t.prototype.getTextureUrl=function(){return this.textureUrl},t.prototype.getObjData=function(){return this.objData},t.prototype.getObjUrl=function(){return this.objUrl},t.prototype.setMap=function(t){this._map!==t&&(null!=this._map&&null==t&&this._map.mapView.removeMapObject(this.id),this._map=t,null!=this._map&&this._map.mapView.addMapObject(this))},t.prototype.isNeedUpdateBounds=function(){return this.needUpdateBounds},t.prototype.setNeedUpdateBounds=function(t){this.needUpdateBounds=t},t.prototype.updateBounds=function(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0);var o=this.getLocation(),r=A.convertToMeterFromLatLng(o),a=new y(r.x-t,r.y-i),s=new y(r.x+n,r.y-e),u=new M(A.convertToLatLngFromMeter(a),A.convertToLatLngFromMeter(s));this._minX=u.getSouthwest().lng(),this._minY=u.getSouthwest().lat(),this._maxX=u.getNortheast().lng(),this._maxY=u.getNortheast().lat()},Object.defineProperty(t.prototype,"minX",{get:function(){return this._minX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minY",{get:function(){return this._minY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxX",{get:function(){return this._maxX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxY",{get:function(){return this._maxY},enumerable:!0,configurable:!0}),t}(),Nn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Zn=function(t){function e(e,n,i){var o=t.call(this,e,n,ut.BUILDING,i)||this;return o.extrudeBuildings=[],o.dirty=!0,o.colorBuildingGroups=new Map,o.textureBuildingGroups=new Map,o.lightManager=new Bn,o}return Nn(e,t),e.prototype.update=function(t){var e=this;if(t.is3dMode()&&(this.buildingResourceManager.update(),this.dirty)){this.dirty=!1;var n=t.getZoom(),i=t.getScale(),o=t.getScreenSize(),r=A.projectScale(w.screenCoordinateToLatLngZoom(new y(o.x,o.y),t,n),i),a=A.projectScale(w.screenCoordinateToLatLngZoom(new y(0,o.y),t,n),i);this.colorBuildingGroups.clear(),this.textureBuildingGroups.clear(),this.extrudeBuildings=[];var s=[];s.push([a.x,a.y]),s.push([r.x,r.y]),this.buildingResourceManager.buildings.forEach(function(n){var o=n.building;o.updateMatrices(t),o.setDistance(In.calculateDistanceBetweenPointToLine(A.projectScale(o.getLocation(),i),s));var r=o.getObjName();if(o.getBuildingType()==Y.Color){var a=e.colorBuildingGroups.get(r);if(null==a)(u=new Rn(r)).addBuilding(o),e.colorBuildingGroups.set(r,u);else a.addBuilding(o)}else if(o.getBuildingType()==Y.Polygon)e.extrudeBuildings.push(o);else{var u,l=e.textureBuildingGroups.get(r);if(null==l)(u=new Rn(r)).addBuilding(o),e.textureBuildingGroups.set(r,u);else l.addBuilding(o)}}),this.lightManager.update(t.getCamera().getTarget())}},e.prototype.setDirty=function(){this.dirty=!0},e.prototype.getBuildingResourceManager=function(){return this.buildingResourceManager},e.prototype.setBuildingResourceManager=function(t){var e=this;this.buildingResourceManager=t,this.buildingResourceManager.setBuildingLayerDirty=function(){e.setDirty()}},e.prototype.getBuilding=function(t){if(t<0)return null;if(0==this.colorBuildingGroups.size&&0==this.textureBuildingGroups.size&&0==this.extrudeBuildings.length)return null;var e=null;if(0!=this.textureBuildingGroups.size&&this.textureBuildingGroups.forEach(function(n){n.buildings.forEach(function(n){if(n.getSelectionCode()==t)return e=n,null})}),null==e&&0!=this.colorBuildingGroups.size&&this.colorBuildingGroups.forEach(function(n){n.buildings.forEach(function(n){n.getSelectionCode()!=t||(e=n)})}),null==e&&0!=this.extrudeBuildings.length&&this.extrudeBuildings.forEach(function(n){n.getSelectionCode()!=t||(e=n)}),null!=e){var n=new kn;return n.initWithBuilding(e),n}return null},e.prototype.clear=function(){this.colorBuildingGroups.clear(),this.textureBuildingGroups.clear(),this.extrudeBuildings=[]},e}(gt),Fn=function(){function t(){}return t.createLayer=function(t,e,n,i){switch(e){case ut.RASTER:return new mn(t,i,n);case ut.BUILDING:return new Zn(t,i,n);case ut.ANNOTATION:return new wn(t,i,n);case ut.LINE:return new bn(t,i,n);case ut.FILL:return new Sn(t,i,n);case ut.CIRCLE:return new En(t,i,n);default:return console.log("Un-support layer type"),null}},t}(),Un=function(){function t(t,e){var n=this;this.watchId=-1,this.userLocationDotId=-1,this.userLocationDot=null,this.lastKnownLocation=null,this.defaultPositionOptions={enableHighAccuracy:!0,maximumAge:0,timeout:6e3},this.mapView=e,null!=t&&(this.myLocationButton=E.create("div","mf-button",t),this.myLocationButton.innerHTML="<a class='mf-location'></a>",this.myLocationButton.addEventListener("click",function(){n.onMyLocationButtonClick()}))}return t.prototype.flyToMyLocation=function(t){void 0===t&&(t=!0),-1==this.watchId&&(this.watchId=window.navigator.geolocation.watchPosition(this.onGetCurrentPositionSuccess.bind(this),this.onGetCurrentPositionError.bind(this),this.defaultPositionOptions)),null!=this.lastKnownLocation&&this.mapView.flyTo(this.lastKnownLocation,17,{animate:t})},t.prototype.onMyLocationButtonClick=function(){this.flyToMyLocation()},t.prototype.onGetCurrentPositionSuccess=function(t){var e=new p(t.coords.latitude,t.coords.longitude);if(null==this.lastKnownLocation&&this.mapView.flyTo(e,17,{animate:!0}),this.lastKnownLocation=e,null==this.userLocationDot){var n=Ae.defaultMarker;n.url=b.get("myPosition"),this.userLocationDot=new we({position:e,visible:!0,anchor:new g(.5,.5),icon:n}),this.userLocationDotId=this.mapView.addAnnotation(this.userLocationDot)}else this.userLocationDot.setPosition(e),this.userLocationDot.setVisible(!0)},t.prototype.onGetCurrentPositionError=function(t){1===t.code&&(-1!=this.watchId&&(window.navigator.geolocation.clearWatch(this.watchId),this.watchId=-1),-1!=this.userLocationDotId&&(this.mapView.removeAnnotation(this.userLocationDotId),this.userLocationDotId=-1,this.userLocationDot=null))},t}(),jn=function(){function t(t,e){this._id=t,this._eventCallback=e}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventCallBack",{get:function(){return this._eventCallback},enumerable:!0,configurable:!0}),t}(),zn=function(){function t(t){this.eventIdCounter=0,this.events=new Map,this.mapView=t}return t.convertEventFromName=function(t){switch(t){case"cameraWillChange":return i.cameraWillChange;case"cameraChanging":return i.cameraChanging;case"idle":return i.idle;case"click":return i.click;case"dblClick":return i.dblClick;case"drag":return i.drag;case"dragEnd":return i.dragEnd;case"dragStart":return i.dragStart;case"mouseMove":return i.mouseMove;case"mouseOut":return i.mouseOut;case"mouseOver":return i.mouseOver;case"rightClick":return i.rightClick;case"markerClick":return i.markerClick;case"buildingClick":return i.buildingClick;case"polylineClick":return i.polylineClick;case"polygonClick":return i.polygonClick;case"circleClick":return i.circleClick;case"modeChanged":return i.modeChanged;default:throw new Error("Event not supported: "+t)}},t.prototype.addEvent=function(e,n){var i="string"==typeof e?t.convertEventFromName(e):e,o=this.eventIdCounter++;this.events.has(i)?this.events.get(i).push(new jn(o,n)):this.events.set(i,[new jn(o,n)]);var r=this.events;return new(function(){function t(){}return t.prototype.remove=function(){if(r.has(i)){var t=r.get(i),e=t.findIndex(function(t){return t.id==o});e>=0&&t.splice(e,1),0===t.length&&r.delete(i)}},t}())},t.prototype.removeEvent=function(e){var n=t.convertEventFromName(e);this.events.has(n)&&this.events.delete(n)},t.prototype.onClickEvent=function(t){var e=this.events.get(i.markerClick),n=this.mapView.annotationManager;if(null!=e&&0!=e.length){var o=this.mapView.queryMarkerAnnotation(t);if(null!=o&&null!=o.getMap())return e.forEach(function(t){return t.eventCallBack({marker:o})}),n.selectedMarker(o.getId()),!0}n.deselectedMarker();var r=this.events.get(i.buildingClick);if(null!=r&&0!=r.length&&this.mapView.mapState.is3dMode()){var a=this.mapView.queryBuildingInfo(t);if(null!=a)return r.forEach(function(t){return t.eventCallBack({object:a})}),!0}var s=this.events.get(i.polylineClick),u=this.events.get(i.polygonClick),l=this.events.get(i.circleClick);if(null!=s&&0!=s.length||null!=u&&0!=u.length||null!=l&&0!=l.length){var h=this.mapView.queryShapeAnnotation(t);if(null!=h)if(h instanceof rn){if(null!=s&&0!=s.length)return s.forEach(function(t){return t.eventCallBack({polyline:h})}),!0}else if(h instanceof be){if(null!=u&&0!=u.length)return u.forEach(function(t){return t.eventCallBack({polygon:h})}),!0}else if(h instanceof xe&&null!=l&&0!=l.length)return l.forEach(function(t){return t.eventCallBack({circle:h})}),!0}return!1},t.prototype.notify=function(t,e,n){var o=this,r=this.events.get(t);if(r&&Array.isArray(r)&&0!==r.length)switch(t){case i.click:case i.rightClick:case i.dblClick:case i.dragStart:case i.drag:case i.dragEnd:case i.mouseMove:case i.mouseOut:case i.mouseOver:var a=this.mapView.getCurrentMousePosition(e),s=new g(a.x,a.y),u=T.pixelToPoint(s);r.forEach(function(t){return t.eventCallBack({location:w.screenCoordinateToLatLng(a,o.mapView.mapState),point:u,pixel:s,xa:e})});break;case i.cameraWillChange:var l=this.mapView.getCamera();r.forEach(function(t){return t.eventCallBack({camera:new v(l.getTarget(),l.getTilt(),l.getBearing(),l.getZoom()),gesture:n})});break;case i.cameraChanging:case i.idle:var h=this.mapView.getCamera();r.forEach(function(t){return t.eventCallBack({camera:new v(h.getTarget(),h.getTilt(),h.getBearing(),h.getZoom())})});break;case i.modeChanged:r.forEach(function(t){return t.eventCallBack({is3DMode:o.mapView.mapSettings.is3dMode()})});break;default:r.forEach(function(t){return t.eventCallBack()})}},t.prototype.destroy=function(){this.events.clear()},t}(),Vn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Yn=function(t){function e(e,n){var i=t.call(this,ut.LINE)||this;return i.gl=n,i.buildPolyline(e),i}return Vn(e,t),e.prototype.getModel=function(){return this.lineModel},e.prototype.buildPolyline=function(t){var e=[],n=new Ct;n.addVertex=function(t,n){e.push(t.x,t.y,n.x,n.y)},n.lineCapType=ft.Butt,n.lineJoinType=dt.Round;for(var i=T.getTileSize(),o=t.featureCount(),r=0;r<o;++r){var a=t.getFeature(r);if(a.getType()!=re.LineString)return void console.warn("# buildPolyline ----------- not GeometryType.LineString");for(var s=a.getGeometries().geometryCoordinates,u=0;u<s.length;++u){for(var l=[],h=0;h<s[u].length;++h){var c=new y(s[u][h][0],s[u][h][1]);c.x=c.x*i,c.y=c.y*i,l.push(c)}n.buildPolyLine(l)}return this.lineModel=new xt(this.gl,this.gl.TRIANGLES),void this.lineModel.init(e,[new mt("a_position",null,2,0,4),new mt("a_extrude",null,2,2,4)],n.indices)}},e.prototype.destroy=function(){this.lineModel&&this.lineModel.destroy()},e}(hn),Wn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Xn=function(t){function e(e,n){var i=t.call(this,ut.FILL)||this;return i.gl=n,i.buildPolygon(e),i}return Wn(e,t),e.prototype.getModel=function(){return this.fillModel},e.prototype.buildPolygon=function(t){var e=[],n=new wt;n.addVertex=function(t){e.push(t.x,t.y)};for(var i=T.getTileSize(),o=t.featureCount(),r=0;r<o;++r){var a=t.getFeature(r);if(a.getType()!=re.Polygon)return void console.warn("# buildPolygon ----------- not GeometryType.Polygon");for(var s=a.getGeometries().geometryCoordinates,u=[],l=0;l<s.length;++l){for(var h=[],c=0;c<s[l].length;++c){var p=new y(s[l][c][0],s[l][c][1]);p.x=p.x*i,p.y=p.y*i,h.push(p)}u.push(h)}return Tt(u,n),this.fillModel=new xt(this.gl,this.gl.TRIANGLES),void this.fillModel.init(e,[new mt("a_position",null,2,0,2)],n.indices)}},e.prototype.destroy=function(){this.fillModel&&this.fillModel.destroy()},e}(hn),Gn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Hn=function(t){function e(e,n,i){var o=t.call(this,e,n,i)||this;return o.gl=i,o.layerDatas=new Map,o.tileData=null,o}return Gn(e,t),e.prototype.getTexture=function(){return null},e.prototype.init=function(t,e){},e.prototype.setData=function(t){this.tileData=t},e.prototype.hasData=function(t){return null!=this.tileData&&null!=this.tileData.getLayer(t)},e.prototype.removeLayerData=function(t){var e=this.layerDatas.get(t);e&&(e.destroy(),this.layerDatas.delete(t))},e.prototype.getLayerData=function(t,e){if(!this.layerDatas.has(t)){var n=this.tileData.getLayer(t);if(null==n)return console.error("getLayerData not reachable"),null;switch(e){case ut.LINE:var i=new Yn(n,this.gl);return this.layerDatas.set(t,i),this.layerDatas.get(t);case ut.FILL:var o=new Xn(n,this.gl);return this.layerDatas.set(t,o),this.layerDatas.get(t);default:return console.error("getLayerData not reachable"),null}}return this.layerDatas.get(t)},e.prototype.getTileData=function(){return this.tileData},e}(Bt),Qn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Jn=function(t){function e(e,n,i){var o=t.call(this,Ot.ANNOTAION,e,i)||this;return o.annotationManager=n,o.annotationManager.addTile(o),o}return Qn(e,t),e.prototype.destroy=function(){this.layerDatas.forEach(function(t){return t.destroy()}),this.annotationManager.removeTile(this)},e}(Hn),qn=function(){return function(t,e){this.building=t,this.reference=e}}(),Kn=function(){return function(t,e){this.model=t,this.reference=e}}(),$n=function(){return function(t,e){this.texture=t,this.reference=e}}(),ti=function(){function t(t,e,n){this.gl=t,this.buildings=new Map,this.models=new Map,this.textures=new Map,this.buildingTaskManager=e,this.modelRequestsMap=new Map,this.textureRequestsMap=new Map,this.setBuildingLayerDirty=function(){},this.requestRender=n}return t.prototype.hasBuilding=function(t){return this.buildings.has(t)},t.prototype.getBuilding=function(t){return this.buildings.has(t)?this.buildings.get(t).building:null},t.prototype.addBuildingWithData=function(t,e,n,i){if(e.getBuildingType()==Y.Polygon&&!this.buildings.has(t)){var o=new xt(this.gl,this.gl.TRIANGLES),r=[].concat.apply([],n);o.initBuilding(r,i),e.setModel(o),this.buildings.set(t,new qn(e,1)),this.setBuildingLayerDirty()}},t.prototype.addBuilding=function(e,n){var i=this;if(n.getBuildingType()!=Y.Polygon&&!this.buildings.has(e)){var o=n.getObjName(),r=this.models.get(o);if(null!=r)++r.reference,n.setModel(r.model);else{var s=new xt(this.gl,this.gl.TRIANGLES);this.models.set(o,new Kn(s,1)),n.setModel(s);var u=n.getObjData();if(null!=u){var l=rt.loadModel(u);null!=l&&(s.initBuilding(l.data[0].data),this.requestRender())}else{var h=null;if(null==o)return void console.error("You do not set Url for Model. Please set first !");h=t.isUrlRequest(o)?o:z.getBuildingDataUrl(a.baseModelRequestUrl,o,D.getAccessKey()),(g=new W(j.Model)).url=h,g.completion=function(e){if(null!=e.data){if(n.getBuildingType()==Y.External){var r=t.getBoundsFromModelData(e.data[0].data);n.setBounds(r)}s.initBuilding(e.data[0].data),i.modelRequestsMap.delete(o),i.requestRender()}},this.modelRequestsMap.set(o,g),this.buildingTaskManager.postTask(g)}}var c=n.getTextureName(),p=this.textures.get(c);if(null!=p)++p.reference,n.setTexture(p.texture);else{var f=new Lt(this.gl);this.textures.set(c,new $n(f,1)),n.setTexture(f);var d=n.getTextureData();if(null!=d)f.loadImage(d);else{var g,m=null;if(null==c){console.warn("You do not set Url for custom Texture. Please set first !");var y=Dt.Instance.getTexture(St.WHITE_TEXTURE);return f=y,void this.buildings.set(e,new qn(n,1))}m=t.isUrlRequest(c)?c:z.getBuildingDataUrl(a.baseTextureRequestUrl,c,D.getAccessKey()),(g=new W(j.Texture)).url=m,g.completion=function(t){if(null!=t.data){f.loadImageFromBlob(t.data,function(){i.textureRequestsMap.delete(c),i.requestRender()})}},this.textureRequestsMap.set(c,g),this.buildingTaskManager.postTask(g)}}this.buildings.set(e,new qn(n,1)),this.setBuildingLayerDirty()}},t.prototype.removeAllResources=function(){var t=this;this.models.forEach(function(t){return t.model.destroy()}),this.textures.forEach(function(t){return t.texture.destroy()}),this.buildings.clear(),this.models.clear(),this.textures.clear(),this.modelRequestsMap.forEach(function(e){t.buildingTaskManager.cancelTask(e)}),this.modelRequestsMap.clear(),this.textureRequestsMap.forEach(function(e){t.buildingTaskManager.cancelTask(e)}),this.textureRequestsMap.clear()},t.prototype.increaseBuildingReference=function(t){var e=this.buildings.get(t);null!=e?++e.reference:console.warn("Can not find any building with id: "+t+" to increase reference !")},t.prototype.decreaseBuildingReference=function(t){var e=this.buildings.get(t);if(null!=e){if(e.reference-=1,!e.reference){if(e.building.getBuildingType()!=Y.Polygon){var n=e.building.getObjName(),i=this.models.get(n);if(null==i)return void console.warn("Can not find model with id: "+n+" for building !");if(i.reference-=1,!i.reference){var o=this.modelRequestsMap.get(n);null!=o&&(this.buildingTaskManager.cancelTask(o),this.modelRequestsMap.delete(n)),i.model&&i.model.destroy(),this.models.delete(n)}var r=e.building.getTextureName(),a=this.textures.get(r);if(null==a)return void console.warn("Can not find texture with id: "+r+" for building !");if(a.reference-=1,!a.reference){var s=this.textureRequestsMap.get(r);s&&(this.buildingTaskManager.cancelTask(s),this.textureRequestsMap.delete(r)),a.texture.destroy(),this.textures.delete(r)}}this.buildings.delete(t)}this.setBuildingLayerDirty()}else console.warn("Can not find any building with id: "+t+" to decrease reference !")},t.prototype.update=function(){},t.isUrlRequest=function(t){return 0==t.indexOf("http")},t.getBoundsFromModelData=function(t){for(var e=0,n=0,i=0,o=0,r=0;e<t.length;)n>t[e]&&(n=t[e]),o<t[e]&&(o=t[e]),i>t[e+2]&&(i=t[e+2]),r<t[e+2]&&(r=t[e+2]),e+=8;return{minX:n,minY:i,maxX:o,maxY:r}},t}(),ei=function(){function t(t){this.gl=t,this.init()}return t.prototype.init=function(){var t=this.gl;this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight;var e=new Et(t.NEAREST,t.NEAREST),n=new Rt(t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE),i=new It(t.TEXTURE_2D,t.RGB,t.RGB,t.UNSIGNED_BYTE,e,n);this.colorTexture=new Lt(t,i),this.colorTexture.initWithSize(this.width,this.height),this.depthBuffer=this.gl.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.depthBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height),t.bindRenderbuffer(t.RENDERBUFFER,null),this.frameBufferId=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBufferId),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.colorTexture.textureId,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer);var o=t.checkFramebufferStatus(t.FRAMEBUFFER);if(o!=t.FRAMEBUFFER_COMPLETE){switch(o){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case t.FRAMEBUFFER_UNSUPPORTED:console.warn("FRAMEBUFFER_UNSUPPORTED");break;default:console.warn("Unknown framebuffer issue")}return t.bindFramebuffer(t.FRAMEBUFFER,null),!1}return t.bindFramebuffer(t.FRAMEBUFFER,null),!0},t.prototype.bind=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBufferId)},t.prototype.unbind=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},t.prototype.drawDebug=function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT);var t=Dt.Instance.getShader(bt.DEBUG_SELECTION_SHARDER),e=Dt.Instance.getModel(_t.SELECTION_DEBUG_MODEL);t.bind(),t.setAttributes(e.attributeInfos),t.setUniforms([new yt("u_texture","texture",this.colorTexture)]),e.render(),t.resetTextureUnit()},t.prototype.destroy=function(){this.colorTexture&&this.colorTexture.destroy(),this.gl.deleteRenderbuffer(this.depthBuffer),this.gl.deleteFramebuffer(this.frameBufferId),this.colorTexture=null,this.depthBuffer=null,this.frameBufferId=null},t}(),ni=function(){function t(t){this._particlePool=t,this._acceleration=null,this._frequency=1,this._maxParticles=1e3,this._minSpeed=0,this._maxSpeed=0,this._minScale=1,this._maxScale=1,this._minLifetime=0,this._maxLifetime=0,this._minRotation=0,this._maxRotation=0,this._minRotationSpeed=0,this._maxRotationSpeed=0,this._lifetimeFunc=null,this._extraData=null,this._updateFunc=null,this._emitterPosition=new y(0,0),this._activeParticlesFirst=null,this._activeParticlesLast=null,this._spawnRect=null,this._spawnTimer=0,this._particleCount=0}return t.prototype.init=function(t){this.cleanup(),t.frequency&&(this._frequency=t.frequency),t.maxParticles&&(this._maxParticles=t.maxParticles>0?t.maxParticles:1e3);var e=t.acceleration;e&&(e.x||e.y)&&(this._acceleration=new y(e.x,e.y)),t.minSpeed&&(this._minSpeed=t.minSpeed),t.maxSpeed&&(this._maxSpeed=t.maxSpeed),t.minScale&&(this._minScale=t.minScale),t.maxScale&&(this._maxScale=t.maxScale),t.maxRotation&&(this._maxRotation=t.maxRotation),t.minRotation&&(this._minRotation=t.minRotation),t.minRotationSpeed&&(this._minRotationSpeed=t.minRotationSpeed),t.maxRotationSpeed&&(this._maxRotationSpeed=t.maxRotationSpeed),t.minLifetime&&(this._minLifetime=t.minLifetime),t.maxLifetime&&(this._maxLifetime=t.maxLifetime),t.extraData&&(this._extraData=t.extraData),t.updateFunc&&(this._updateFunc=t.updateFunc),t.lifetimeFunc&&(this._lifetimeFunc=t.lifetimeFunc),t.spawnRect&&(this._spawnRect=t.spawnRect),this._spawnTimer=0},t.prototype.update=function(e){var n,i;for(n=this._activeParticlesFirst;n;n=i)i=n.next,n.update(e);for(this._spawnTimer-=e<0?0:e;this._spawnTimer<=0;)if(this._particleCount>=this._maxParticles)this._spawnTimer+=this._frequency;else{var o=void 0;o=this._lifetimeFunc?0:Math.random()*(this._maxLifetime-this._minLifetime)+this._minLifetime;var r=this._emitterPosition.x,a=this._emitterPosition.y,s=this._particlePool.acquire(this);if(s.acceleration=this._acceleration?new y(this._acceleration.x,this._acceleration.y):null,s.scale=(this._maxScale-this._minScale)*Math.random()+this._minScale,s.maxLife=o,s.lifetimeFunc=this._lifetimeFunc,s.velocity=new y(0,(this._maxSpeed-this._minSpeed)*Math.random()+this._minSpeed),s.rotation=(this._maxRotation-this._minRotation)*Math.random()+this._minRotation,s.rotationSpeed=(this._maxRotationSpeed-this._minRotationSpeed)*Math.random()+this._minRotationSpeed,s.extraData=t.deepClone(this._extraData),s.updateFunc=this._updateFunc,this._spawnRect&&this._spawnRect.width&&this._spawnRect.height){var u=Math.random()*this._spawnRect.width,l=Math.random()*this._spawnRect.height;s.position=new y(r+u-this._spawnRect.width/2,a+l-this._spawnRect.height/2)}else s.position=new y(r,a);s.init(),this._activeParticlesLast?(this._activeParticlesLast.next=s,s.prev=this._activeParticlesLast,this._activeParticlesLast=s):this._activeParticlesLast=this._activeParticlesFirst=s,++this._particleCount,this._spawnTimer+=this._frequency}},t.prototype.recycle=function(t){t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t==this._activeParticlesLast&&(this._activeParticlesLast=t.prev),t==this._activeParticlesFirst&&(this._activeParticlesFirst=t.next),this._particlePool.release(t),--this._particleCount},t.prototype.cleanup=function(){var t,e;for(t=this._activeParticlesFirst;t;t=e)e=t.next,this.recycle(t);this._activeParticlesFirst=this._activeParticlesLast=null,this._particleCount=0},t.prototype.destroy=function(){this.cleanup(),this._particlePool=null,this._lifetimeFunc=null,this._spawnRect=null,this._extraData=null,this._updateFunc=null},Object.defineProperty(t.prototype,"particleCount",{get:function(){return this._particleCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emitterPosition",{set:function(t){this._emitterPosition=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spawnRect",{set:function(t){this._spawnRect=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lifetimeFunc",{set:function(t){this._lifetimeFunc=t},enumerable:!0,configurable:!0}),t.deepClone=function(t){var e={};for(var n in t)e[n]=t[n];return e},t}(),ii=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),oi=function(t){function e(e,n,i){var o=t.call(this,i)||this;return o._shader=e,o._particleTexture=n,o}return ii(e,t),e.prototype.render=function(t){var e=Dt.Instance.getModel(_t.PARTICLE_QUAD_MODEL),n=t.getOrthoProjectionMatrix();this._shader.bind(),this._shader.setAttributes(e.attributeInfos),this._shader.setUniforms([new yt("u_texture","texture",this._particleTexture)]);for(var i=this._activeParticlesFirst;i;i=i.next){var o=i.position,r=i.scale,a=i.rotation,s=L.translate(o.x,o.y,0),u=L.scale(this._particleTexture.width*r,this._particleTexture.height*r,1);s=L.rotateZ(a).concat(s);var l=(s=u.concat(s)).concat(n);this._shader.setUniforms([new yt("u_mvpMatrix","matrix",l)]),e.render()}},e}(ni),ri=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ai=function(t){function e(e){var n=Dt.Instance.getShader(bt.PARTICLE_SHADER),i=Dt.Instance.getTexture(St.RAIN_TEXTURE);return t.call(this,n,i,e)||this}return ri(e,t),e.prototype.init=function(){t.prototype.init.call(this,{frequency:c.rainFrequency,maxParticles:1e3,acceleration:new y(0,1e3).rotateBy(c.rainParticleRotation),minSpeed:0,maxSpeed:1e3,minScale:.35,maxScale:.35,maxRotation:c.rainParticleRotation,minRotation:c.rainParticleRotation})},e}(oi),si=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ui=function(t){function e(e){var n=Dt.Instance.getShader(bt.PARTICLE_SHADER),i=Dt.Instance.getTexture(St.SNOW_TEXTURE);return t.call(this,n,i,e)||this}return si(e,t),e.prototype.init=function(){t.prototype.init.call(this,{frequency:c.snowFrequency,maxParticles:1e3,acceleration:new y(0,50),minSpeed:50,maxSpeed:200,minScale:.25,maxScale:.35,maxRotation:0,minRotation:0,minRotationSpeed:0,maxRotationSpeed:200,extraData:{counter:0},updateFunc:function(t,e){t.acceleration&&(t.velocity.y+=t.acceleration.y*e),0!==t.rotationSpeed&&(t.rotation+=t.rotationSpeed*e),t.extraData.counter+=4,t.position.x+=2*Math.cos(t.extraData.counter*s.deg2Rad),t.position.y+=t.velocity.y*e}})},e}(oi);!function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.Sun=2]="Sun"}(qe||(qe={}));var li,hi,ci=function(){function t(t){this._emitter=t,this._position=new y(0,0),this._scale=1,this._velocity=new y(0,0),this._rotation=0,this._rotationSpeed=0,this._acceleration=null,this._extraData=null,this._updateFunc=null,this._maxLife=0,this._age=0}return t.prototype.update=function(t){if(this._age+=t,this._lifetimeFunc){if(this._lifetimeFunc(this))return void this.kill()}else if(this._age>=this._maxLife||this._age<0)return void this.kill();this._updateFunc?this._updateFunc(this,t):(this._acceleration&&(this._velocity.x+=this._acceleration.x*t,this._velocity.y+=this._acceleration.y*t),0!==this._rotationSpeed&&(this._rotation+=this._rotationSpeed*t),this._position.x+=this._velocity.x*t,this._position.y+=this._velocity.y*t)},t.prototype.init=function(){this._age=0,this._velocity=this._velocity.rotateBy(this._rotation)},t.prototype.destroy=function(){this._emitter=null,this._lifetimeFunc=null,this._extraData=null,this._updateFunc=null,this._next=null,this._prev=null},t.prototype.kill=function(){this._emitter.recycle(this)},Object.defineProperty(t.prototype,"emitter",{set:function(t){this._emitter=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"velocity",{get:function(){return this._velocity},set:function(t){this._velocity=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationSpeed",{get:function(){return this._rotationSpeed},set:function(t){this._rotationSpeed=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxLife",{set:function(t){this._maxLife=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lifetimeFunc",{set:function(t){this._lifetimeFunc=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateFunc",{set:function(t){this._updateFunc=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"acceleration",{get:function(){return this._acceleration},set:function(t){this._acceleration=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extraData",{get:function(){return this._extraData},set:function(t){this._extraData=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"next",{get:function(){return this._next},set:function(t){this._next=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"prev",{get:function(){return this._prev},set:function(t){this._prev=t},enumerable:!0,configurable:!0}),t}(),pi=function(){function t(){}return t.prototype.acquire=function(t){var e;return this._poolFirst?(e=this._poolFirst,this._poolFirst=this._poolFirst.next,e.next=null,e.emitter=t):e=new ci(t),e},t.prototype.release=function(t){t.prev=null,t.next=this._poolFirst,this._poolFirst=t},t.prototype.destroy=function(){for(var t,e=this._poolFirst;e;e=t)t=e.next,e.destroy();this._poolFirst=null},t}(),fi=function(){function t(){this._particleSystems=[],this._weather=qe.Sun,this._particlePool=new pi;var t=new ai(this._particlePool);t.init(),this._particleSystems.push(t);var e=new ui(this._particlePool);e.init(),this._particleSystems.push(e),this._lastTime=NaN}return t.prototype.setWeather=function(t){t!==this._weather&&(t<qe.Sun&&this._particleSystems[t].cleanup(),this._weather=t,this._lastTime=NaN)},t.prototype.getWeather=function(){return this._weather},t.prototype.update=function(){if(this._weather<qe.Sun){var t=Date.now(),e=isNaN(this._lastTime)?0:t-this._lastTime;this._lastTime=t,this._particleSystems[this._weather].update(e/1e3)}},t.prototype.render=function(t){this._weather<qe.Sun&&this._particleSystems[this._weather].render(t)},t.prototype.resize=function(t,e){for(var n=0;n<qe.Sun;++n){var i=0;n==qe.Rain&&(i=Math.abs(Math.tan(c.rainParticleRotation*s.deg2Rad))*e);var o=t+i;this._particleSystems[n].spawnRect={width:o,height:2},this._particleSystems[n].emitterPosition=new y(t/2-i/2,0),this._particleSystems[n].lifetimeFunc=function(n){return n.position.y>e||n.position.x>t}}},t.prototype.destroy=function(){for(var t=0;t<qe.Sun;++t)this._particleSystems[t].destroy();for(;0!=this._particleSystems.length;)this._particleSystems.pop();this._particleSystems=null,this._particlePool.destroy(),this._particlePool=null},t}(),di=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),gi=function(t){function e(e,n){var i=t.call(this)||this;i.container=e,i.gl=null,i.mapIsChanging=!1,i.defaultMapOptions={center:[-1,-1],zoom:12,minZoom:a.defaultMinZoom,maxZoom:a.defaultMaxZoom,geolocate:!1,mapControls:!1,mapControlOptions:hi.BOTTOM_RIGHT,tilt:0},i.defaultAnimationOptions={duration:null,easing:null,animate:!1},i.defaultPaddingOptions={top:0,bottom:0,left:0,right:0};var o={};return T.extendOptions(o,i.defaultMapOptions,n),i.options=o,i.init(),i}return di(e,t),e.prototype.init=function(){this.setupMapViews(this.container,this.options),this.setupComponents(this.options),this.createStyleNode(),this.loop()},e.prototype.loop=function(){this.resize(),this.dirty&&(this.dirty=!1,this.update(),this.render(),this.mapSettings.is3dMode()&&this.weatherManager.getWeather()<qe.Sun&&(this.dirty=!0),(this.mapIsChanging||this.mapState.isFlyingTo()||this.mapState.isPanning()||this.mapState.isZoomIn()||this.mapState.isZoomOut()||this.mapState.isStartedAnimation()||this.mapState.isMoving())&&(this.dirty=!0)),requestAnimationFrame(this.loop.bind(this))},e.prototype.update=function(){var t=this;this.cameraAnimation.updateTransitions(),this.annotationManager.update(),this.layers.forEach(function(e){e.update(t.mapState)}),this.mapSettings.is3dMode()&&this.weatherManager.update()},e.prototype.resize=function(){if(null!=this.canvas){T.pixelScale=window.devicePixelRatio||1;var t=this.canvas.offsetWidth*T.pixelScale,e=this.canvas.offsetHeight*T.pixelScale;this.width==t&&this.height==e||(null!=this.frameBuffer&&this.frameBuffer.destroy(),this.width=t,this.height=e,this.canvas.width=this.width,this.canvas.height=this.height,this.gl.viewport(0,0,this.width,this.height),this.mapState.setScreenSize(this.width,this.height),this.weatherManager.resize(t,e),this.frameBuffer=new ei(this.gl),this.tileManager.updateVisibleTiles(),this.buildingLayer.setDirty(),this.dirty=!0)}},e.prototype.render=function(){var t=this.gl;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.mapRenderer.render(),this.mapSettings.is3dMode()&&(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.weatherManager.render(this.mapState),t.disable(t.BLEND))},e.prototype.renderSelection=function(){var t=this.gl;t.clearColor(1,1,1,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.mapRenderer.renderSelection();var e=S.fromHex(this.mapState.is3dMode()?a.mapBackgroundColor3D:a.mapBackgroundColor2D);t.clearColor(e.red,e.green,e.blue,1)},e.prototype.getSelectionCode=function(t){if(null!=this.frameBuffer){this.frameBuffer.bind(),this.renderSelection();var e=new Uint8Array([0,0,0,0]);this.gl.readPixels(t.x,this.height-t.y,1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e);var n=e[0],i=e[1],o=e[2];return this.frameBuffer.unbind(),n<<16|i<<8|o}return-1},e.prototype.createLayer=function(t,e,n){if(this.layers.has(t))return console.log("Cannot create layer which layer id already exist"),null;var i=Fn.createLayer(t,e,this.tileManager,n);return null!=i?(this.mapRenderer.addLayer(i),this.layers.set(t,i),i):null},e.prototype.removeLayer=function(t,e){this.mapRenderer.removeLayer(t,e),this.layers.delete(t)},e.createCameraAnimationOptions=function(t){var e=new ie;if(t.animate){if(null!=t.duration&&t.duration<0)throw new Error("Animation duration must be greater or equal to 0");e.easing=t.easing}return e.duration=t.duration,e.gesture=!1,e},e.prototype.panBy=function(t,n){n=T.extendOptions({},this.defaultAnimationOptions,n),this.cameraAnimation.moveBy(t,e.createCameraAnimationOptions(n))},e.prototype.panTo=function(t,n){null==(n=T.extendOptions({},this.defaultAnimationOptions,n)).duration&&(n.duration=T.getTimePanTo(this.mapState.getTarget(),t,this.mapState.getZoom())),this.cameraAnimation.moveTo(t,this.mapState.getZoom(),e.createCameraAnimationOptions(n))},e.prototype.flyTo=function(t,n,i){var o=new oe;o.target=t,o.zoom=n,o.zoom<a.defaultMinZoom3d&&this.mapSettings.is3dMode()&&this.mapState.enable3dMode(!1)&&this.tileManager.clearTileCache(),i=T.extendOptions({},this.defaultAnimationOptions,i),this.cameraAnimation.flyTo(o,e.createCameraAnimationOptions(i))},e.prototype.moveTo=function(t,n,i){n<a.defaultMinZoom3d&&this.mapSettings.is3dMode()&&this.mapState.enable3dMode(!1)&&this.tileManager.clearTileCache(),i=T.extendOptions({},this.defaultAnimationOptions,i),this.cameraAnimation.moveTo(t,n,e.createCameraAnimationOptions(i))},e.prototype.fitBounds=function(t,e,n){if((e=T.extendOptions({},this.defaultPaddingOptions,e)).top<0||e.bottom<0||e.left<0||e.right<0)throw new Error("Padding value must be greater or equal to 0");var i=this.getCameraPositionForLatLngBounds(t,e.left,e.top,e.right,e.bottom);this.flyTo(i.getTarget(),i.getZoom(),n)},e.prototype.moveBy=function(t){this.cameraAnimation.moveBy(t,null,!0)},e.prototype.moveByVelocity=function(t){this.mapState.isPanning()||this.mapState.isZoomIn()||this.mapState.isZoomOut()||this.cameraAnimation.moveByVelocity(t)},e.prototype.getCameraPositionForLatLngBounds=function(t,e,n,i,o){var r={top:n,bottom:o,left:e,right:i};return T.getCameraPositionForLatLngBounds(t,r,this.mapState,this.mapSettings)},e.prototype.setZoom=function(t,e,n,i){void 0===n&&(n=0),void 0===i&&(i=!1);var o=new ie;o.duration=n,o.gesture=i,t=f.clamp(t,this.mapSettings.getPreferMinZoom(),this.mapSettings.getMaxZoom()),this.cameraAnimation.zoom(t,e,o)},e.prototype.setTilt=function(t,e){void 0===e&&(e=!1),this.cameraAnimation.setTilt(t,e)},e.prototype.setBearing=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=!1),this.cameraAnimation.setBearing(t,e,n)},e.prototype.stopAnimation=function(){this.cameraAnimation.stopAnimation()},e.prototype.setMapUrl=function(t,e){this.mapSettings.getMapUrl()!=t&&(this.mapSettings.setMapUrl(t,e),e&&this.mapSettings.is3dMode()&&(this.buildingResourceManager.removeAllResources(),this.buildingLayer.clear()),this.tileManager.reload())},e.prototype.setWeather=function(t){this.dirty=!0,this.weatherManager.setWeather(t)},e.prototype.getWeather=function(){return this.weatherManager.getWeather()},e.prototype.enable3dMode=function(t){if(t!=this.mapState.is3dMode()){if(t&&!T.insideOfVietNam(this.mapState.getTarget())){var e=T.getNearestByLocations(this.mapState.getTarget());this.mapState.setTarget(e)}if(this.mapState.enable3dMode(t)){if(this.tileManager.reload(),t){var n=f.clamp(this.mapState.getZoom(),a.defaultMinZoom3d,this.mapSettings.getMaxZoom());this.moveTo(this.mapState.getTarget(),n)}else this.buildingResourceManager.removeAllResources(),this.buildingLayer.clear();var i=S.fromHex(this.mapState.is3dMode()?a.mapBackgroundColor3D:a.mapBackgroundColor2D);this.gl.clearColor(i.red,i.green,i.blue,1)}}},e.prototype.getBounds=function(){if(!this.getCamera().getTarget()||!this.mapState.getZoom())return null;var t=this.mapState.getScreenSize(),e=w.screenCoordinateToLatLng(new y(0,0),this.mapState).normalize(),n=w.screenCoordinateToLatLng(new y(t.x,0),this.mapState).normalize(),i=w.screenCoordinateToLatLng(new y(t.x,t.y),this.mapState).normalize(),o=w.screenCoordinateToLatLng(new y(0,t.y),this.mapState).normalize(),r=new M;return r.extend(e).extend(n).extend(i).extend(o),r},e.prototype.getCurrentMousePosition=function(t){return new y((t.clientX-this.canvas.getBoundingClientRect().left)*T.pixelScale,(t.clientY-this.canvas.getBoundingClientRect().top)*T.pixelScale)},e.prototype.getMapUrl=function(){return this.mapSettings.getMapUrl()},e.prototype.hideInfoWindow=function(t){this.annotationManager.hideInfoWindow(t)},e.prototype.isInfoWindowShown=function(t){return this.annotationManager.isInfoWindowShown(t)},e.prototype.showInfoWindow=function(t){this.annotationManager.showInfoWindow(t)},e.prototype.setMinZoom=function(t){this.mapSettings.setMinZoom(t)},e.prototype.setMaxZoom=function(t){this.mapSettings.setMaxZoom(t)},e.prototype.setMaxNativeZoom=function(t){t=f.clamp(t,a.defaultMinZoom,a.defaultMaxZoom),this.mapSettings.setMaxNativeZoom(t)},e.prototype.addTileArea=function(t){return this.tileAreaManager.addTileArea(t)},e.prototype.removeTileArea=function(t){this.tileAreaManager.removeTileArea(t)},e.prototype.addAnnotation=function(t){return this.dirty=!0,this.annotationManager.addAnnotation(t)},e.prototype.updateAnnotation=function(t,e){void 0===e&&(e=!1),this.dirty=!0,this.annotationManager.updateAnnotation(t,e)},e.prototype.removeAnnotation=function(t){this.dirty=!0,this.annotationManager.removeAnnotation(t)},e.prototype.addMapObject=function(t){this.tileManager.addMapObject(t)},e.prototype.removeMapObject=function(t){this.tileManager.removeMapObject(t)},e.prototype.screenCoordinateToLatLng=function(t){return w.screenCoordinateToLatLng(t,this.mapState)},e.prototype.latLngToScreenCoordinate=function(t){return w.latLngToScreenCoordinate(t,0,this.mapState)},e.prototype.getCamera=function(){return this.mapState.getCamera()},e.prototype.setCamera=function(t){var e=new oe,n=new ie;n.duration=0,e.bearing=t.getBearing(),e.tilt=t.getTilt(),e.target=t.getTarget(),e.zoom=t.getZoom(),this.mapState.movingTo=!t.getTarget().equals(this.mapState.getTarget()),this.mapState.zoomIn=t.getZoom()>this.mapState.getZoom(),this.mapState.zoomOut=t.getZoom()<this.mapState.getZoom(),this.mapState.tilting=t.getTilt()!=this.mapState.getTilt(),this.mapState.bearing=t.getBearing()!=this.mapState.getBearing(),(this.mapState.movingTo||this.mapState.zoomIn||this.mapState.zoomOut||this.mapState.tilting||this.mapState.bearing)&&this.cameraAnimation.easeTo(e,n)},e.prototype.setSwitchMode=function(t){this.mapState.setSwitchMode(t)},e.prototype.reload=function(){this.tileManager.reload()},e.prototype.setupComponents=function(t){var e=this,n={};T.extendOptions(n,this.defaultMapOptions,t),Dt.Instance.init(this.gl),this.frameBuffer=new ei(this.gl),this.layers=new Map,this.httpTaskManager=new lt,this.mapsEventManager=new zn(this),this.mapSettings=new D(function(){e.mapsEventManager.notify(i.modeChanged)}),this.mapState=new O(this.mapSettings),this.mapRenderer=new te(this.gl,this.mapState),this.cameraAnimation=new se(this.mapState,this,this.mapSettings),this.dirty=!0,this.mapObserver=new R,f.clamp(n.tilt,0,45),this.mapState.setTarget(p.convert(n.center)),this.mapState.setZoom(n.zoom),this.mapState.setTilt(n.tilt),this.mapState.setScreenSize(this.width,this.height),this.mapSettings.setMinZoom(n.minZoom),this.mapSettings.setMaxZoom(n.maxZoom);var o=function(){e.dirty=!0};this.buildingResourceManager=new ti(this.gl,this.httpTaskManager,o),this.tileManager=new et(this,this.httpTaskManager,this.mapState,this.mapSettings,this.buildingResourceManager,function(t){return new Jn(t,e.annotationManager,e.gl)},o),this.tileAreaManager=new ln(this.tileManager),this.createLayer("1.rasterLayer",ut.RASTER,a.rasterLayerOrder),this.buildingLayer=this.createLayer("2.buildingLayer",ut.BUILDING,a.buildingLayerOrder),this.buildingLayer.setBuildingResourceManager(this.buildingResourceManager);this._annotationManager=new un(this,function(){e.dirty=!0}),this.weatherManager=new fi},e.prototype.createStyleNode=function(){var t=document.createElement("style");t.innerHTML=_.content,document.getElementsByTagName("head")[0].appendChild(t)},e.prototype.setupMapViews=function(t,e){var n=E.create("div","mf-mapgl",t);this.mapContainer=n,this.canvas=E.create("canvas","",n),this.gl=this.canvas.getContext("experimental-webgl");var i=S.fromHex(a.mapBackgroundColor2D);this.gl.clearColor(i.red,i.green,i.blue,i.alpha),T.pixelScale=window.devicePixelRatio||1,this.width=this.canvas.offsetWidth*T.pixelScale,this.height=this.canvas.offsetHeight*T.pixelScale,this.createMapControlNode(n,e),this.createLogoNode(n)},e.prototype.createMapControlNode=function(t,e){var n=E.create("div","mf-ui",t),i=null;e.mapControls&&(i=E.create("div","mf-ui "+_.getStyleForControlOptions(e.mapControlOptions),n),this.zoomInButton=E.create("div","mf-button",i),this.zoomInButton.innerHTML="<a class='mf-zoom-in-icon'></a>",this.zoomOutButton=E.create("div","mf-button",i),this.zoomOutButton.innerHTML="<a class='mf-zoom-out-icon'></a>"),e.geolocate&&(this.geolocateControl=new Un(i,this)),this.addEvents()},e.prototype.createLogoNode=function(t){var e=E.create("div","mf-logo-container",t),n=b.get("logoIcon");e.innerHTML="<a target='_blank' href='https://www.map4d.vn/' aria-label='Map4D Logo'>\n      <img src="+n+" class='mf-logo'/>\n      </a>"},e.prototype.addEvents=function(){var t=this;this.mouseEventHandler=new C(this.canvas,this),window.addEventListener("resize",this.resize,!1),this.options.mapControls&&(this.zoomInButton.addEventListener("click",function(){t.setZoom(t.mapState.getZoom()+1,new y(t.width/2,t.height/2),0,!1)}),this.zoomOutButton.addEventListener("click",function(){t.setZoom(t.mapState.getZoom()-1,new y(t.width/2,t.height/2),0,!1)}))},e.prototype.addListener=function(t,e){return this.mapsEventManager.addEvent(t,e)},e.prototype.setInfoWindow=function(t){this.annotationManager.setInfoWindow(t)},e.prototype.setInfoContents=function(t){this.annotationManager.setInfoContents(t)},e.prototype.updateInfoContents=function(t){this.annotationManager.updateInfoContents(t)},e.prototype.notifyCameraWillChange=function(t){this.dirty=!0,this.mapIsChanging=!0,this.mapsEventManager.notify(i.cameraWillChange,null,t)},e.prototype.notifyCameraIsChanging=function(){this.dirty=!0,this.mapsEventManager.notify(i.cameraChanging),this.buildingLayer.setDirty(),this.tileManager.updateVisibleTiles()},e.prototype.notifyCameraDidChange=function(){this.mapIsChanging=!1,this.mapsEventManager.notify(i.idle)},e.prototype.getLayer=function(t){return this.layers.has(t)?this.layers.get(t):null},e.prototype.queryMarkerAnnotation=function(t){return this.annotationManager.queryMarkerAnnotation(t)},e.prototype.queryShapeAnnotation=function(t){return this.annotationManager.queryShapeAnnotation(t)},e.prototype.queryBuildingInfo=function(t){var e=this.getSelectionCode(t);return this.buildingLayer.getBuilding(e)},e.prototype.setTime=function(t){this.mapSettings.setTime(t.getTime()),this.reload(),this.mapSettings.is3dMode()&&(this.buildingResourceManager.removeAllResources(),this.buildingLayer.clear())},e.prototype.getMapContainer=function(){return this.mapContainer},e.prototype.destroy=function(){this.frameBuffer.destroy(),this.shader.destroy(),this.tileManager.destroy(),this.mapsEventManager.destroy(),this.weatherManager.destroy(),this.layers.clear(),this.buildingLayer.clear(),this.gl=null},Object.defineProperty(e.prototype,"annotationManager",{get:function(){return this._annotationManager},enumerable:!0,configurable:!0}),e.prototype.flyToMyLocation=function(t){void 0===t&&(t=!0),this.geolocateControl&&this.geolocateControl.flyToMyLocation(t)},e}(I);!function(t){t[t.Auto2DTo3D=0]="Auto2DTo3D",t[t.Auto3DTo2D=1]="Auto3DTo2D",t[t.Auto=2]="Auto",t[t.Manual=3]="Manual",t[t.Default=4]="Default"}(li||(li={})),function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_RIGHT=1]="TOP_RIGHT",t[t.BOTTOM_LEFT=2]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=3]="BOTTOM_RIGHT"}(hi||(hi={}));var mi=function(){function t(t,e){if(null==e.accessKey){var n="Map4D SDK: Missing access key!";throw alert(n),new Error(n)}this._mapView=new gi(t,e)}return Object.defineProperty(t.prototype,"mapView",{get:function(){return this._mapView},enumerable:!0,configurable:!0}),t.prototype.enable3dMode=function(t){this.mapView.enable3dMode(t)},t.prototype.getBounds=function(){return this.mapView.getBounds()},t.prototype.setMapUrl=function(t,e){void 0===e&&(e=!1),this.mapView.setMapUrl(t,e)},t.prototype.getMapUrl=function(){return this.mapView.getMapUrl()},t.prototype.setMinZoom=function(t){this.mapView.setMinZoom(t)},t.prototype.setMaxZoom=function(t){this.mapView.setMaxZoom(t)},t.prototype.getCamera=function(){var t=this.mapView.getCamera();return new v(t.getTarget(),t.getTilt(),t.getBearing(),t.getZoom())},t.prototype.setCamera=function(t){var e=v.convert(t);null==e.getTarget()&&e.setTarget(this.mapView.mapState.getTarget()),null==e.getTilt()&&e.setTilt(this.mapView.mapState.getTilt()),null==e.getBearing()&&e.setBearing(this.mapView.mapState.getBearing()),null==e.getZoom()&&e.setZoom(this.mapView.mapState.getZoom()),e.setTilt(f.clamp(e.getTilt(),a.minTilt,a.maxTilt));for(var n=e.getBearing();n>=360;)n-=360;for(;n<0;)n+=360;e.setBearing(n);var i=Math.round(e.getZoom());e.setZoom(f.clamp(i,this.mapView.mapSettings.getMinZoom(),this.mapView.mapSettings.getMaxZoom())),e.getZoom()<a.defaultMinZoom3d&&this.mapView.mapState.is3dMode()&&this.mapView.enable3dMode(!1),this.mapView.setCamera(e)},t.prototype.setWeather=function(t){this.mapView.setWeather(t)},t.prototype.getWeather=function(){return this.mapView.getWeather()},t.prototype.panBy=function(t,e){var n=g.convert(t),i=T.pointToPixel(n);this.mapView.panBy(i,e)},t.prototype.panTo=function(t,e){this.mapView.panTo(p.convert(t),e)},t.prototype.flyTo=function(t,e,n){this.mapView.flyTo(p.convert(t),e,n)},t.prototype.fitBounds=function(t,e,n){this._mapView.fitBounds(M.convert(t),e,n)},t.prototype.setSwitchMode=function(t){this.mapView.setSwitchMode(t)},t.prototype.addListener=function(t,e){return this.mapView.addListener(t,e)},t.prototype.setTime=function(t){this.mapView.setTime(t)},t.prototype.setInfoWindow=function(t){this.mapView.setInfoWindow(t)},t.prototype.setInfoContents=function(t){this.mapView.setInfoContents(t)},t.prototype.flyToMyLocation=function(t){void 0===t&&(t=!0),this.mapView.flyToMyLocation(t)},t}(),yi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),vi=function(t){function e(e){var n=t.call(this)||this;n.defaultTileArea={url:a.baseMapUrl,minZoom:a.defaultMinZoom,maxZoom:a.defaultMaxZoom};var i={};return T.extendOptions(i,n.defaultTileArea,e),n._bounds=M.convert(i.bounds),n._url=i.url,n._minZoom=i.minZoom,n._maxZoom=i.maxZoom,n}return yi(e,t),e.prototype.getBounds=function(){return this._bounds},e.prototype.getUrl=function(){return this._url},e.prototype.getMinZoom=function(){return this._minZoom},e.prototype.getMaxZoom=function(){return this._maxZoom},e.prototype.setBounds=function(t){this._bounds=M.convert(t),null!=this._map&&this._map.mapView.reload()},e.prototype.setMinZoom=function(t){this._minZoom!=t&&(this._minZoom=t,null!=this._map&&this._map.mapView.reload())},e.prototype.setMaxZoom=function(t){this._maxZoom!=t&&(this._maxZoom=t,null!=this._map&&this._map.mapView.reload())},e.prototype.setUrl=function(t){this._url!=t&&(this._url=t,null!=this._map&&this._map.mapView.reload())},e.prototype.setMap=function(t){this._map!==t&&(null!=this._map&&(this._map.mapView.removeTileArea(this._id),this._id=-1),this._map=t,null!=this._map&&(this._id=this._map.mapView.addTileArea(this)))},e}(ye),xi=function(){function t(t){this.map=t}return t.prototype.fromLatLngToScreen=function(t){var e=this.map.mapView.latLngToScreenCoordinate(p.convert(t));return T.pixelToPoint(new g(e.x,e.y))},t.prototype.fromScreenToLatLng=function(t){var e=g.convert(t),n=T.pointToPixel(e);return this.map.mapView.screenCoordinateToLatLng(new y(n.x,n.y))},t}();n.d(e,"Map",function(){return mi}),n.d(e,"ControlOptions",function(){return hi}),n.d(e,"Marker",function(){return we}),n.d(e,"Polyline",function(){return rn}),n.d(e,"Polygon",function(){return be}),n.d(e,"Circle",function(){return xe}),n.d(e,"TileArea",function(){return vi}),n.d(e,"Projection",function(){return xi}),n.d(e,"LatLng",function(){return p}),n.d(e,"LatLngBounds",function(){return M}),n.d(e,"Icon",function(){return Ae}),n.d(e,"Point",function(){return g}),n.d(e,"CameraPosition",function(){return v}),n.d(e,"SwitchMode",function(){return li}),n.d(e,"MapObject",function(){return kn}),n.d(e,"MapEvent",function(){return i}),n.d(e,"Weather",function(){return qe})}]);
//# sourceMappingURL=map4dsdk@0.0.5.production.js.map